
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../server_side_programming_authentication_template_engines/">
      
      
        <link rel="next" href="../advanced_auth_session_management/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Database Integration & SQL Security - Software Engineering - Stage 6 - NSW</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-YG16K7VJ8G"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-YG16K7VJ8G",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-YG16K7VJ8G",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#week-8-database-integration-sql-security" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Software Engineering - Stage 6 - NSW" class="md-header__button md-logo" aria-label="Software Engineering - Stage 6 - NSW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Engineering - Stage 6 - NSW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database Integration & SQL Security
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/mr-bev/software-engineering-stage6-nsw" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mr-bev/se-stage6-nsw
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
  
  <nav id="quiz-progress-mobile" class="quiz-progress-mobile md-nav" aria-label="Quiz Progress" style="display: none;">
    <!-- mkdocs-quiz progress sidebar (mobile) -->
    <div class="quiz-progress-bar">
      <div class="quiz-progress-bar-incorrect" style="width: 0%"></div>
      <div class="quiz-progress-bar-correct" style="width: 0%"></div>
    </div>
    <div data-md-component="quiz-progress">
        <div class="quiz-correct-reset">
          <span class="md-ellipsis">
            <span data-quiz-translate="Answered:">Answered:</span> <span class="quiz-progress-answered">0</span> / <span class="quiz-progress-total">0</span>
          </span>
          <span class="md-ellipsis">
            <span data-quiz-translate="Correct:">Correct:</span> <span class="quiz-progress-score">0</span> / <span class="quiz-progress-score-total">0</span>
          </span>
          <a href="#" class="quiz-reset-all-link" style="color: var(--md-primary-fg-color); text-decoration: none;">
            <span data-quiz-translate="Reset">Reset</span>
          </a>
        </div>
    </div>
  </nav>

  
  
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../Syllabus/" class="md-tabs__link">
          
  
  
  Syllabus

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../principles/" class="md-tabs__link">
          
  
  
  Principles of SE

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../fundamentals/number_systems/" class="md-tabs__link">
          
  
  
  Software Fundamentals

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../object_oriented_software/" class="md-tabs__link">
          
  
  
  Object Oriented

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mechatronics/" class="md-tabs__link">
          
  
  
  Mechatronics

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Secure Web Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../machine_learning/" class="md-tabs__link">
          
  
  
  Machine Learning

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      

      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
  
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Software Engineering - Stage 6 - NSW" class="md-nav__button md-logo" aria-label="Software Engineering - Stage 6 - NSW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Software Engineering - Stage 6 - NSW
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mr-bev/software-engineering-stage6-nsw" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    mr-bev/se-stage6-nsw
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Syllabus
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Syllabus
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/programming-fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Programming Fundamentals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/object-oriented-paradigm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Object Oriented Paradigm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/programming-mechatronics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Programming Mechatronics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/secure-software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Secure Software Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/web-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Programming For The Web
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/software-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Syllabus/se-project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Engineering Project
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Principles of SE
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Principles of SE
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/sdlc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SDLC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/waterfall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Waterfall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/agile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agile
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/other_sdlc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Other Development Lifecycles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../principles/revision_control_systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Revision Control Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Software Fundamentals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Software Fundamentals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/number_systems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Number Systems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/data_types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/data_structures/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Structures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Algorithms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/big_o/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Algorithm Complexity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/software_quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Software Quality
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fundamentals/asynch_and_threading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Async and Threading
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Object Oriented
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Object Oriented
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object_oriented_software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object_oriented_software/key_concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Key Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object_oriented_software/object_oriented_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Object Oriented Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../object_oriented_software/software_design_patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mechatronics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mechatronics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/hardware_software/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hardware and Software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/sensors_actuators_effectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sensors, Actuators and End Effectors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/design_engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design and Engineering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/system_integration_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Integration and Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/control_algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Control Algorithms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mechatronics/programming_building/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Programming and Building
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Secure Web Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Secure Web Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Web Fundamentals + Security Awareness
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web Fundamentals + Security Awareness
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_the_web_works/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How the Web Works
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web_protocols_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web Protocols & Security Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web_development_security_mindset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Web Development & Security Mindset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Front-End Development & Input Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Front-End Development & Input Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../javascript_fun_client_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JavaScript Fundamentals & Client-Side Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../css_frameworks_version_control_secure_dev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSS Frameworks, Version Control & Secure Development Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client_side_security_user_experience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client-Side Security & User Experience
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" checked>
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Back-End Development & Core Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Back-End Development & Core Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../server_side_programming_authentication_template_engines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Server-Side Programming, Authentication & Template Engines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Database Integration & SQL Security
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Integration & SQL Security
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-database-fundamentals-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        1: Database Fundamentals and Connection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1: Database Fundamentals and Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is a Database?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-database-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Database Terminology
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-vs-nosql-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL vs NoSQL Databases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-crud" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is CRUD?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-11-explore-database-structure-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 1.1: Explore Database Structure (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-12-set-up-database-connection-you-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 1.2: Set Up Database Connection (YOU DO)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-database-schema-design-normalisation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2: Database Schema Design &amp; Normalisation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2: Database Schema Design &amp; Normalisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalisation-organising-data-efficiently" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normalisation: Organising Data Efficiently
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-normalisation-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Normalisation Matters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-tables-with-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Tables with SQL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-21-design-your-database-schema-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 2.1: Design Your Database Schema (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-22-create-your-database-you-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 2.2: Create Your Database (YOU DO)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#content-part-3-sql-queries-and-crud-operations-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Content Part 3: SQL Queries and CRUD Operations (WE DO)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Content Part 3: SQL Queries and CRUD Operations (WE DO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-crud-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL CRUD Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-insert-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        CREATE: INSERT Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-select-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        READ: SELECT Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-modifying-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        UPDATE: Modifying Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-removing-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        DELETE: Removing Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-31-practice-crud-operations-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 3.1: Practice CRUD Operations (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-32-table-joins-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 3.2: Table Joins (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-joins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding JOINs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-types-visual-guide" class="md-nav__link">
    <span class="md-ellipsis">
      
        JOIN Types Visual Guide
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-sql-injection-and-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        4: SQL Injection and Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4: SQL Injection and Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is SQL Injection?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-sql-injection-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How SQL Injection Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-world-sql-injection-damage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World SQL Injection Damage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-41-create-vulnerable-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.1: Create Vulnerable Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-42-fix-with-prepared-statements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.2: Fix with Prepared Statements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution-prepared-statements" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Solution: Prepared Statements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-43-secure-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.3: Secure Your Application
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-performance-indexing-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        5: Performance, Indexing &amp; Backups
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5: Performance, Indexing &amp; Backups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-performance-and-indexing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Performance and Indexing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-an-index" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Index?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-create-indexes" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Create Indexes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-indexes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Indexes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimisation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Optimisation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-51-measure-index-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 5.1: Measure Index Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-scripts-for-database-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shell Scripts for Database Backups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-3-2-1-backup-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 3-2-1 Backup Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-backup-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Backup Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-52-create-backup-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 5.2: Create Backup System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_auth_session_management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced Authentication, Authorisation & Session Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file_security_safe_apis_cryptography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Security, Safe APIs & Cryptography in Practice
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <label class="md-nav__link" for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Secure Architecture & Progressive Web Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Secure Architecture & Progressive Web Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwa_privacy_by_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Progressive Web Apps & Privacy by Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing_strategies_security_hardening/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategies & Security Hardening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../business_continuity_disaster_recovery_open_source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Business Continuity, Disaster Recovery & Open Source
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../collaborative_development_professional_practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Collaborative Development & Professional Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <label class="md-nav__link" for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Impact & Professional Standards
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Enterprise Impact & Professional Standards
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enterprise_benefits_industry_imp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Enterprise Benefits & Industry Impact
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../social_ethical_legal_ram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Social, Ethical & Legal Ramifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Machine Learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine Learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/foundations_of_ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Foundations of AI, ML & Automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/ml_training_models_data_fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML Training Models & Data Fundamentals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/classical_ml_algorithms_concepts_simple_implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Classical ML Algorithms - Concepts & Simple Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/regression_models_linear_polynomial_implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regression Models - Linear & Polynomial Implementation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/logistic_regression_model_comparison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logistic Regression & Model Comparison
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/neural_networks_simplified_introduction_advanced_class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Networks - Simplified Introduction & Advanced Classical ML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/human_factors_behavior_bias_ml_ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Human Factors, Behaviour Patterns & Bias in ML/AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/impact_assessment_synthesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Impact Assessment & Synthesis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning Objectives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-database-fundamentals-and-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        1: Database Fundamentals and Connection
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1: Database Fundamentals and Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-database" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is a Database?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-database-terminology" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Database Terminology
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sql-vs-nosql-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL vs NoSQL Databases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-connection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Connection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-crud" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is CRUD?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-11-explore-database-structure-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 1.1: Explore Database Structure (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-12-set-up-database-connection-you-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 1.2: Set Up Database Connection (YOU DO)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-database-schema-design-normalisation" class="md-nav__link">
    <span class="md-ellipsis">
      
        2: Database Schema Design &amp; Normalisation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2: Database Schema Design &amp; Normalisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Schema Design
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalisation-organising-data-efficiently" class="md-nav__link">
    <span class="md-ellipsis">
      
        Normalisation: Organising Data Efficiently
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-normalisation-matters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Normalisation Matters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-tables-with-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Tables with SQL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-21-design-your-database-schema-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 2.1: Design Your Database Schema (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-22-create-your-database-you-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 2.2: Create Your Database (YOU DO)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#content-part-3-sql-queries-and-crud-operations-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Content Part 3: SQL Queries and CRUD Operations (WE DO)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Content Part 3: SQL Queries and CRUD Operations (WE DO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-crud-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        SQL CRUD Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-insert-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        CREATE: INSERT Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-select-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        READ: SELECT Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-modifying-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        UPDATE: Modifying Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-removing-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        DELETE: Removing Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-31-practice-crud-operations-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 3.1: Practice CRUD Operations (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-32-table-joins-we-do" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 3.2: Table Joins (WE DO)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-joins" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding JOINs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-types-visual-guide" class="md-nav__link">
    <span class="md-ellipsis">
      
        JOIN Types Visual Guide
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-sql-injection-and-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        4: SQL Injection and Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4: SQL Injection and Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is SQL Injection?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-sql-injection-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How SQL Injection Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-world-sql-injection-damage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World SQL Injection Damage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-41-create-vulnerable-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.1: Create Vulnerable Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-42-fix-with-prepared-statements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.2: Fix with Prepared Statements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-solution-prepared-statements" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Solution: Prepared Statements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-43-secure-your-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 4.3: Secure Your Application
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-performance-indexing-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        5: Performance, Indexing &amp; Backups
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5: Performance, Indexing &amp; Backups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-performance-and-indexing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database Performance and Indexing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-an-index" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Index?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-create-indexes" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Create Indexes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-indexes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Indexes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-optimisation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Optimisation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-51-measure-index-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 5.1: Measure Index Performance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-scripts-for-database-backups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shell Scripts for Database Backups
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-3-2-1-backup-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 3-2-1 Backup Rule
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-backup-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Backup Scripts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activity-52-create-backup-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activity 5.2: Create Backup System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          

  
  <div id="quiz-progress-sidebar" aria-label="Quiz Progress" style="display: none;">
    <!-- mkdocs-quiz progress sidebar (desktop) -->
    <label class="md-nav__title">
      <span class="md-nav__icon md-icon"></span>
      <span data-quiz-translate="Quiz Progress">Quiz Progress</span>
    </label>
    <ul class="md-nav__list" data-md-component="quiz-progress">
      <li class="md-nav__item">
        <div class="md-nav__link">
          <span class="md-ellipsis">
            <span data-quiz-translate="Answered:">Answered:</span> <span class="quiz-progress-answered">0</span> / <span class="quiz-progress-total">0</span> (<span class="quiz-progress-answered-percentage">0%</span>)
          </span>
        </div>
      </li>
      <li class="md-nav__item">
        <div class="md-nav__link">
          <div class="quiz-progress-bar">
            <div class="quiz-progress-bar-incorrect" style="width: 0%"></div>
            <div class="quiz-progress-bar-correct" style="width: 0%"></div>
          </div>
        </div>
      </li>
      <li class="md-nav__item">
        <div class="md-nav__link quiz-correct-reset">
          <span class="md-ellipsis">
            <span data-quiz-translate="Correct:">Correct:</span> <span class="quiz-progress-score">0</span> / <span class="quiz-progress-score-total">0</span> (<span class="quiz-progress-score-percentage">0%</span>)
          </span>
          <a href="#" class="quiz-reset-all-link" style="color: var(--md-primary-fg-color); text-decoration: none;">
            <span data-quiz-translate="Reset">Reset</span>
          </a>
        </div>
      </li>
    </ul>
  </div>

          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="week-8-database-integration-sql-security">Week 8: Database Integration &amp; SQL Security</h1>
<div class="admonition info">
<p class="admonition-title">Lesson Details</p>
<p><strong>Duration:</strong> 90-120 minutes (self-paced)
<strong>Focus:</strong> Understanding databases, writing secure SQL queries, and preventing SQL injection attacks
<strong>Mode:</strong> Self-paced with hands-on activities</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Week 7: Server-side programming and basic authentication</li>
<li>Week 4: Input validation and XSS prevention</li>
<li>Week 3: Git basics</li>
<li>Understanding of data types and variables</li>
<li>Basic command line skills</li>
</ul>
<p><strong>What You'll Build:</strong> A secure blog application with persistent database storage, replacing Week 7's in-memory user storage with a proper database.</p>
</div>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>By the end of this lesson, you will be able to:</p>
<ol>
<li><strong>Connect</strong> web applications to databases using connection strings and environment variables</li>
<li><strong>Design</strong> database schemas with proper normalisation, primary keys, and foreign keys</li>
<li><strong>Write</strong> SQL queries for all CRUD operations (Create, Read, Update, Delete)</li>
<li><strong>Implement</strong> prepared statements to prevent SQL injection attacks</li>
<li><strong>Apply</strong> database indexing to improve query performance</li>
<li><strong>Create</strong> shell scripts for automated database backups</li>
</ol>
<p><strong>Syllabus Alignment:</strong></p>
<div class="admonition info">
<p class="admonition-title">Programming for the Web</p>
<ul>
<li> Model elements that form a web development system (interfacing with databases based on SQL or non-SQL)</li>
<li> Observe and describe back-end process (databases)</li>
<li> Develop web application with shell scripts (database backup scripts)</li>
<li> Apply web-based database and construct script that executes SQL (selecting fields, 'group by', common SQL queries, constraints using WHERE, table joins)</li>
<li> Investigate effect of big data on web architecture (data mining, metadata, database indexing)</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Secure Software Architecture</p>
<ul>
<li> Explore fundamental security concepts (confidentiality, integrity, availability - applied to data)</li>
<li> Design, develop and implement code using defensive data input handling practices (input validation, sanitisation - preventing SQL injection)</li>
<li> Apply security features for data protection</li>
</ul>
</div>
<hr />
<details class="warning">
<summary>Database Choice</summary>
<p>To simplify your development process it is strongly suggested that you use <strong>SQLite</strong> for all lessons. It supports all key concepts of the syllabus.</p>
<p>Only pick <strong>Postgres</strong> if you have some understanding of databases or have someone who can support you. It is a fully functional SQL database that is used across many of the worlds top Software companies. Also, it is best to run it within docker, which is out of scope for this syllabus, but will simplfy setup and teardown of the database.</p>
</details>
<h2 id="1-database-fundamentals-and-connection">1: Database Fundamentals and Connection</h2>
<p><strong>Duration:</strong> 15-20 minutes | <strong>Bloom's Level:</strong> Remember, Understand | <strong>GRR:</strong> Teacher-led introduction</p>
<h3 id="what-is-a-database">What is a Database?</h3>
<p>A <strong>database</strong> is an organised collection of structured data that provides <strong>persistent storage</strong> - meaning your data survives server restarts and power failures. Unlike storing data in variables or arrays (which disappear when your programme stops), databases keep your data safe permanently.</p>
<div class="admonition question">
<p class="admonition-title">Activating Prior Knowledge</p>
<p>Remember Week 7 when we stored users in an array? What happened when we restarted the server? All users disappeared! Databases solve this problem.</p>
</div>
<h3 id="key-database-terminology">Key Database Terminology</h3>
<pre class="mermaid"><code>graph TD
    A[Database System] --&gt; B[Database]
    B --&gt; C[Tables]
    C --&gt; D[Rows/Records]
    C --&gt; E[Columns/Fields]
    D --&gt; F[Individual Data Values]

    style A fill:#e1f5ff
    style B fill:#b3e5fc
    style C fill:#81d4fa
    style D fill:#4fc3f7
    style E fill:#4fc3f7</code></pre>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Database</strong></td>
<td>Organised collection of structured data</td>
<td>Your blog's database containing all users, posts, and comments</td>
</tr>
<tr>
<td><strong>Table</strong></td>
<td>Collection of related data in rows and columns</td>
<td><code>users</code> table stores all user information</td>
</tr>
<tr>
<td><strong>Row</strong></td>
<td>A single record in a table</td>
<td>One user: id=5, username="alice", email="alice@example.com"</td>
</tr>
<tr>
<td><strong>Column</strong></td>
<td>A field that stores specific type of data</td>
<td>The <code>email</code> column stores email addresses</td>
</tr>
<tr>
<td><strong>Schema</strong></td>
<td>Blueprint of database structure</td>
<td>Defines all tables, columns, data types, and relationships</td>
</tr>
<tr>
<td><strong>Primary Key</strong></td>
<td>Unique identifier for each row (cannot be null)</td>
<td>User ID: Each user has unique ID (1, 2, 3...)</td>
</tr>
<tr>
<td><strong>Foreign Key</strong></td>
<td>Column referencing another table's primary key</td>
<td><code>posts.author_id</code> links to <code>users.id</code></td>
</tr>
</tbody>
</table>
<h3 id="sql-vs-nosql-databases">SQL vs NoSQL Databases</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>SQL (Relational)</th>
<th>NoSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Structure</strong></td>
<td>Tables with fixed schema</td>
<td>Flexible (documents, key-value, graph)</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td>PostgreSQL, MySQL, SQLite</td>
<td>MongoDB, Redis, Cassandra</td>
</tr>
<tr>
<td><strong>Best For</strong></td>
<td>Structured data with relationships</td>
<td>Unstructured data, rapid scaling</td>
</tr>
<tr>
<td><strong>Schema</strong></td>
<td>Must be defined upfront</td>
<td>Can change dynamically</td>
</tr>
<tr>
<td><strong>Relationships</strong></td>
<td>JOINs between tables</td>
<td>Embedded or referenced documents</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Which Should I Use?</p>
<ul>
<li><strong>SQL</strong> for: User accounts, financial records, blog posts (structured data with clear relationships)</li>
<li><strong>NoSQL</strong> for: Real-time chat, social media feeds, IoT sensor data (flexible, rapidly changing data)</li>
</ul>
</div>
<h3 id="database-connection">Database Connection</h3>
<p><strong>Connection String:</strong> A URL containing all information needed to connect to a database.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">SQLite</label><label for="__tabbed_1_2">Postgres</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sqlite:///mydatabase.db
</code></pre></div>
<p>Breaking down the connection string:</p>
<ul>
<li><code>sqlite:///</code> - Database type (SQLite with three slashes for relative path)</li>
<li><code>mydatabase.db</code> - Database file name (stored in current directory)</li>
</ul>
<p><strong>Alternative paths:</strong></p>
<p>Absolute path (Unix/Linux/Mac):
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sqlite:////home/username/projects/mydatabase.db
</code></pre></div></p>
<p>Absolute path (Windows):
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sqlite:///C:/Users/username/projects/mydatabase.db
</code></pre></div></p>
<p>Relative path with subdirectory:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sqlite:///data/mydatabase.db
</code></pre></div></p>
<p>In-memory database (temporary, lost when programme closes):
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sqlite:///:memory:
</code></pre></div></p>
<p><strong>Key differences from PostgreSQL:</strong></p>
<ul>
<li><strong>No username/password:</strong> SQLite is file-based, so there's no authentication<ul>
<li><strong>There is no security on the database contents</strong></li>
</ul>
</li>
<li><strong>No host/port:</strong> SQLite doesn't run as a server, it's just a file</li>
<li><strong>Three slashes:</strong> <code>sqlite:///</code> indicates a relative path from current directory</li>
<li><strong>Four slashes:</strong> <code>sqlite:////</code> indicates an absolute path (note the extra slash after <code>://</code>)
```</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Python sqlite3 Module</p>
<p>When using Python's built-in <code>sqlite3</code> module directly (not through an ORM), you simply provide the file path:</p>
<div class="highlight"><pre><span></span><code>import sqlite3

# Relative path
conn = sqlite3.connect(&#39;mydatabase.db&#39;)

# Absolute path
conn = sqlite3.connect(&#39;/home/username/projects/mydatabase.db&#39;)

# In-memory database
conn = sqlite3.connect(&#39;:memory:&#39;)
</code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">File Permissions</p>
<p>Ensure your application has read/write permissions for:</p>
<ul>
<li>The database file itself (<code>mydatabase.db</code>)</li>
<li>The directory containing the database</li>
<li>SQLite creates temporary files (<code>.db-journal</code>, <code>.db-wal</code>) in the same directory</li>
</ul>
</div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>postgresql://username:password@localhost:5432/mydatabase
</code></pre></div>
<p>Breaking down the connection string:</p>
<ul>
<li><code>postgresql://</code> - Database type (in this case Postgres)</li>
<li><code>username:password</code> - Credentials</li>
<li><code>localhost</code> - Server location (your computer)</li>
<li><code>5432</code> - Port number</li>
<li><code>mydatabase</code> - Database name</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Security Critical</p>
<p><strong>NEVER</strong> hard-code credentials in your source code or commit them to Git!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">#  WRONG - Don&#39;t do this!</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">db_password</span> <span class="o">=</span> <span class="s2">&quot;mypassword123&quot;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1">#  CORRECT - Use environment variables</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">db_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_PASSWORD&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h3 id="what-is-crud">What is CRUD?</h3>
<p><strong>CRUD</strong> is the alphabet of databases - everything you do with data is one of these four operations:</p>
<pre class="mermaid"><code>graph LR
    A[CRUD Operations] --&gt; B[Create: Add new data]
    A --&gt; C[Read: Retrieve data]
    A --&gt; D[Update: Modify data]
    A --&gt; E[Delete: Remove data]

    B --&gt; F[SQL: INSERT]
    C --&gt; G[SQL: SELECT]
    D --&gt; H[SQL: UPDATE]
    E --&gt; I[SQL: DELETE]

    style A fill:#4caf50
    style B fill:#81c784
    style C fill:#81c784
    style D fill:#81c784
    style E fill:#81c784</code></pre>
<table>
<thead>
<tr>
<th>Operation</th>
<th>SQL Command</th>
<th>HTTP Method</th>
<th>Real-World Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Create</strong></td>
<td>INSERT</td>
<td>POST</td>
<td>User signs up for account</td>
</tr>
<tr>
<td><strong>Read</strong></td>
<td>SELECT</td>
<td>GET</td>
<td>View blog post</td>
</tr>
<tr>
<td><strong>Update</strong></td>
<td>UPDATE</td>
<td>PUT/PATCH</td>
<td>Edit profile information</td>
</tr>
<tr>
<td><strong>Delete</strong></td>
<td>DELETE</td>
<td>DELETE</td>
<td>Remove old comment</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="activity-11-explore-database-structure-we-do">Activity 1.1: Explore Database Structure (WE DO)</h3>
<p><strong>Duration:</strong> 10 minutes</p>
<p><strong>Objective:</strong> Understand database tables and relationships</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Open DB Browser for SQLite (or similar GUI tool)</li>
<li>Open the sample database: <code>blog_sample.db</code></li>
<li>Examine the <code>users</code> table structure</li>
<li>Identify the primary key</li>
<li>Look at the <code>posts</code> table</li>
<li>Identify the foreign key linking to users</li>
</ol>
</div>
<p><strong>Questions to Answer:</strong></p>
<ol>
<li>What columns exist in the <code>users</code> table?</li>
<li>Which column is the primary key? How can you tell?</li>
<li>In the <code>posts</code> table, which column is the foreign key?</li>
<li>What does this foreign key relationship represent?</li>
</ol>
<details class="success">
<summary>Expected Answers</summary>
<ol>
<li>Columns: id, username, email, password_hash, created_at</li>
<li>Primary key: <code>id</code> (unique identifier, auto-increments)</li>
<li>Foreign key: <code>author_id</code></li>
<li>Links each post to the user who wrote it</li>
</ol>
</details>
<hr />
<h3 id="activity-12-set-up-database-connection-you-do">Activity 1.2: Set Up Database Connection (YOU DO)</h3>
<p><strong>Duration:</strong> 10 minutes</p>
<p><strong>Objective:</strong> Configure secure database connection</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Create a <code>.env</code> file for environment variables</li>
<li>Add database credentials (don't commit this file!)</li>
<li>Update <code>.gitignore</code> to exclude <code>.env</code></li>
<li>Test database connection</li>
</ol>
</div>
<p><strong>Step-by-Step:</strong></p>
<p><strong>1. Create <code>.env</code> file:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># .env</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nv">DB_NAME</span><span class="o">=</span>blog_database.db
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nv">DB_USER</span><span class="o">=</span>webapp_user
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nv">DB_PASSWORD</span><span class="o">=</span>your_secure_password_here
</code></pre></div></p>
<p><strong>2. Update <code>.gitignore</code>:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Add to .gitignore</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>.env
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>*.db
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>__pycache__/
</code></pre></div></p>
<p><strong>3. Create and activate a virtual environment:</strong></p>
<p>Linux/macOS:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</code></pre></div></p>
<p>Windows:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>.venv/Scripts/activate
</code></pre></div></p>
<p>You should see <code>(venv)</code> appear at the start of your command prompt, indicating the virtual environment is active.</p>
<p><strong>4. Install required packages:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>pip<span class="w"> </span>install<span class="w"> </span>flask<span class="w"> </span>python-dotenv
</code></pre></div></p>
<div class="admonition tip">
<p class="admonition-title">Virtual Environment Best Practices</p>
<p><strong>Always use a virtual environment</strong> for Python projects. This:</p>
<ul>
<li>Keeps project dependencies isolated</li>
<li>Prevents conflicts between different projects</li>
<li>Avoids modifying system Python packages</li>
<li>Makes your project reproducible on other machines</li>
</ul>
<p><strong>To deactivate the virtual environment when finished:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>deactivate
</code></pre></div></p>
<p><strong>Add to your <code>.gitignore</code>:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>.venv/
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>__pycache__/
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>*.pyc
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>.env
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>*.db
</code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Never Commit .venv/</p>
<p>The <code>.venv/</code> directory should <strong>never</strong> be committed to Git. Instead, use a <code>requirements.txt</code> file to track dependencies:</p>
<p><strong>Create requirements.txt:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>pip<span class="w"> </span>freeze<span class="w"> </span>&gt;<span class="w"> </span>requirements.txt
</code></pre></div></p>
<p><strong>Install from requirements.txt (on another machine):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</code></pre></div></p>
</div>
<p><strong>5. Test connection (Python example):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="c1"># Load environment variables</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="c1"># Connect to database</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="n">db_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DB_NAME&#39;</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connected to </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2"> successfully!&quot;</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="c1"># Close connection</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>6. Run your test:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>python<span class="w"> </span>test_connection.py
</code></pre></div></p>
<details class="success">
<summary>Success Criteria</summary>
<ul>
<li><code>.env</code> file created and contains database credentials</li>
<li><code>.env</code> is listed in <code>.gitignore</code></li>
<li>Connection test prints success message</li>
<li>No credentials visible in your source code</li>
</ul>
</details>
<div class="admonition warning">
<p class="admonition-title">Common Mistake</p>
<p>Don't commit <code>.env</code> to Git! If you accidentally do:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>git<span class="w"> </span>rm<span class="w"> </span>--cached<span class="w"> </span>.env
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Remove .env from version control&quot;</span>
</code></pre></div></p>
</div>
<hr />
<h2 id="2-database-schema-design-normalisation">2: Database Schema Design &amp; Normalisation</h2>
<p><strong>Duration:</strong> 15-20 minutes | <strong>Bloom's Level:</strong> Understand, Apply | <strong>GRR:</strong> Guided practice</p>
<h3 id="database-schema-design">Database Schema Design</h3>
<p>A <strong>schema</strong> is your database's blueprint. Good schema design prevents data problems before they start.</p>
<h3 id="normalisation-organising-data-efficiently">Normalisation: Organising Data Efficiently</h3>
<p><strong>Normalisation</strong> reduces data redundancy and improves integrity by dividing large tables into smaller, related tables.</p>
<p><strong>Example: Blog Application Schema</strong></p>
<pre class="mermaid"><code>erDiagram
    USERS ||--o{ POSTS : writes
    USERS ||--o{ COMMENTS : makes
    POSTS ||--o{ COMMENTS : receives
    CATEGORIES ||--o{ POSTS : categorises

    USERS {
        int id PK
        string username
        string email
        string password_hash
        datetime created_at
    }

    POSTS {
        int id PK
        string title
        text content
        int author_id FK
        int category_id FK
        datetime created_at
        datetime updated_at
    }

    COMMENTS {
        int id PK
        int post_id FK
        int user_id FK
        text content
        datetime created_at
    }

    CATEGORIES {
        int id PK
        string name
        text description
    }</code></pre>
<h3 id="why-normalisation-matters">Why Normalisation Matters</h3>
<p><strong> Unnormalised (Poor Design):</strong></p>
<table>
<thead>
<tr>
<th>post_id</th>
<th>title</th>
<th>content</th>
<th>author_name</th>
<th>author_email</th>
<th>author_bio</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Hello</td>
<td>...</td>
<td>Alice</td>
<td>alice@test.com</td>
<td>I love coding...</td>
</tr>
<tr>
<td>2</td>
<td>World</td>
<td>...</td>
<td>Alice</td>
<td>alice@test.com</td>
<td>I love coding...</td>
</tr>
<tr>
<td>3</td>
<td>SQL</td>
<td>...</td>
<td>Alice</td>
<td>alice@test.com</td>
<td>I love coding...</td>
</tr>
</tbody>
</table>
<p><strong>Problems:</strong></p>
<ul>
<li>Alice's data repeated in every post (redundancy)</li>
<li>If Alice changes email, must update every post</li>
<li>Wasted storage space</li>
<li>Risk of inconsistency (updating some rows but not others)</li>
</ul>
<p><strong> Normalised (Good Design):</strong></p>
<p><strong>Users Table:</strong></p>
<table>
<thead>
<tr>
<th>user_id</th>
<th>username</th>
<th>email</th>
<th>bio</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Alice</td>
<td>alice@test.com</td>
<td>I love coding...</td>
</tr>
</tbody>
</table>
<p><strong>Posts Table:</strong></p>
<table>
<thead>
<tr>
<th>post_id</th>
<th>title</th>
<th>content</th>
<th>author_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Hello</td>
<td>...</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>World</td>
<td>...</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>SQL</td>
<td>...</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>Benefits:</strong></p>
<ul>
<li> Alice's data stored once</li>
<li> One update changes all references</li>
<li> Less storage space</li>
<li> Data consistency guaranteed</li>
</ul>
<h3 id="creating-tables-with-sql">Creating Tables with SQL</h3>
<p><strong>SQL</strong> (Structured Query Language) is the standardised language for managing relational databases.</p>
<p><strong>Example: Create Users Table</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="n">password_hash</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="n">bio</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="p">);</span>
</code></pre></div>
<p><strong>Breaking it down:</strong></p>
<ul>
<li><code>CREATE TABLE users</code> - Creates new table named "users"</li>
<li><code>id INTEGER PRIMARY KEY</code> - Unique identifier (primary key)</li>
<li><code>AUTOINCREMENT</code> - Database automatically assigns next number</li>
<li><code>NOT NULL</code> - Field must have a value</li>
<li><code>UNIQUE</code> - No two users can have same username/email</li>
<li><code>DEFAULT CURRENT_TIMESTAMP</code> - Automatically sets creation time</li>
</ul>
<p><strong>Example: Create Posts Table with Foreign Key</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="n">author_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="n">category_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;draft&#39;</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="p">);</span>
</code></pre></div>
<p><strong>Foreign Key Explained:</strong></p>
<ul>
<li><code>FOREIGN KEY (author_id)</code> - This column links to another table</li>
<li><code>REFERENCES users(id)</code> - Links to the <code>id</code> column in <code>users</code> table</li>
<li><code>ON DELETE CASCADE</code> - If user deleted, their posts are also deleted<ul>
<li>most production databases will avoid <code>ON DELETE CASCADE</code> also called cascade delete as it can result in unexpected data being deleted when not intended</li>
<li>eg: Maybe you want the users data to be removed but it should be stored in a backup system for 5 years for policy reasons. The cascaade delete above could result in all of the data being deleted before backed up.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="activity-21-design-your-database-schema-we-do">Activity 2.1: Design Your Database Schema (WE DO)</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Create a complete database schema for a blog application</p>
<div class="admonition note">
<p class="admonition-title">Requirements</p>
<p>Design tables for:</p>
<ol>
<li>Users (authentication and profile)</li>
<li>Posts (blog content)</li>
<li>Comments (user feedback)</li>
<li>Categories (organising posts)</li>
</ol>
<p>Each table must have:</p>
<ul>
<li>Primary key</li>
<li>Appropriate data types</li>
<li>NOT NULL constraints where needed</li>
<li>Foreign keys for relationships</li>
</ul>
</div>
<p><strong>Starter Template:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">-- Users table</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="c1">-- Add more columns here</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">);</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1">-- Posts table</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="c1">-- Design this table</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="p">);</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="c1">-- Comments table</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">    </span><span class="c1">-- Design this table</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="p">);</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="c1">-- Categories table</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">    </span><span class="c1">-- Design this table</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="p">);</span>
</code></pre></div>
<p><strong>Guided Questions:</strong></p>
<ol>
<li>What information do we need to store about users?</li>
<li>What information do we need for each blog post?</li>
<li>How do we link a post to its author?</li>
<li>How do we link a comment to both the post and the commenter?</li>
</ol>
<details class="example">
<summary>Sample Solution</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="n">password_hash</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="n">bio</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="p">);</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="p">);</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="n">author_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w">    </span><span class="n">category_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;draft&#39;</span><span class="p">,</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">category_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">categories</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="p">);</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">    </span><span class="n">post_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">    </span><span class="n">content</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="p">);</span>
</code></pre></div>
</details>
<hr />
<h3 id="activity-22-create-your-database-you-do">Activity 2.2: Create Your Database (YOU DO)</h3>
<p><strong>Duration:</strong> 10 minutes</p>
<p><strong>Objective:</strong> Execute SQL statements to create your database structure</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Create a new file: <code>schema.sql</code></li>
<li>Write CREATE TABLE statements for all tables</li>
<li>Execute the schema file to create your database</li>
<li>Verify tables were created correctly</li>
</ol>
</div>
<p><strong>Step-by-Step:</strong></p>
<p><strong>1. Create <code>schema.sql</code>:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">-- schema.sql</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="c1">-- Database schema for blog application</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="c1">-- Your design from Activity 2.1</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">);</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="c1">-- Your design</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="p">);</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="c1">-- Your design</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="p">);</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="c1">-- Your design</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">);</span>
</code></pre></div></p>
<p><strong>2. Execute schema:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># SQLite</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>sqlite3<span class="w"> </span>blog_database.db<span class="w"> </span>&lt;<span class="w"> </span>schema.sql
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># PostgreSQL</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>psql<span class="w"> </span>-U<span class="w"> </span>username<span class="w"> </span>-d<span class="w"> </span>database_name<span class="w"> </span>-f<span class="w"> </span>schema.sql
</code></pre></div></p>
<p><strong>3. Verify tables exist:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">-- List all tables</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="p">.</span><span class="n">tables</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="c1">-- See structure of users table</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="p">.</span><span class="k">schema</span><span class="w"> </span><span class="n">users</span>
</code></pre></div></p>
<details class="success">
<summary>Success Criteria</summary>
<ul>
<li>All four tables created without errors</li>
<li>Each table has a primary key</li>
<li>Foreign keys properly reference other tables</li>
<li>You can view table structures with <code>.schema</code></li>
</ul>
</details>
<p><strong>Git Checkpoint:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>git<span class="w"> </span>add<span class="w"> </span>schema.sql
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add database schema for blog application</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="s2">- Create users table with authentication fields</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="s2">- Create posts table with foreign key to users</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="s2">- Create comments table with relationships</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="s2">- Create categories for post organisation&quot;</span>
</code></pre></div></p>
<hr />
<h2 id="content-part-3-sql-queries-and-crud-operations-we-do">Content Part 3: SQL Queries and CRUD Operations (WE DO)</h2>
<p><strong>Duration:</strong> 20-25 minutes | <strong>Bloom's Level:</strong> Apply | <strong>GRR:</strong> Guided practice</p>
<h3 id="sql-crud-operations">SQL CRUD Operations</h3>
<p>Now that we have tables, let's fill them with data and query them.</p>
<h3 id="create-insert-operations">CREATE: INSERT Operations</h3>
<p><strong>Insert Single Record:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password_hash</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;alice&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;alice@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$2b$12$hashed_password&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Insert Multiple Records:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">VALUES</span><span class="w"> </span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Technology&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Posts about tech&#39;</span><span class="p">),</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Travel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Travel experiences&#39;</span><span class="p">),</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Food&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Recipes and reviews&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Insert with Returning ID (PostgreSQL):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password_hash</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bob@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$2b$12$hash&#39;</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">RETURNING</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="read-select-operations">READ: SELECT Operations</h3>
<p>A <strong>query</strong> is a request for data from the database.</p>
<p><strong>Select Everything:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1">-- Get all columns from all users</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="p">;</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Avoid SELECT *</p>
<p>In production, specify exact columns you need. <code>SELECT *</code> is slower and retrieves unnecessary data.</p>
</div>
<p><strong>Select Specific Columns:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">-- Get only usernames and emails</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>WHERE Clause - Filtering Results:</strong></p>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Meaning</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>=</code></td>
<td>Equal to</td>
<td><code>WHERE age = 25</code></td>
</tr>
<tr>
<td><code>!=</code> or <code>&lt;&gt;</code></td>
<td>Not equal</td>
<td><code>WHERE status != 'deleted'</code></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>Greater than</td>
<td><code>WHERE age &gt; 18</code></td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>Less than</td>
<td><code>WHERE price &lt; 100</code></td>
</tr>
<tr>
<td><code>&gt;=</code></td>
<td>Greater or equal</td>
<td><code>WHERE age &gt;= 18</code></td>
</tr>
<tr>
<td><code>&lt;=</code></td>
<td>Less or equal</td>
<td><code>WHERE stock &lt;= 10</code></td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>Pattern match</td>
<td><code>WHERE name LIKE 'A%'</code></td>
</tr>
<tr>
<td><code>IN</code></td>
<td>Match list</td>
<td><code>WHERE country IN ('AU', 'NZ')</code></td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>Range</td>
<td><code>WHERE age BETWEEN 18 AND 65</code></td>
</tr>
<tr>
<td><code>AND</code></td>
<td>Both conditions</td>
<td><code>WHERE age &gt; 18 AND country = 'AU'</code></td>
</tr>
<tr>
<td><code>OR</code></td>
<td>Either condition</td>
<td><code>WHERE country = 'AU' OR country = 'NZ'</code></td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">-- Single condition</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Australia&#39;</span><span class="p">;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="c1">-- Multiple conditions</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Australia&#39;</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="c1">-- Pattern matching</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%@gmail.com&#39;</span><span class="p">;</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="c1">-- List matching</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;featured&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>ORDER BY - Sorting Results:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">-- Newest posts first</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1">-- Oldest posts first</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="c1">-- Multiple sort criteria</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">category_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>LIMIT - Restricting Results:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">-- Get 10 most recent posts</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="c1">-- Pagination: Skip first 10, get next 10</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>GROUP BY - Data Aggregation:</strong></p>
<p><strong>GROUP BY</strong> groups rows with same values, allowing calculations on each group.</p>
<p><strong>Common Aggregate Functions:</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>COUNT()</code></td>
<td>Count rows</td>
<td><code>SELECT COUNT(*) FROM users</code></td>
</tr>
<tr>
<td><code>SUM()</code></td>
<td>Add values</td>
<td><code>SELECT SUM(price) FROM orders</code></td>
</tr>
<tr>
<td><code>AVG()</code></td>
<td>Average</td>
<td><code>SELECT AVG(age) FROM users</code></td>
</tr>
<tr>
<td><code>MIN()</code></td>
<td>Minimum</td>
<td><code>SELECT MIN(price) FROM products</code></td>
</tr>
<tr>
<td><code>MAX()</code></td>
<td>Maximum</td>
<td><code>SELECT MAX(salary) FROM employees</code></td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">-- Count posts per user</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">post_count</span><span class="w"> </span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">author_id</span><span class="p">;</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="c1">-- Average comments per post</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">post_id</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_rating</span><span class="w"> </span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">post_id</span><span class="p">;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="c1">-- Posts per category</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">post_count</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="k">FROM</span><span class="w"> </span><span class="n">categories</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">category_id</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="update-modifying-data">UPDATE: Modifying Data</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">-- Update single field</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">SET</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;newemail@example.com&#39;</span><span class="w"> </span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="c1">-- Update multiple fields</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="k">SET</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;New Title&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">updated_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="c1">-- Conditional update</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="k">SET</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;archived&#39;</span><span class="w"> </span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">;</span>
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Always Use WHERE with UPDATE</p>
<p>Without WHERE clause, you'll update <strong>EVERY</strong> record in the table!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">--  DANGER: Updates ALL users!</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Australia&#39;</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="c1">--  CORRECT: Updates only one user</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Australia&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<h3 id="delete-removing-data">DELETE: Removing Data</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1">-- Delete specific record</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="c1">-- Delete based on condition</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;spam&#39;</span><span class="p">;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="c1">-- Delete old records</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sessions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">DATE</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-30 days&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Always Use WHERE with DELETE</p>
<p>Without WHERE clause, you'll delete <strong>EVERYTHING</strong> in the table!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">--  DANGER: Deletes ALL posts!</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="p">;</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="c1">--  CORRECT: Deletes only spam</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;spam&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<hr />
<h3 id="activity-31-practice-crud-operations-we-do">Activity 3.1: Practice CRUD Operations (WE DO)</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Write SQL queries for common database operations</p>
<div class="admonition note">
<p class="admonition-title">Complete These Tasks</p>
<p>Work through each task, writing and executing SQL queries.</p>
</div>
<p><strong>Task 1: INSERT - Create Data</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">-- 1. Insert yourself as a user</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password_hash</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;your_username&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;your_email@example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;temp_hash&#39;</span><span class="p">);</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="c1">-- 2. Insert a category</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Tutorial&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Educational content&#39;</span><span class="p">);</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="c1">-- 3. Insert a post (use your user_id and category_id)</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;My First Post&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Hello database world!&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Task 2: SELECT - Read Data</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">-- 4. Get all published posts</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1">-- Your query here</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="c1">-- 5. Find posts by a specific author</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="c1">-- Your query here</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="c1">-- 6. Count total users</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="c1">-- Your query here</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="c1">-- 7. Get 5 most recent posts</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="c1">-- Your query here</span>
</code></pre></div></p>
<p><strong>Task 3: UPDATE - Modify Data</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">-- 8. Update your user&#39;s bio</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="c1">-- Your query here</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="c1">-- 9. Change a post&#39;s status to &#39;published&#39;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="c1">-- Your query here</span>
</code></pre></div></p>
<p><strong>Task 4: DELETE - Remove Data</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">-- 10. Delete a specific comment (create one first!)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="c1">-- Your query here</span>
</code></pre></div></p>
<details class="example">
<summary>Sample Solutions</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">-- Task 2.4: Get all published posts</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="p">;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="c1">-- Task 2.5: Posts by specific author</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="c1">-- Task 2.6: Count total users</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">user_count</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="p">;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="c1">-- Task 2.7: 5 most recent posts</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="c1">-- Task 3.8: Update bio</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">bio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Aspiring developer&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="c1">-- Task 3.9: Publish post</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="k">UPDATE</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;published&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">updated_at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="c1">-- Task 4.10: Delete comment</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
</details>
<hr />
<h3 id="activity-32-table-joins-we-do">Activity 3.2: Table Joins (WE DO)</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Combine data from multiple tables using JOINs</p>
<h3 id="understanding-joins">Understanding JOINs</h3>
<p>A <strong>JOIN</strong> combines rows from two or more tables based on related columns.</p>
<pre class="mermaid"><code>graph LR
    A[Posts Table] --&gt;|author_id| B[JOIN]
    C[Users Table] --&gt;|id| B
    B --&gt; D[Combined Result]

    style B fill:#4caf50</code></pre>
<h3 id="join-types-visual-guide">JOIN Types Visual Guide</h3>
<pre class="mermaid"><code>graph TD
    A[JOIN Types] --&gt; B[INNER JOIN]
    A --&gt; C[LEFT JOIN]
    A --&gt; D[RIGHT JOIN]
    A --&gt; E[FULL OUTER JOIN]

    B --&gt; F[Only matching records from both tables]
    C --&gt; G[All from left table + matches from right]
    D --&gt; H[All from right table + matches from left]
    E --&gt; I[All records from both tables]

    style A fill:#2196f3
    style B fill:#4caf50
    style C fill:#ff9800
    style D fill:#ff9800
    style E fill:#f44336</code></pre>
<p><strong>INNER JOIN - Only Matching Records:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">-- Get posts with their author names</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">username</span><span class="w"> </span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>
<p><strong>Result:</strong> Only posts that have a valid author (orphaned posts excluded)</p>
<p><strong>LEFT JOIN - All From Left Table:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1">-- Get all users and their post count (including users with 0 posts)</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">post_count</span><span class="w"> </span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>
<p><strong>Result:</strong> Every user appears, even users who haven't posted (post_count = 0)</p>
<p><strong>Complex JOIN Example:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">-- Posts with authors and categories</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="k">SELECT</span><span class="w"> </span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="n">posts</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="n">users</span><span class="p">.</span><span class="n">username</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">author</span><span class="p">,</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="n">categories</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">category</span><span class="p">,</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">comments</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">comment_count</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">categories</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">category_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">id</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comments</span><span class="p">.</span><span class="n">post_id</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Old Style Comma Table Join</p>
<p>There is an older style of join using commas. It should be avoided as it doesn't give you as much control over your queries and can impact readabilty of your queries, especilly if they are large. You should still be able to understand this format as it will be used in some cases.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">title</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">posts</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span>
</code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Practice Tasks</p>
<p>Complete these JOIN queries:</p>
<ol>
<li>Get all posts with author names and emails</li>
<li>Find all users who have never posted</li>
<li>Get posts with comment count</li>
<li>List categories with their post count</li>
</ol>
</div>
<details class="example">
<summary>Sample Solutions</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">-- 1. Posts with author details</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">email</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="c1">-- 2. Users who never posted</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">username</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">author_id</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="c1">-- 3. Posts with comment count</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">comments</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">comments</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comments</span><span class="p">.</span><span class="n">post_id</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="c1">-- 4. Categories with post count</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">posts</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">post_count</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="k">FROM</span><span class="w"> </span><span class="n">categories</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posts</span><span class="p">.</span><span class="n">category_id</span>
<a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">categories</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></div>
</details>
<hr />
<h2 id="4-sql-injection-and-security">4: SQL Injection and Security</h2>
<p><strong>Duration:</strong> 20-25 minutes | <strong>Bloom's Level:</strong> Analyse, Evaluate | <strong>GRR:</strong> Guided critical thinking</p>
<h3 id="what-is-sql-injection">What is SQL Injection?</h3>
<p><strong>SQL Injection</strong> is a code injection attack where attackers insert malicious SQL code through user input, allowing them to manipulate or access the database. It's the <strong>#5 web application vulnerability</strong> (<a href="https://owasp.org/Top10/2025/">OWASP Top 10</a>).</p>
<div class="admonition danger">
<p class="admonition-title">Critical Security Vulnerability</p>
<p>SQL injection can:</p>
<ul>
<li>Bypass authentication (log in without password)</li>
<li>Steal all data from database</li>
<li>Delete entire database</li>
<li>Modify data</li>
<li>Execute system commands</li>
</ul>
</div>
<h3 id="how-sql-injection-works">How SQL Injection Works</h3>
<p><strong>Vulnerable Code (NEVER DO THIS):</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># User provides input</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>  <span class="c1"># User types: alice</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>  <span class="c1"># User types: password123</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="c1"># String concatenation builds SQL query (DANGEROUS!)</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username = &#39;&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;&#39; AND password = &#39;&quot;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="c1"># Execute query</span>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>
<p><strong>Normal Use:</strong></p>
<ul>
<li>User enters: username = <code>alice</code>, password = <code>password123</code></li>
<li>Resulting query: <code>SELECT * FROM users WHERE username = 'alice' AND password = 'password123'</code></li>
<li>Works as intended </li>
</ul>
<p><strong>Malicious Use - Attack #1: Authentication Bypass:</strong></p>
<ul>
<li>Attacker enters: username = <code>admin' OR '1'='1</code>, password = <code>anything</code></li>
<li>Resulting query: <code>SELECT * FROM users WHERE username = 'admin' OR '1'='1' AND password = 'anything'</code></li>
<li>Because <code>'1'='1'</code> is always true, query returns ALL users!</li>
<li>Attacker logs in as admin without knowing password! </li>
</ul>
<pre class="mermaid"><code>sequenceDiagram
    participant A as Attacker
    participant F as Login Form
    participant S as Server
    participant D as Database

    A-&gt;&gt;F: Username: admin' OR '1'='1
    F-&gt;&gt;S: Send malicious input
    S-&gt;&gt;D: SELECT * FROM users WHERE username='admin' OR '1'='1'
    D-&gt;&gt;S: Returns ALL users (query is true!)
    S-&gt;&gt;A: Welcome, Admin!

    Note over D: SQL injection successful!</code></pre>
<p><strong>Attack #2: Database Destruction:</strong></p>
<ul>
<li>Attacker enters: username = <code>admin'; DROP TABLE users;--</code>, password = <code>anything</code></li>
<li>Resulting query becomes:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">;</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="c1">--&#39; AND password = &#39;anything&#39;</span>
</code></pre></div></li>
<li>First query: Selects admin user</li>
<li>Second query: <strong>Deletes entire users table!</strong></li>
<li><code>--</code> comments out rest of query</li>
<li>Entire user database destroyed! </li>
</ul>
<p><strong>Attack #3: Data Theft:</strong></p>
<ul>
<li>Attacker enters: username = <code>' UNION SELECT credit_card_number FROM payments--</code>, password = <code>x</code></li>
<li>Resulting query:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="k">UNION</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">credit_card_number</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">payments</span><span class="c1">--&#39;</span>
</code></pre></div></li>
<li>Steals all credit card numbers from payments table! </li>
</ul>
<h3 id="real-world-sql-injection-damage">Real-World SQL Injection Damage</h3>
<table>
<thead>
<tr>
<th>Incident</th>
<th>Year</th>
<th>Impact</th>
<th>Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TalkTalk</strong></td>
<td>2015</td>
<td>157,000 customers' data stolen via SQL injection</td>
<td>400,000 fine + 77 million total costs</td>
</tr>
<tr>
<td><strong>Heartland Payment</strong></td>
<td>2008</td>
<td>130 million credit cards exposed</td>
<td>Approximately 110 million</td>
</tr>
<tr>
<td><strong>Sony Pictures</strong></td>
<td>2011</td>
<td>1 million accounts compromised</td>
<td>Immeasurable reputation damage</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="activity-41-create-vulnerable-code">Activity 4.1: Create Vulnerable Code</h3>
<p><strong>Duration:</strong> 10 minutes</p>
<p><strong>Objective:</strong> Understand SQL injection by creating and attacking vulnerable code</p>
<div class="admonition danger">
<p class="admonition-title">Controlled Environment Only</p>
<p>This is for learning purposes only. NEVER deploy this code!</p>
</div>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Create deliberately vulnerable login system</li>
<li>Attack your own code with SQL injection</li>
<li>Witness the danger firsthand</li>
<li>Understand why this is critical</li>
</ol>
</div>
<p><strong>Step 1: Create Vulnerable Login (demonstration.py)</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># demonstration.py - VULNERABLE CODE FOR LEARNING ONLY</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">vulnerable_login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;DO NOT USE IN PRODUCTION - DEMONSTRATION ONLY&quot;&quot;&quot;</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;demo.db&#39;</span><span class="p">)</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>    <span class="c1"># VULNERABLE: String concatenation</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username = &#39;&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;&#39; AND password = &#39;&quot;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Login successful! Welcome </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Login failed&quot;</span><span class="p">)</span>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>
<a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a><span class="c1"># Test normal login</span>
<a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Normal Login ===&quot;</span><span class="p">)</span>
<a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a><span class="n">vulnerable_login</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;password123&quot;</span><span class="p">)</span>
<a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>
<a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a><span class="c1"># Test SQL injection attack</span>
<a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== SQL Injection Attack ===&quot;</span><span class="p">)</span>
<a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a><span class="n">vulnerable_login</span><span class="p">(</span><span class="s2">&quot;admin&#39; OR &#39;1&#39;=&#39;1&quot;</span><span class="p">,</span> <span class="s2">&quot;anything&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Step 2: Run and Observe</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>python<span class="w"> </span>demonstration.py
</code></pre></div>
<p><strong>Expected Output:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>=== Normal Login ===
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>Executing query: SELECT * FROM users WHERE username = &#39;alice&#39; AND password = &#39;password123&#39;
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a> Login failed
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>=== SQL Injection Attack ===
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>Executing query: SELECT * FROM users WHERE username = &#39;admin&#39; OR &#39;1&#39;=&#39;1&#39; AND password = &#39;anything&#39;
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a> Login successful! Welcome admin
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Analysis Questions</p>
<ol>
<li>Why did the attack succeed?</li>
<li>What does <code>'1'='1'</code> mean to the database?</li>
<li>How does the <code>--</code> comment work in attacks?</li>
<li>What damage could this cause in a real application?</li>
</ol>
</div>
<details class="success">
<summary>Understanding the Attack</summary>
<ul>
<li>The query sees <code>'1'='1'</code> as part of the WHERE condition</li>
<li><code>'1'='1'</code> is always TRUE in SQL</li>
<li>The OR operator means "username = 'admin'" OR "TRUE"</li>
<li>TRUE OR anything = TRUE</li>
<li>Query returns all users, attacker bypasses authentication</li>
</ul>
</details>
<hr />
<h3 id="activity-42-fix-with-prepared-statements">Activity 4.2: Fix with Prepared Statements</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Implement proper SQL injection defence</p>
<h3 id="the-solution-prepared-statements">The Solution: Prepared Statements</h3>
<p>A <strong>prepared statement</strong> (also called <strong>parameterised query</strong>) separates SQL code from user data.</p>
<p><strong>How It Works:</strong></p>
<pre class="mermaid"><code>graph LR
    A[SQL Template] --&gt; B[Database Pre-compiles]
    C[User Data] --&gt; D[Sent as Parameters]
    B --&gt; E[Safe Execution]
    D --&gt; E

    style A fill:#4caf50
    style C fill:#2196f3
    style E fill:#4caf50</code></pre>
<ol>
<li>SQL query written with placeholders (<code>?</code> or named parameters)</li>
<li>Database compiles query template</li>
<li>User data sent separately as parameters</li>
<li>Database treats parameters as pure data, never as SQL code</li>
</ol>
<p><strong>Secure Code with Prepared Statements:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># secure_login.py - PROPER IMPLEMENTATION</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">secure_login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SECURE: Uses prepared statements&quot;&quot;&quot;</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;demo.db&#39;</span><span class="p">)</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>    <span class="c1"># SECURE: Prepared statement with placeholders</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query template: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>    <span class="c1"># Execute with parameters passed separately</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
<a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Login successful! Welcome </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Login failed&quot;</span><span class="p">)</span>
<a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a>
<a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a>
<a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a><span class="c1"># Test normal login</span>
<a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Normal Login ===&quot;</span><span class="p">)</span>
<a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a><span class="n">secure_login</span><span class="p">(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;password123&quot;</span><span class="p">)</span>
<a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a>
<a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a><span class="c1"># Test SQL injection attempt (now fails safely)</span>
<a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== SQL Injection Attempt (Blocked) ===&quot;</span><span class="p">)</span>
<a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a><span class="n">secure_login</span><span class="p">(</span><span class="s2">&quot;admin&#39; OR &#39;1&#39;=&#39;1&quot;</span><span class="p">,</span> <span class="s2">&quot;anything&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Expected Output:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>=== Normal Login ===
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>Query template: SELECT * FROM users WHERE username = ? AND password = ?
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>Parameters: alice, password123
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a> Login failed (correct - user doesn&#39;t exist yet)
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>=== SQL Injection Attempt (Blocked) ===
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>Query template: SELECT * FROM users WHERE username = ? AND password = ?
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>Parameters: admin&#39; OR &#39;1&#39;=&#39;1, anything
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a> Login failed (attack blocked - treated as literal username!)
</code></pre></div></p>
<p><strong>Why This Works:</strong></p>
<table>
<thead>
<tr>
<th>Vulnerable Code</th>
<th>Prepared Statement</th>
</tr>
</thead>
<tbody>
<tr>
<td>User input <strong>concatenated</strong> into SQL</td>
<td>User input <strong>separated</strong> from SQL</td>
</tr>
<tr>
<td>Database sees input as <strong>code</strong></td>
<td>Database sees input as <strong>pure data</strong></td>
</tr>
<tr>
<td><code>'</code>, <code>;</code>, <code>--</code> have special meaning</td>
<td>Special characters <strong>automatically escaped</strong></td>
</tr>
<tr>
<td>Attacker can inject commands</td>
<td>Attacker input treated <strong>literally</strong></td>
</tr>
</tbody>
</table>
<div class="admonition success">
<p class="admonition-title">Key Principle</p>
<p>Prepared statements ensure user input is <strong>NEVER</strong> interpreted as SQL code, only as data values.</p>
</div>
<hr />
<h3 id="activity-43-secure-your-application">Activity 4.3: Secure Your Application</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Replace all string concatenation with prepared statements</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Review your <a href="../server_side_programming_authentication_template_engines/">Server Side Programming</a> authentication code</li>
<li>Identify all SQL queries</li>
<li>Convert to prepared statements</li>
<li>Test with malicious inputs</li>
<li>Verify attacks now fail</li>
</ol>
</div>
<p><strong>Task 1: Secure Registration</strong></p>
<p><strong>Before (Vulnerable):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>    <span class="c1"># VULNERABLE</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO users (username, email, password_hash) VALUES (&#39;&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s2">&quot;&#39;, &#39;&quot;</span> <span class="o">+</span> <span class="n">password_hash</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>After (Secure):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>    <span class="c1"># Hash password first</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>    <span class="n">password_hash</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>    <span class="c1"># SECURE: Prepared statement</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)&quot;</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password_hash</span><span class="p">))</span>
<a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
<a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Username or email already exists</span>
</code></pre></div></p>
<p><strong>Task 2: Secure Login</strong></p>
<p><strong>Before (Vulnerable):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username = &#39;&quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>After (Secure):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, username, password_hash FROM users WHERE username = ?&quot;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">checkpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">user</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></p>
<p><strong>Task 3: Secure All Other Queries</strong></p>
<p>Find and fix:</p>
<ul>
<li>Post creation</li>
<li>Post updates</li>
<li>Comment insertion</li>
<li>User profile queries</li>
<li>Any other database operations</li>
</ul>
<p><strong>Security Checklist:</strong></p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> All queries use <code>?</code> placeholders</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> No string concatenation with user input</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Parameters passed as tuple to <code>execute()</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Tested with malicious inputs like <code>' OR '1'='1</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> All attacks now fail safely</li>
</ul>
<details class="example">
<summary>Complete Secure Example</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">bcrypt</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecureDatabase</span><span class="p">:</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">):</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely register new user&quot;&quot;&quot;</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>        <span class="n">password_hash</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)&quot;</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password_hash</span><span class="p">))</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a>        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">login_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely authenticate user&quot;&quot;&quot;</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT id, username, password_hash FROM users WHERE username = ?&quot;</span>
<a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
<a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a>
<a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a>        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-62-29" name="__codelineno-62-29" href="#__codelineno-62-29"></a>
<a id="__codelineno-62-30" name="__codelineno-62-30" href="#__codelineno-62-30"></a>        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">checkpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;password_hash&#39;</span><span class="p">]):</span>
<a id="__codelineno-62-31" name="__codelineno-62-31" href="#__codelineno-62-31"></a>            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]}</span>
<a id="__codelineno-62-32" name="__codelineno-62-32" href="#__codelineno-62-32"></a>        <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-62-33" name="__codelineno-62-33" href="#__codelineno-62-33"></a>
<a id="__codelineno-62-34" name="__codelineno-62-34" href="#__codelineno-62-34"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">author_id</span><span class="p">,</span> <span class="n">category_id</span><span class="p">):</span>
<a id="__codelineno-62-35" name="__codelineno-62-35" href="#__codelineno-62-35"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely create post&quot;&quot;&quot;</span>
<a id="__codelineno-62-36" name="__codelineno-62-36" href="#__codelineno-62-36"></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-62-37" name="__codelineno-62-37" href="#__codelineno-62-37"></a><span class="s2">            INSERT INTO posts (title, content, author_id, category_id, status) </span>
<a id="__codelineno-62-38" name="__codelineno-62-38" href="#__codelineno-62-38"></a><span class="s2">            VALUES (?, ?, ?, ?, &#39;draft&#39;)</span>
<a id="__codelineno-62-39" name="__codelineno-62-39" href="#__codelineno-62-39"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-62-40" name="__codelineno-62-40" href="#__codelineno-62-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">author_id</span><span class="p">,</span> <span class="n">category_id</span><span class="p">))</span>
<a id="__codelineno-62-41" name="__codelineno-62-41" href="#__codelineno-62-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-62-42" name="__codelineno-62-42" href="#__codelineno-62-42"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
<a id="__codelineno-62-43" name="__codelineno-62-43" href="#__codelineno-62-43"></a>
<a id="__codelineno-62-44" name="__codelineno-62-44" href="#__codelineno-62-44"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_posts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-62-45" name="__codelineno-62-45" href="#__codelineno-62-45"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely get user&#39;s posts&quot;&quot;&quot;</span>
<a id="__codelineno-62-46" name="__codelineno-62-46" href="#__codelineno-62-46"></a>        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-62-47" name="__codelineno-62-47" href="#__codelineno-62-47"></a><span class="s2">            SELECT posts.*, users.username </span>
<a id="__codelineno-62-48" name="__codelineno-62-48" href="#__codelineno-62-48"></a><span class="s2">            FROM posts </span>
<a id="__codelineno-62-49" name="__codelineno-62-49" href="#__codelineno-62-49"></a><span class="s2">            INNER JOIN users ON posts.author_id = users.id </span>
<a id="__codelineno-62-50" name="__codelineno-62-50" href="#__codelineno-62-50"></a><span class="s2">            WHERE author_id = ?</span>
<a id="__codelineno-62-51" name="__codelineno-62-51" href="#__codelineno-62-51"></a><span class="s2">            ORDER BY created_at DESC</span>
<a id="__codelineno-62-52" name="__codelineno-62-52" href="#__codelineno-62-52"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-62-53" name="__codelineno-62-53" href="#__codelineno-62-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,))</span>
<a id="__codelineno-62-54" name="__codelineno-62-54" href="#__codelineno-62-54"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-62-55" name="__codelineno-62-55" href="#__codelineno-62-55"></a>
<a id="__codelineno-62-56" name="__codelineno-62-56" href="#__codelineno-62-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-62-57" name="__codelineno-62-57" href="#__codelineno-62-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</details>
<p><strong>Git Checkpoint:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>git<span class="w"> </span>add<span class="w"> </span>.
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Fix SQL injection vulnerabilities</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="s2">- Replace all string concatenation with prepared statements</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="s2">- Add input validation</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="s2">- Test confirms attacks now fail</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="s2">- All queries use parameterised statements&quot;</span>
</code></pre></div></p>
<hr />
<h2 id="5-performance-indexing-backups">5: Performance, Indexing &amp; Backups</h2>
<p><strong>Duration:</strong> 20-25 minutes | <strong>Bloom's Level:</strong> Apply, Analyse | <strong>GRR:</strong> Guided application</p>
<h3 id="database-performance-and-indexing">Database Performance and Indexing</h3>
<p>As your database grows, query performance becomes critical. An <strong>index</strong> dramatically speeds up data retrieval.</p>
<h3 id="what-is-an-index">What is an Index?</h3>
<p>Think of a database index like a book's index - instead of reading every page to find a topic, you check the index and jump directly to the right page.</p>
<pre class="mermaid"><code>graph TD
    A[Query: Find user with email='alice@example.com'] --&gt; B{Index Exists?}
    B --&gt;|No Index| C[Scan ALL Rows]
    B --&gt;|With Index| D[Jump Directly to Row]

    C --&gt; E[1,000,000 rows checked]
    D --&gt; F[~20 checks via index tree]

    style C fill:#f44336
    style D fill:#4caf50</code></pre>
<p><strong>Performance Comparison:</strong></p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Without Index</th>
<th>With Index</th>
</tr>
</thead>
<tbody>
<tr>
<td>Find user by email in 1M users</td>
<td>1,000,000 row scans</td>
<td>~20 checks</td>
</tr>
<tr>
<td>Query time</td>
<td>Seconds</td>
<td>Milliseconds</td>
</tr>
<tr>
<td>Growth rate</td>
<td>Linear (gets slower proportionally)</td>
<td>Logarithmic (barely slows down)</td>
</tr>
</tbody>
</table>
<h3 id="when-to-create-indexes">When to Create Indexes</h3>
<p><strong>Create indexes on columns you:</strong></p>
<ul>
<li>Search frequently (WHERE clauses)</li>
<li>Sort by (ORDER BY)</li>
<li>Join on (JOIN conditions)</li>
<li>Use in GROUP BY</li>
</ul>
<p><strong>Common index candidates:</strong></p>
<ul>
<li>Primary keys (automatically indexed)</li>
<li>Foreign keys (should be indexed)</li>
<li>Email addresses (frequent lookups)</li>
<li>Usernames (frequent searches)</li>
<li>Timestamps (for sorting/filtering)</li>
</ul>
<p><strong>Don't index:</strong></p>
<ul>
<li>Small tables (&lt; 1000 rows)</li>
<li>Columns with many duplicate values</li>
<li>Columns that change frequently</li>
</ul>
<h3 id="creating-indexes">Creating Indexes</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1">-- Index on email for fast login lookups</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="c1">-- Index on foreign key for fast JOINs</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_author</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">author_id</span><span class="p">);</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="c1">-- Index on timestamp for sorting</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_created</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="c1">-- Composite index (multiple columns)</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_status_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
</code></pre></div>
<h3 id="query-optimisation">Query Optimisation</h3>
<p><strong>Bad Query (Slow):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1">-- Gets all columns from all posts (inefficient)</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>Good Query (Fast):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1">-- Gets only needed columns with limit</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;published&#39;</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div></p>
<p><strong>Use EXPLAIN to Analyse Queries:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">EXPLAIN</span><span class="w"> </span><span class="n">QUERY</span><span class="w"> </span><span class="n">PLAN</span><span class="w"> </span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alice@example.com&#39;</span><span class="p">;</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="c1">-- Without index: SCAN TABLE users</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="c1">-- With index: SEARCH TABLE users USING INDEX idx_users_email</span>
</code></pre></div>
<hr />
<h3 id="activity-51-measure-index-performance">Activity 5.1: Measure Index Performance</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> See the dramatic performance improvement from indexing</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Create large test dataset (10,000 users)</li>
<li>Measure query time without index</li>
<li>Create index</li>
<li>Measure query time with index</li>
<li>Compare performance improvement</li>
</ol>
</div>
<p><strong>Step 1: Generate Test Data</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="c1"># generate_test_data.py</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;blog_database.db&#39;</span><span class="p">)</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating 10,000 test users...&quot;</span><span class="p">)</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>    <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>    <span class="n">email</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@example.com&quot;</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>    <span class="n">password_hash</span> <span class="o">=</span> <span class="s2">&quot;dummy_hash_for_testing&quot;</span>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a>
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>            <span class="s2">&quot;INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
<a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a>            <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password_hash</span><span class="p">)</span>
<a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a>        <span class="p">)</span>
<a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a>    <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
<a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a>        <span class="k">pass</span>  <span class="c1"># Skip duplicates</span>
<a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a>
<a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a>
<a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created test users in </span><span class="si">{</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-68-30" name="__codelineno-68-30" href="#__codelineno-68-30"></a><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p><strong>Step 2: Measure Without Index</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># test_performance.py</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;blog_database.db&#39;</span><span class="p">)</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="c1"># Get a random email to search for</span>
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT email FROM users ORDER BY RANDOM() LIMIT 1&quot;</span><span class="p">)</span>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="n">test_email</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
<a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for: </span><span class="si">{</span><span class="n">test_email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-13" name="__codelineno-69-13" href="#__codelineno-69-13"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== WITHOUT INDEX ===&quot;</span><span class="p">)</span>
<a id="__codelineno-69-14" name="__codelineno-69-14" href="#__codelineno-69-14"></a>
<a id="__codelineno-69-15" name="__codelineno-69-15" href="#__codelineno-69-15"></a><span class="c1"># Measure query time</span>
<a id="__codelineno-69-16" name="__codelineno-69-16" href="#__codelineno-69-16"></a><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-69-17" name="__codelineno-69-17" href="#__codelineno-69-17"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE email = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">test_email</span><span class="p">,))</span>
<a id="__codelineno-69-18" name="__codelineno-69-18" href="#__codelineno-69-18"></a><span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-69-19" name="__codelineno-69-19" href="#__codelineno-69-19"></a><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-69-20" name="__codelineno-69-20" href="#__codelineno-69-20"></a>
<a id="__codelineno-69-21" name="__codelineno-69-21" href="#__codelineno-69-21"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query time: </span><span class="si">{</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">)</span>
<a id="__codelineno-69-22" name="__codelineno-69-22" href="#__codelineno-69-22"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not found&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-23" name="__codelineno-69-23" href="#__codelineno-69-23"></a>
<a id="__codelineno-69-24" name="__codelineno-69-24" href="#__codelineno-69-24"></a><span class="c1"># Check query plan</span>
<a id="__codelineno-69-25" name="__codelineno-69-25" href="#__codelineno-69-25"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;EXPLAIN QUERY PLAN SELECT * FROM users WHERE email = ?&quot;</span><span class="p">)</span>
<a id="__codelineno-69-26" name="__codelineno-69-26" href="#__codelineno-69-26"></a><span class="n">plan</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-69-27" name="__codelineno-69-27" href="#__codelineno-69-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query plan: </span><span class="si">{</span><span class="n">plan</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-28" name="__codelineno-69-28" href="#__codelineno-69-28"></a>
<a id="__codelineno-69-29" name="__codelineno-69-29" href="#__codelineno-69-29"></a><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p><strong>Step 3: Create Index</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1">-- Create index on email column</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
</code></pre></div>
<p><strong>Step 4: Measure With Index</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1"># test_performance.py (continued)</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== WITH INDEX ===&quot;</span><span class="p">)</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="c1"># Recreate index</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)&quot;</span><span class="p">)</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="c1"># Measure again</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM users WHERE email = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">test_email</span><span class="p">,))</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query time: </span><span class="si">{</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">)</span>
<a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Not found&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a>
<a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="c1"># Check query plan</span>
<a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;EXPLAIN QUERY PLAN SELECT * FROM users WHERE email = ?&quot;</span><span class="p">)</span>
<a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="n">plan</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query plan: </span><span class="si">{</span><span class="n">plan</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Expected Results:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>=== WITHOUT INDEX ===
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>Query time: 15.23 milliseconds
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>Query plan: SCAN TABLE users
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>=== WITH INDEX ===
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>Query time: 0.45 milliseconds
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>Query plan: SEARCH TABLE users USING INDEX idx_users_email
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>Performance improvement: 33x faster!
</code></pre></div>
<p><strong>Document Your Findings:</strong></p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Without Index</th>
<th>With Index</th>
<th>Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Query time</td>
<td>___ ms</td>
<td>___ ms</td>
<td>___x faster</td>
</tr>
<tr>
<td>Query plan</td>
<td>SCAN TABLE</td>
<td>SEARCH USING INDEX</td>
<td></td>
</tr>
<tr>
<td>Rows scanned</td>
<td>10,000</td>
<td>~1</td>
<td></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="shell-scripts-for-database-backups">Shell Scripts for Database Backups</h3>
<p><strong>Why Backups Matter:</strong></p>
<ul>
<li>Hardware failures</li>
<li>Human errors (accidental deletions)</li>
<li>Security breaches</li>
<li>Data corruption</li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Critical Rule</p>
<p>A backup you haven't tested is not a backup at all!</p>
</div>
<h3 id="the-3-2-1-backup-rule">The 3-2-1 Backup Rule</h3>
<ul>
<li><strong>3</strong> copies of your data</li>
<li><strong>2</strong> different media types</li>
<li><strong>1</strong> copy offsite</li>
</ul>
<h3 id="creating-backup-scripts">Creating Backup Scripts</h3>
<p><strong>Basic Backup Script (Bash):</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="c1"># backup_database.sh - Automated database backup</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="c1"># Configuration</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="nv">DB_NAME</span><span class="o">=</span><span class="s2">&quot;blog_database.db&quot;</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;./backups&quot;</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="nv">BACKUP_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/backup_</span><span class="nv">$DATE</span><span class="s2">.db&quot;</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="c1"># Create backup directory if needed</span>
<a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$BACKUP_DIR</span>
<a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>
<a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a><span class="c1"># Perform backup</span>
<a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Starting backup...&quot;</span>
<a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a>sqlite3<span class="w"> </span><span class="nv">$DB_NAME</span><span class="w"> </span><span class="s2">&quot;.backup &#39;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>
<a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a><span class="c1"># Compress to save space</span>
<a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a>gzip<span class="w"> </span><span class="nv">$BACKUP_FILE</span>
<a id="__codelineno-73-19" name="__codelineno-73-19" href="#__codelineno-73-19"></a>
<a id="__codelineno-73-20" name="__codelineno-73-20" href="#__codelineno-73-20"></a><span class="c1"># Keep only last 7 days</span>
<a id="__codelineno-73-21" name="__codelineno-73-21" href="#__codelineno-73-21"></a>find<span class="w"> </span><span class="nv">$BACKUP_DIR</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;backup_*.db.gz&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-delete
<a id="__codelineno-73-22" name="__codelineno-73-22" href="#__codelineno-73-22"></a>
<a id="__codelineno-73-23" name="__codelineno-73-23" href="#__codelineno-73-23"></a><span class="c1"># Log completion</span>
<a id="__codelineno-73-24" name="__codelineno-73-24" href="#__codelineno-73-24"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup completed: </span><span class="si">${</span><span class="nv">BACKUP_FILE</span><span class="si">}</span><span class="s2">.gz&quot;</span>
<a id="__codelineno-73-25" name="__codelineno-73-25" href="#__codelineno-73-25"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="k">)</span><span class="s2">: Backup successful&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/backup.log
</code></pre></div>
<p><strong>Make Script Executable:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>backup_database.sh
</code></pre></div></p>
<p><strong>Run Backup:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>./backup_database.sh
</code></pre></div></p>
<hr />
<h3 id="activity-52-create-backup-system">Activity 5.2: Create Backup System</h3>
<p><strong>Duration:</strong> 15 minutes</p>
<p><strong>Objective:</strong> Implement automated database backups</p>
<div class="admonition note">
<p class="admonition-title">What You'll Do</p>
<ol>
<li>Create backup script</li>
<li>Test backup creation</li>
<li>Create restore script</li>
<li>Test restore procedure</li>
<li>Schedule automatic backups (optional)</li>
</ol>
</div>
<p><strong>Task 1: Create Backup Script</strong></p>
<p>Create <code>backup_database.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="c1"># Your backup script here</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="c1"># Follow the template above</span>
</code></pre></div>
<p><strong>Task 2: Create Restore Script</strong></p>
<p>Create <code>restore_database.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="c1"># restore_database.sh</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="nv">BACKUP_FILE</span><span class="o">=</span><span class="nv">$1</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: ./restore_database.sh &lt;backup_file.db.gz&gt;&quot;</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="k">fi</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="c1"># Decompress</span>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>gunzip<span class="w"> </span>-c<span class="w"> </span><span class="nv">$BACKUP_FILE</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/restored.db
<a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a>
<a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="c1"># Copy to working directory</span>
<a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a>cp<span class="w"> </span>/tmp/restored.db<span class="w"> </span>blog_database.db
<a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a>
<a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="c1"># Clean up</span>
<a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a>rm<span class="w"> </span>/tmp/restored.db
<a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a>
<a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Database restored from </span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
</code></pre></div>
<p><strong>Task 3: Test Your Backups</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># 1. Create backup</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>./backup_database.sh
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="c1"># 2. Make a change to database</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>sqlite3<span class="w"> </span>blog_database.db<span class="w"> </span><span class="s2">&quot;DELETE FROM posts WHERE id = 1&quot;</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="c1"># 3. Restore from backup</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>./restore_database.sh<span class="w"> </span>backups/backup_20250121_143022.db.gz
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="c1"># 4. Verify data restored</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>sqlite3<span class="w"> </span>blog_database.db<span class="w"> </span><span class="s2">&quot;SELECT COUNT(*) FROM posts&quot;</span>
</code></pre></div>
<details class="success">
<summary>Success Criteria</summary>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Backup script creates compressed backup files</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Backups are timestamped</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Old backups are automatically deleted</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Restore script successfully recovers data</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Tested restore procedure works</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Backup log shows successful operations</li>
</ul>
</details>
<p><strong>Optional: Schedule with Cron</strong>
<strong>Note:</strong> Cron does not exist on Windows machines. A scheduled task is a similar concept on Windows.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># Edit crontab</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>crontab<span class="w"> </span>-e
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="c1"># Add line to run backup daily at 2 AM</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/path/to/backup_database.sh
</code></pre></div>
<p><strong>Cron Schedule Format:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>* * * * * command
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>    
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>     Day of week (0-7, Sunday = 0 or 7)
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>    Month (1-12)
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>   Day of month (1-31)
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>  Hour (0-23)
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a> Minute (0-59)
</code></pre></div></p>
<p><strong>Git Checkpoint:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>git<span class="w"> </span>add<span class="w"> </span>backup_database.sh<span class="w"> </span>restore_database.sh
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add database backup and restore scripts</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="s2">- Automated backup with timestamp</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="s2">- Compression to save space</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="s2">- Cleanup old backups (7 day retention)</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="s2">- Restore script for recovery</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="s2">- Backup logging&quot;</span>
</code></pre></div></p>
<h1 id="part-6-big-data-concepts-database-management-20-minutes">Part 6: Big Data Concepts &amp; Database Management (20 minutes)</h1>
<h2 id="big-data-concepts-introduction">Big Data Concepts (Introduction)</h2>
<h3 id="what-is-big-data">What is Big Data?</h3>
<p>Big data refers to datasets so large or complex that traditional database tools struggle to handle them efficiently. For web applications, this means planning for scale from the beginning.</p>
<pre class="mermaid"><code>flowchart LR
    A[Small Data] --&gt;|Growth| B[Medium Data]
    B --&gt;|Growth| C[Big Data]

    A --&gt; A1[100s of records]
    A --&gt; A2[Single server]
    A --&gt; A3[Simple queries]

    B --&gt; B1[1000s-100,000s records]
    B --&gt; B2[Needs optimisation]
    B --&gt; B3[Requires indexing]

    C --&gt; C1[Millions+ records]
    C --&gt; C2[Distributed systems]
    C --&gt; C3[Specialised tools]

    style A fill:#9f9,stroke:#333
    style B fill:#ffd93d,stroke:#333
    style C fill:#ff6b6b,stroke:#333</code></pre>
<h3 id="big-data-terminology">Big Data Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Definition</th>
<th>Example in Web Context</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Metadata</strong></td>
<td>Data about data - information describing other data</td>
<td>User profile has metadata: <code>account_created_date</code>, <code>last_login</code>, <code>file_upload_date</code></td>
</tr>
<tr>
<td><strong>Data Mining</strong></td>
<td>Process of discovering patterns in large datasets</td>
<td>Analysing millions of user behaviours to recommend products or content</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Ability to handle growing amounts of data and users</td>
<td>Blog with 100 users vs 100 million users requires different architecture</td>
</tr>
<tr>
<td><strong>Query Optimisation</strong></td>
<td>Making database queries run faster and more efficiently</td>
<td>Bad query scans entire table; optimised query uses indexes</td>
</tr>
<tr>
<td><strong>Sharding</strong></td>
<td>Splitting data across multiple database servers</td>
<td>Users A-M on server 1, N-Z on server 2</td>
</tr>
<tr>
<td><strong>Replication</strong></td>
<td>Creating copies of database for redundancy and performance</td>
<td>Master database writes, multiple read replicas for queries</td>
</tr>
</tbody>
</table>
<h3 id="scalability-considerations">Scalability Considerations</h3>
<p>As your web application grows, database performance becomes critical:</p>
<pre class="mermaid"><code>flowchart LR
    A[Application Growth] --&gt; B{User Scale}

    B --&gt;|100s users| C[Small Scale]
    B --&gt;|1000s users| D[Medium Scale]
    B --&gt;|Millions users| E[Large Scale]

    C --&gt; C1[Single DB Server]
    C --&gt; C2[Simple Queries]
    C --&gt; C3[Basic Backups]

    D --&gt; D1[Indexes Required]
    D --&gt; D2[Connection Pooling]
    D --&gt; D3[Query Optimisation]

    E --&gt; E1[Database Replication]
    E --&gt; E2[Sharding]
    E --&gt; E3[Caching Layers]
    E --&gt; E4[Load Balancing]

    style A fill:#9f9,stroke:#333
    style B fill:#ffd93d,stroke:#333
    style C fill:#4d96ff,stroke:#333
    style D fill:#4d96ff,stroke:#333
    style E fill:#4d96ff,stroke:#333</code></pre>
<p><strong>Small Scale (Hundreds of Users):</strong></p>
<ul>
<li>Single database server sufficient</li>
<li>Simple queries work fine</li>
<li>Backups are quick (minutes)</li>
<li>No special optimisation needed</li>
<li>Example: Personal blog, small business website</li>
</ul>
<p><strong>Medium Scale (Thousands of Users):</strong></p>
<ul>
<li>Need indexes on frequently queried columns</li>
<li>Connection pooling becomes important</li>
<li>Regular database maintenance required</li>
<li>Backup strategies more complex (may take hours)</li>
<li>Example: Regional e-commerce site, university portal</li>
</ul>
<p><strong>Large Scale (Millions of Users):</strong></p>
<ul>
<li>Database replication (multiple copies across servers)</li>
<li>Sharding (splitting data across multiple databases)</li>
<li>Caching layers (Redis, Memcached) to reduce database load</li>
<li>Load balancing across multiple servers</li>
<li>Specialised big data tools (Hadoop, Spark)</li>
<li>Example: Facebook, Amazon, Netflix</li>
</ul>
<hr />
<h2 id="data-mining-in-web-applications">Data Mining in Web Applications</h2>
<h3 id="what-is-data-mining">What is Data Mining?</h3>
<p>Data mining is the process of discovering patterns, trends, and useful information from large datasets. In web applications, this helps make data-driven decisions.</p>
<pre class="mermaid"><code>flowchart TD
    A[/Raw User Data/] --&gt; B[Data Collection]
    B --&gt; C[Data Processing]
    C --&gt; D[Pattern Discovery]
    D --&gt; E[Actionable Insights]

    E --&gt; F[Business Decisions]
    E --&gt; G[User Experience Improvements]
    E --&gt; H[Product Recommendations]

    style A fill:#9f9,stroke:#333
    style B fill:#4d96ff,stroke:#333
    style C fill:#4d96ff,stroke:#333
    style D fill:#4d96ff,stroke:#333
    style E fill:#4d96ff,stroke:#333
    style F fill:#9f9,stroke:#333
    style G fill:#9f9,stroke:#333
    style H fill:#9f9,stroke:#333</code></pre>
<h3 id="common-data-mining-applications">Common Data Mining Applications</h3>
<p><strong>1. User Behaviour Analysis</strong></p>
<p>Understanding how users interact with your application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyse_user_activity</span><span class="p">():</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find patterns in user activity&quot;&quot;&quot;</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="s2">            strftime(&#39;%H&#39;, created_at) as hour_of_day,</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="s2">            COUNT(*) as post_count</span>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="s2">        FROM posts</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="s2">        GROUP BY hour_of_day</span>
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="s2">        ORDER BY hour_of_day</span>
<a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a>
<a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a>    <span class="c1"># Discover: Most posts are created between 18:00-22:00</span>
<a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a>    <span class="c1"># Insight: Schedule maintenance during low-activity hours (03:00-05:00)</span>
<a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<p><strong>2. Content Popularity Analysis</strong></p>
<p>Identifying trending topics and popular content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_trending_topics</span><span class="p">():</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Discover what content engages users most&quot;&quot;&quot;</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="s2">            posts.title,</span>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="s2">            COUNT(comments.comment_id) as engagement,</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="s2">            AVG(LENGTH(comments.content)) as avg_comment_length</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="s2">        FROM posts</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="s2">        LEFT JOIN comments ON posts.post_id = comments.post_id</span>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="s2">        WHERE posts.created_at &gt;= date(&#39;now&#39;, &#39;-7 days&#39;)</span>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="s2">        GROUP BY posts.post_id</span>
<a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="s2">        HAVING engagement &gt; 5</span>
<a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="s2">        ORDER BY engagement DESC</span>
<a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="s2">        LIMIT 10</span>
<a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>
<a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>    <span class="c1"># Insight: Posts about Python tutorials get 3x more engagement</span>
<a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a>    <span class="c1"># Decision: Create more Python content</span>
<a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<p><strong>3. User Segmentation</strong></p>
<p>Grouping users by behaviour patterns:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">segment_users</span><span class="p">():</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Categorise users by activity level&quot;&quot;&quot;</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="s2">            users.user_id,</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="s2">            users.username,</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="s2">            COUNT(DISTINCT posts.post_id) as posts_created,</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="s2">            COUNT(DISTINCT comments.comment_id) as comments_made,</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="s2">            CASE</span>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="s2">                WHEN COUNT(DISTINCT posts.post_id) &gt; 10 THEN &#39;Power User&#39;</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="s2">                WHEN COUNT(DISTINCT posts.post_id) &gt; 5 THEN &#39;Active User&#39;</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="s2">                WHEN COUNT(DISTINCT posts.post_id) &gt; 0 THEN &#39;Casual User&#39;</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="s2">                ELSE &#39;Lurker&#39;</span>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="s2">            END as user_segment</span>
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="s2">        FROM users</span>
<a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="s2">        LEFT JOIN posts ON users.user_id = posts.user_id</span>
<a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="s2">        LEFT JOIN comments ON users.user_id = comments.user_id</span>
<a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="s2">        GROUP BY users.user_id</span>
<a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a>
<a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a>    <span class="c1"># Insight: 80% of content comes from 20% of users (Pareto Principle)</span>
<a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a>    <span class="c1"># Decision: Create incentives for casual users to post more</span>
<a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<p><strong>4. Correlation Analysis</strong></p>
<p>Finding relationships between different metrics:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyse_engagement_correlation</span><span class="p">():</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Does post length correlate with engagement?&quot;&quot;&quot;</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="s2">            LENGTH(posts.content) as content_length,</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="s2">            COUNT(comments.comment_id) as comment_count</span>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="s2">        FROM posts</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="s2">        LEFT JOIN comments ON posts.post_id = comments.post_id</span>
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="s2">        GROUP BY posts.post_id</span>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="s2">        HAVING content_length &gt; 0</span>
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>
<a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a>    <span class="c1"># Insight: Posts between 300-800 characters get most comments</span>
<a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a>    <span class="c1"># Decision: Suggest optimal post length to users</span>
<a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h3 id="privacy-and-ethical-considerations">Privacy and Ethical Considerations</h3>
<div class="admonition warning">
<p class="admonition-title">Data Mining Ethics</p>
<p>When mining user data, you must:</p>
<ul>
<li><strong>Obtain consent:</strong> Users should know their data is being analysed</li>
<li><strong>Respect privacy:</strong> Anonymise personal information</li>
<li><strong>Comply with regulations:</strong> GDPR, CCPA (covered in Week 11)</li>
<li><strong>Be transparent:</strong> Explain how insights are used</li>
<li><strong>Provide opt-out:</strong> Allow users to exclude their data</li>
</ul>
<p><strong>Example of anonymisation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1">#  Bad: Exposes personal information</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT username, email, browsing_history FROM users&quot;</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="c1">#  Good: Aggregated and anonymised</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="s2">    SELECT </span>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="s2">        strftime(&#39;%H&#39;, last_login) as hour,</span>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="s2">        COUNT(*) as user_count</span>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="s2">    FROM users</span>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="s2">    GROUP BY hour</span>
<a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="s2">&quot;&quot;&quot;</span>
</code></pre></div></p>
</div>
<hr />
<h2 id="metadata-management">Metadata Management</h2>
<h3 id="understanding-metadata">Understanding Metadata</h3>
<p><strong>Metadata</strong> is "data about data" - information that describes, explains, or makes it easier to find and use other data.</p>
<p><strong>Types of Metadata:</strong></p>
<ol>
<li><strong>Descriptive:</strong> What the data is (title, author, description)</li>
<li><strong>Structural:</strong> How data is organised (file format, table schema)</li>
<li><strong>Administrative:</strong> When, who, how (creation date, permissions, version)</li>
</ol>
<h3 id="metadata-in-database-design">Metadata in Database Design</h3>
<pre class="mermaid"><code>flowchart LR
    A[Core Data] --&gt; B[Actual Content]
    A --&gt; C[Metadata]

    B --&gt; B1[Post text]
    B --&gt; B2[Comment content]
    B --&gt; B3[User message]

    C --&gt; C1[When created]
    C --&gt; C2[Who created it]
    C --&gt; C3[File size/type]
    C --&gt; C4[Last modified]
    C --&gt; C5[Access count]

    style A fill:#9370DB,stroke:#333
    style B fill:#4d96ff,stroke:#333
    style C fill:#4d96ff,stroke:#333</code></pre>
<h3 id="practical-example-file-upload-system">Practical Example: File Upload System</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">uploaded_files</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="n">file_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">    </span><span class="c1">-- Core data</span>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">    </span><span class="n">file_path</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">           </span><span class="c1">-- Where file is stored</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">    </span><span class="c1">-- Descriptive metadata</span>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">    </span><span class="n">filename</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">             </span><span class="c1">-- Original filename</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">    </span><span class="n">file_type</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">            </span><span class="c1">-- MIME type (image/jpeg, application/pdf)</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span><span class="n">file_size</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">         </span><span class="c1">-- Size in bytes</span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                   </span><span class="c1">-- User-provided description</span>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">    </span><span class="c1">-- Administrative metadata</span>
<a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">    </span><span class="n">uploaded_by</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">       </span><span class="c1">-- User who uploaded</span>
<a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">    </span><span class="n">uploaded_at</span><span class="w"> </span><span class="n">DATETIME</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">    </span><span class="n">last_modified</span><span class="w"> </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">             </span><span class="c1">-- When file was last changed</span>
<a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">    </span><span class="n">last_accessed</span><span class="w"> </span><span class="n">DATETIME</span><span class="p">,</span><span class="w">             </span><span class="c1">-- When file was last viewed</span>
<a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a>
<a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">    </span><span class="c1">-- Usage metadata</span>
<a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">    </span><span class="n">download_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">   </span><span class="c1">-- Popularity tracking</span>
<a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="w">    </span><span class="n">is_public</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">        </span><span class="c1">-- Privacy setting</span>
<a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a>
<a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="w">    </span><span class="c1">-- Technical metadata</span>
<a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="w">    </span><span class="n">file_hash</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span><span class="w">              </span><span class="c1">-- SHA-256 hash for duplicate detection</span>
<a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="w">    </span><span class="n">thumbnail_path</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">                </span><span class="c1">-- Preview image location</span>
<a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a>
<a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">uploaded_by</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="p">);</span>
</code></pre></div>
<h3 id="benefits-of-good-metadata">Benefits of Good Metadata</h3>
<p><strong>1. Duplicate Detection</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_duplicate_file</span><span class="p">(</span><span class="n">file_hash</span><span class="p">):</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Prevent users uploading the same file twice&quot;&quot;&quot;</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT file_id, filename FROM uploaded_files WHERE file_hash = ?&quot;</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>    <span class="n">existing</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">file_hash</span><span class="p">,),</span> <span class="n">one</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>    <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;File already exists as &#39;</span><span class="si">{</span><span class="n">existing</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<p><strong>2. Storage Management</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_user_storage_usage</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate total storage used by user&quot;&quot;&quot;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="s2">            uploaded_by,</span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="s2">            COUNT(*) as file_count,</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="s2">            SUM(file_size) as total_bytes,</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="s2">            ROUND(SUM(file_size) / 1024.0 / 1024.0, 2) as total_mb</span>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="s2">        FROM uploaded_files</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="s2">        WHERE uploaded_by = ?</span>
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="s2">        GROUP BY uploaded_by</span>
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a>    <span class="k">return</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,),</span> <span class="n">one</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><strong>3. Cleanup of Old Data</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">find_unused_files</span><span class="p">(</span><span class="n">days_inactive</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find files that haven&#39;t been accessed recently&quot;&quot;&quot;</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="s2">        SELECT file_id, filename, file_size, last_accessed</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="s2">        FROM uploaded_files</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="s2">        WHERE last_accessed &lt; date(&#39;now&#39;, &#39;-&#39; || ? || &#39; days&#39;)</span>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="s2">        OR last_accessed IS NULL</span>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="s2">        ORDER BY file_size DESC</span>
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a>    <span class="k">return</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">days_inactive</span><span class="p">,))</span>
</code></pre></div>
<p><strong>4. Popular Content Identification</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_most_downloaded_files</span><span class="p">():</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find most popular files&quot;&quot;&quot;</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="s2">        SELECT </span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="s2">            filename,</span>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="s2">            file_type,</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="s2">            download_count,</span>
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="s2">            uploaded_at</span>
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="s2">        FROM uploaded_files</span>
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="s2">        WHERE is_public = 1</span>
<a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="s2">        ORDER BY download_count DESC</span>
<a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="s2">        LIMIT 20</span>
<a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a>    <span class="k">return</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>
<h3 id="metadata-for-api-responses">Metadata for API Responses</h3>
<p>Metadata improves API usability:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/posts&#39;</span><span class="p">)</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">api_get_posts</span><span class="p">():</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;API endpoint with metadata&quot;&quot;&quot;</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>    <span class="n">per_page</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">per_page</span>
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>
<a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a>    <span class="c1"># Get posts</span>
<a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a>    <span class="n">posts</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span>
<a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>        <span class="s1">&#39;SELECT * FROM posts ORDER BY created_at DESC LIMIT ? OFFSET ?&#39;</span><span class="p">,</span>
<a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a>        <span class="p">(</span><span class="n">per_page</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
<a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a>    <span class="p">)</span>
<a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a>
<a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a>    <span class="c1"># Get total count for metadata</span>
<a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a>    <span class="n">total</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(*) as count FROM posts&#39;</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
<a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a>
<a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a>    <span class="c1"># Response includes metadata</span>
<a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a>    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
<a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a>        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">],</span>
<a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a>        <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a>            <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
<a id="__codelineno-92-22" name="__codelineno-92-22" href="#__codelineno-92-22"></a>            <span class="s1">&#39;per_page&#39;</span><span class="p">:</span> <span class="n">per_page</span><span class="p">,</span>
<a id="__codelineno-92-23" name="__codelineno-92-23" href="#__codelineno-92-23"></a>            <span class="s1">&#39;total_records&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
<a id="__codelineno-92-24" name="__codelineno-92-24" href="#__codelineno-92-24"></a>            <span class="s1">&#39;total_pages&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="n">per_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">per_page</span><span class="p">,</span>
<a id="__codelineno-92-25" name="__codelineno-92-25" href="#__codelineno-92-25"></a>            <span class="s1">&#39;has_next&#39;</span><span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">per_page</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">,</span>
<a id="__codelineno-92-26" name="__codelineno-92-26" href="#__codelineno-92-26"></a>            <span class="s1">&#39;has_previous&#39;</span><span class="p">:</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-92-27" name="__codelineno-92-27" href="#__codelineno-92-27"></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<a id="__codelineno-92-28" name="__codelineno-92-28" href="#__codelineno-92-28"></a>        <span class="p">}</span>
<a id="__codelineno-92-29" name="__codelineno-92-29" href="#__codelineno-92-29"></a>    <span class="p">})</span>
</code></pre></div>
<hr />
<h2 id="advanced-indexing-concepts">Advanced Indexing Concepts</h2>
<h3 id="how-indexes-work">How Indexes Work</h3>
<p>Indexes are like a book's index - they create a sorted lookup structure that allows quick data retrieval without scanning every row.</p>
<pre class="mermaid"><code>flowchart TD
    A[Query: Find user 'charlie'] --&gt; B{Index on username?}

    B --&gt;|No Index| C[Full Table Scan]
    C --&gt; C1[Read row 1: alice]
    C1 --&gt; C2[Read row 2: bob]
    C2 --&gt; C3[Read row 3: charlie ]
    C3 --&gt; C4[Read row 4: david]
    C4 --&gt; C5[Read row 5: eve]
    C5 --&gt; D[/Found after 5 reads/]

    B --&gt;|With Index| E[Index Lookup]
    E --&gt; E1[B-tree search]
    E1 --&gt; E2[Found in 2 comparisons]
    E2 --&gt; E3[Jump directly to row 3]
    E3 --&gt; F[/Found after 1 read/]

    style A fill:#9f9,stroke:#333
    style B fill:#ffd93d,stroke:#333
    style C fill:#ff6b6b,stroke:#333
    style E fill:#4d96ff,stroke:#333
    style D fill:#ff6b6b,stroke:#333
    style F fill:#9f9,stroke:#333</code></pre>
<h3 id="b-tree-index-structure-simplified">B-Tree Index Structure (Simplified)</h3>
<p>Databases typically use B-tree indexes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>                     [H]
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>                   /       \
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>               [D]            [M]
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>             /     \       /        \
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>        [A,B,C]   [E,F,G] [I,J,K,L] [N,O,P]
</code></pre></div>
<p>Finding 'K' requires only 3 comparisons instead of scanning all letters.</p>
<h3 id="measuring-index-performance">Measuring Index Performance</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_index_performance</span><span class="p">():</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Show difference between indexed and non-indexed queries&quot;&quot;&quot;</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>    <span class="c1"># Query WITHOUT index</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM posts WHERE title LIKE &#39;%Python%&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>    <span class="n">without_index</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>    <span class="c1"># Create index</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>    <span class="n">execute_db</span><span class="p">(</span><span class="s2">&quot;CREATE INDEX IF NOT EXISTS idx_posts_title ON posts(title)&quot;</span><span class="p">)</span>
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>
<a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>    <span class="c1"># Query WITH index</span>
<a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM posts WHERE title LIKE &#39;%Python%&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>    <span class="n">with_index</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>
<a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Without index: </span><span class="si">{</span><span class="n">without_index</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
<a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;With index: </span><span class="si">{</span><span class="n">with_index</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
<a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Improvement: </span><span class="si">{</span><span class="p">(</span><span class="n">without_index</span><span class="o">/</span><span class="n">with_index</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">x faster&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="query-execution-plans">Query Execution Plans</h3>
<p>Use <code>EXPLAIN QUERY PLAN</code> to see how SQLite executes queries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyse_query_plan</span><span class="p">():</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if query uses indexes&quot;&quot;&quot;</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM users WHERE username = &#39;alice&#39;&quot;</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>    <span class="c1"># Get execution plan</span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>    <span class="n">plan</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EXPLAIN QUERY PLAN </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>    <span class="c1"># Without index: SCAN TABLE users</span>
<a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>    <span class="c1"># With index: SEARCH TABLE users USING INDEX idx_users_username</span>
</code></pre></div>
<h3 id="composite-indexes">Composite Indexes</h3>
<p>Indexes on multiple columns for complex queries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="c1">-- Composite index on user_id and created_at</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_user_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="c1">-- This query benefits from composite index</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<p><strong>Column Order Matters:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1">--  Good: Index can be used for both conditions</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_user_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="p">);</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">;</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="c1">--  Less optimal: Index only helps with created_at</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_date_user</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="p">);</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">  </span><span class="c1">-- Can&#39;t use index efficiently</span>
</code></pre></div>
<p><strong>Rule of thumb:</strong> Put the most selective (unique) column first, and columns used in equality tests before range tests.</p>
<h3 id="index-trade-offs">Index Trade-offs</h3>
<pre class="mermaid"><code>flowchart LR
    A[Add Index] --&gt; B[Benefits]
    A --&gt; C[Costs]

    B --&gt; B1[Faster SELECT]
    B --&gt; B2[Faster WHERE]
    B --&gt; B3[Faster JOIN]
    B --&gt; B4[Faster ORDER BY]

    C --&gt; C1[Slower INSERT]
    C --&gt; C2[Slower UPDATE]
    C --&gt; C3[Slower DELETE]
    C --&gt; C4[More disk space]

    style A fill:#9370DB,stroke:#333
    style B fill:#9f9,stroke:#333
    style C fill:#ff6b6b,stroke:#333</code></pre>
<p><strong>When indexes hurt performance:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1"># If you have index on &#39;status&#39; column</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="c1"># But status only has values: &#39;active&#39;, &#39;inactive&#39;</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="c1"># Index doesn&#39;t help much because:</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="c1"># - Low cardinality (only 2 unique values)</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="c1"># - Database still needs to read ~50% of rows</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="c1"># - Index maintenance overhead not worth it</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="c1"># Better: Don&#39;t index low-cardinality columns</span>
</code></pre></div>
<hr />
<h2 id="shell-scripts-for-database-management">Shell Scripts for Database Management</h2>
<h3 id="why-shell-scripts">Why Shell Scripts?</h3>
<p>Shell scripts automate repetitive database administration tasks. Instead of manually running backup commands daily, create a script that runs automatically.</p>
<p><strong>Common Database Shell Script Uses:</strong></p>
<ul>
<li>Automated backups</li>
<li>Database restoration</li>
<li>Data export/import</li>
<li>Cleanup of old data</li>
<li>Database health monitoring</li>
<li>Log rotation</li>
<li>Performance reporting</li>
</ul>
<h3 id="advanced-backup-script-with-logging">Advanced Backup Script with Logging</h3>
<p>Create <code>backup_advanced.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="c1"># Advanced database backup script with logging and error handling</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="c1"># Configuration</span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="nv">DB_FILE</span><span class="o">=</span><span class="s2">&quot;myapp.db&quot;</span>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;backups&quot;</span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="nv">LOG_DIR</span><span class="o">=</span><span class="s2">&quot;logs&quot;</span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="nv">MAX_BACKUPS</span><span class="o">=</span><span class="m">7</span>
<a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="nv">BACKUP_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/myapp_</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">.db&quot;</span>
<a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">LOG_DIR</span><span class="si">}</span><span class="s2">/backup_</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a>
<a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="c1"># Colours for output</span>
<a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<a id="__codelineno-99-18" name="__codelineno-99-18" href="#__codelineno-99-18"></a><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span><span class="w"> </span><span class="c1"># No Colour</span>
<a id="__codelineno-99-19" name="__codelineno-99-19" href="#__codelineno-99-19"></a>
<a id="__codelineno-99-20" name="__codelineno-99-20" href="#__codelineno-99-20"></a><span class="c1"># Function to log messages</span>
<a id="__codelineno-99-21" name="__codelineno-99-21" href="#__codelineno-99-21"></a>log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-99-22" name="__codelineno-99-22" href="#__codelineno-99-22"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-23" name="__codelineno-99-23" href="#__codelineno-99-23"></a><span class="o">}</span>
<a id="__codelineno-99-24" name="__codelineno-99-24" href="#__codelineno-99-24"></a>
<a id="__codelineno-99-25" name="__codelineno-99-25" href="#__codelineno-99-25"></a><span class="c1"># Function to log errors</span>
<a id="__codelineno-99-26" name="__codelineno-99-26" href="#__codelineno-99-26"></a>log_error<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-99-27" name="__codelineno-99-27" href="#__codelineno-99-27"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] ERROR: </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-28" name="__codelineno-99-28" href="#__codelineno-99-28"></a><span class="o">}</span>
<a id="__codelineno-99-29" name="__codelineno-99-29" href="#__codelineno-99-29"></a>
<a id="__codelineno-99-30" name="__codelineno-99-30" href="#__codelineno-99-30"></a><span class="c1"># Function to log success</span>
<a id="__codelineno-99-31" name="__codelineno-99-31" href="#__codelineno-99-31"></a>log_success<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-99-32" name="__codelineno-99-32" href="#__codelineno-99-32"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">[</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] SUCCESS: </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-33" name="__codelineno-99-33" href="#__codelineno-99-33"></a><span class="o">}</span>
<a id="__codelineno-99-34" name="__codelineno-99-34" href="#__codelineno-99-34"></a>
<a id="__codelineno-99-35" name="__codelineno-99-35" href="#__codelineno-99-35"></a><span class="c1"># Create directories if they don&#39;t exist</span>
<a id="__codelineno-99-36" name="__codelineno-99-36" href="#__codelineno-99-36"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_DIR</span><span class="s2">&quot;</span>
<a id="__codelineno-99-37" name="__codelineno-99-37" href="#__codelineno-99-37"></a>
<a id="__codelineno-99-38" name="__codelineno-99-38" href="#__codelineno-99-38"></a>log_message<span class="w"> </span><span class="s2">&quot;Starting database backup...&quot;</span>
<a id="__codelineno-99-39" name="__codelineno-99-39" href="#__codelineno-99-39"></a>
<a id="__codelineno-99-40" name="__codelineno-99-40" href="#__codelineno-99-40"></a><span class="c1"># Check if database file exists</span>
<a id="__codelineno-99-41" name="__codelineno-99-41" href="#__codelineno-99-41"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-99-42" name="__codelineno-99-42" href="#__codelineno-99-42"></a><span class="w">    </span>log_error<span class="w"> </span><span class="s2">&quot;Database file </span><span class="nv">$DB_FILE</span><span class="s2"> not found!&quot;</span>
<a id="__codelineno-99-43" name="__codelineno-99-43" href="#__codelineno-99-43"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-99-44" name="__codelineno-99-44" href="#__codelineno-99-44"></a><span class="k">fi</span>
<a id="__codelineno-99-45" name="__codelineno-99-45" href="#__codelineno-99-45"></a>
<a id="__codelineno-99-46" name="__codelineno-99-46" href="#__codelineno-99-46"></a><span class="c1"># Check database integrity before backup</span>
<a id="__codelineno-99-47" name="__codelineno-99-47" href="#__codelineno-99-47"></a>log_message<span class="w"> </span><span class="s2">&quot;Checking database integrity...&quot;</span>
<a id="__codelineno-99-48" name="__codelineno-99-48" href="#__codelineno-99-48"></a>sqlite3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;PRAGMA integrity_check;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<a id="__codelineno-99-49" name="__codelineno-99-49" href="#__codelineno-99-49"></a>
<a id="__codelineno-99-50" name="__codelineno-99-50" href="#__codelineno-99-50"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-99-51" name="__codelineno-99-51" href="#__codelineno-99-51"></a><span class="w">    </span>log_success<span class="w"> </span><span class="s2">&quot;Database integrity check passed&quot;</span>
<a id="__codelineno-99-52" name="__codelineno-99-52" href="#__codelineno-99-52"></a><span class="k">else</span>
<a id="__codelineno-99-53" name="__codelineno-99-53" href="#__codelineno-99-53"></a><span class="w">    </span>log_error<span class="w"> </span><span class="s2">&quot;Database integrity check failed!&quot;</span>
<a id="__codelineno-99-54" name="__codelineno-99-54" href="#__codelineno-99-54"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-99-55" name="__codelineno-99-55" href="#__codelineno-99-55"></a><span class="k">fi</span>
<a id="__codelineno-99-56" name="__codelineno-99-56" href="#__codelineno-99-56"></a>
<a id="__codelineno-99-57" name="__codelineno-99-57" href="#__codelineno-99-57"></a><span class="c1"># Create backup</span>
<a id="__codelineno-99-58" name="__codelineno-99-58" href="#__codelineno-99-58"></a>log_message<span class="w"> </span><span class="s2">&quot;Creating backup: </span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-59" name="__codelineno-99-59" href="#__codelineno-99-59"></a>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-60" name="__codelineno-99-60" href="#__codelineno-99-60"></a>
<a id="__codelineno-99-61" name="__codelineno-99-61" href="#__codelineno-99-61"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-99-62" name="__codelineno-99-62" href="#__codelineno-99-62"></a><span class="w">    </span><span class="c1"># Get file size</span>
<a id="__codelineno-99-63" name="__codelineno-99-63" href="#__codelineno-99-63"></a><span class="w">    </span><span class="nv">SIZE</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-99-64" name="__codelineno-99-64" href="#__codelineno-99-64"></a><span class="w">    </span>log_success<span class="w"> </span><span class="s2">&quot;Backup created successfully (Size: </span><span class="nv">$SIZE</span><span class="s2">)&quot;</span>
<a id="__codelineno-99-65" name="__codelineno-99-65" href="#__codelineno-99-65"></a>
<a id="__codelineno-99-66" name="__codelineno-99-66" href="#__codelineno-99-66"></a><span class="w">    </span><span class="c1"># Compress backup</span>
<a id="__codelineno-99-67" name="__codelineno-99-67" href="#__codelineno-99-67"></a><span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Compressing backup...&quot;</span>
<a id="__codelineno-99-68" name="__codelineno-99-68" href="#__codelineno-99-68"></a><span class="w">    </span>gzip<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-69" name="__codelineno-99-69" href="#__codelineno-99-69"></a>
<a id="__codelineno-99-70" name="__codelineno-99-70" href="#__codelineno-99-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-99-71" name="__codelineno-99-71" href="#__codelineno-99-71"></a><span class="w">        </span><span class="nv">COMPRESSED_SIZE</span><span class="o">=</span><span class="k">$(</span>du<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_FILE</span><span class="si">}</span><span class="s2">.gz&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span>
<a id="__codelineno-99-72" name="__codelineno-99-72" href="#__codelineno-99-72"></a><span class="w">        </span>log_success<span class="w"> </span><span class="s2">&quot;Backup compressed (Size: </span><span class="nv">$COMPRESSED_SIZE</span><span class="s2">)&quot;</span>
<a id="__codelineno-99-73" name="__codelineno-99-73" href="#__codelineno-99-73"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-99-74" name="__codelineno-99-74" href="#__codelineno-99-74"></a><span class="w">        </span>log_error<span class="w"> </span><span class="s2">&quot;Compression failed&quot;</span>
<a id="__codelineno-99-75" name="__codelineno-99-75" href="#__codelineno-99-75"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-99-76" name="__codelineno-99-76" href="#__codelineno-99-76"></a>
<a id="__codelineno-99-77" name="__codelineno-99-77" href="#__codelineno-99-77"></a><span class="w">    </span><span class="c1"># Clean up old backups</span>
<a id="__codelineno-99-78" name="__codelineno-99-78" href="#__codelineno-99-78"></a><span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Cleaning up old backups (keeping </span><span class="si">${</span><span class="nv">MAX_BACKUPS</span><span class="si">}</span><span class="s2"> most recent)...&quot;</span>
<a id="__codelineno-99-79" name="__codelineno-99-79" href="#__codelineno-99-79"></a><span class="w">    </span><span class="nv">DELETED</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-99-80" name="__codelineno-99-80" href="#__codelineno-99-80"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>OLD_BACKUP<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>-t<span class="w"> </span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span>/myapp_*.db.gz<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+<span class="k">$((</span><span class="nv">MAX_BACKUPS</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">)))</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-99-81" name="__codelineno-99-81" href="#__codelineno-99-81"></a><span class="w">        </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OLD_BACKUP</span><span class="s2">&quot;</span>
<a id="__codelineno-99-82" name="__codelineno-99-82" href="#__codelineno-99-82"></a><span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Deleted old backup: </span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$OLD_BACKUP</span><span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-99-83" name="__codelineno-99-83" href="#__codelineno-99-83"></a><span class="w">        </span><span class="nv">DELETED</span><span class="o">=</span><span class="k">$((</span><span class="nv">DELETED</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="k">))</span>
<a id="__codelineno-99-84" name="__codelineno-99-84" href="#__codelineno-99-84"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-99-85" name="__codelineno-99-85" href="#__codelineno-99-85"></a>
<a id="__codelineno-99-86" name="__codelineno-99-86" href="#__codelineno-99-86"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$DELETED</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-99-87" name="__codelineno-99-87" href="#__codelineno-99-87"></a><span class="w">        </span>log_success<span class="w"> </span><span class="s2">&quot;Deleted </span><span class="nv">$DELETED</span><span class="s2"> old backup(s)&quot;</span>
<a id="__codelineno-99-88" name="__codelineno-99-88" href="#__codelineno-99-88"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-99-89" name="__codelineno-99-89" href="#__codelineno-99-89"></a><span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;No old backups to delete&quot;</span>
<a id="__codelineno-99-90" name="__codelineno-99-90" href="#__codelineno-99-90"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-99-91" name="__codelineno-99-91" href="#__codelineno-99-91"></a>
<a id="__codelineno-99-92" name="__codelineno-99-92" href="#__codelineno-99-92"></a><span class="w">    </span><span class="c1"># Summary</span>
<a id="__codelineno-99-93" name="__codelineno-99-93" href="#__codelineno-99-93"></a><span class="w">    </span>log_success<span class="w"> </span><span class="s2">&quot;Backup completed successfully!&quot;</span>
<a id="__codelineno-99-94" name="__codelineno-99-94" href="#__codelineno-99-94"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2"></span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-99-95" name="__codelineno-99-95" href="#__codelineno-99-95"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Backup Summary:</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-99-96" name="__codelineno-99-96" href="#__codelineno-99-96"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;  Location: </span><span class="si">${</span><span class="nv">BACKUP_FILE</span><span class="si">}</span><span class="s2">.gz&quot;</span>
<a id="__codelineno-99-97" name="__codelineno-99-97" href="#__codelineno-99-97"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;  Size: </span><span class="nv">$COMPRESSED_SIZE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-98" name="__codelineno-99-98" href="#__codelineno-99-98"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;  Log: </span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-99-99" name="__codelineno-99-99" href="#__codelineno-99-99"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2"></span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-99-100" name="__codelineno-99-100" href="#__codelineno-99-100"></a>
<a id="__codelineno-99-101" name="__codelineno-99-101" href="#__codelineno-99-101"></a><span class="k">else</span>
<a id="__codelineno-99-102" name="__codelineno-99-102" href="#__codelineno-99-102"></a><span class="w">    </span>log_error<span class="w"> </span><span class="s2">&quot;Backup failed!&quot;</span>
<a id="__codelineno-99-103" name="__codelineno-99-103" href="#__codelineno-99-103"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-99-104" name="__codelineno-99-104" href="#__codelineno-99-104"></a><span class="k">fi</span>
</code></pre></div>
<p>Make executable:
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>backup_advanced.sh
</code></pre></div></p>
<h3 id="database-restoration-script">Database Restoration Script</h3>
<p>Create <code>restore.sh</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="c1"># Database restoration script</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;backups&quot;</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="nv">DB_FILE</span><span class="o">=</span><span class="s2">&quot;myapp.db&quot;</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available backups:&quot;</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a>ls<span class="w"> </span>-lht<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">&quot;</span>/myapp_*.db.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>nl
<a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a>
<a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Enter backup number to restore (or &#39;q&#39; to quit): &quot;</span><span class="w"> </span>BACKUP_NUM
<a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a>
<a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_NUM</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoration cancelled&quot;</span>
<a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-101-18" name="__codelineno-101-18" href="#__codelineno-101-18"></a><span class="k">fi</span>
<a id="__codelineno-101-19" name="__codelineno-101-19" href="#__codelineno-101-19"></a>
<a id="__codelineno-101-20" name="__codelineno-101-20" href="#__codelineno-101-20"></a><span class="c1"># Get the selected backup file</span>
<a id="__codelineno-101-21" name="__codelineno-101-21" href="#__codelineno-101-21"></a><span class="nv">BACKUP_FILE</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span>-t<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">&quot;</span>/myapp_*.db.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_NUM</span><span class="si">}</span><span class="s2">p&quot;</span><span class="k">)</span>
<a id="__codelineno-101-22" name="__codelineno-101-22" href="#__codelineno-101-22"></a>
<a id="__codelineno-101-23" name="__codelineno-101-23" href="#__codelineno-101-23"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-24" name="__codelineno-101-24" href="#__codelineno-101-24"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Invalid backup number&quot;</span>
<a id="__codelineno-101-25" name="__codelineno-101-25" href="#__codelineno-101-25"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-101-26" name="__codelineno-101-26" href="#__codelineno-101-26"></a><span class="k">fi</span>
<a id="__codelineno-101-27" name="__codelineno-101-27" href="#__codelineno-101-27"></a>
<a id="__codelineno-101-28" name="__codelineno-101-28" href="#__codelineno-101-28"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Selected backup: </span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-101-29" name="__codelineno-101-29" href="#__codelineno-101-29"></a><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;  This will overwrite the current database. Continue? (yes/no): &quot;</span><span class="w"> </span>CONFIRM
<a id="__codelineno-101-30" name="__codelineno-101-30" href="#__codelineno-101-30"></a>
<a id="__codelineno-101-31" name="__codelineno-101-31" href="#__codelineno-101-31"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIRM</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-32" name="__codelineno-101-32" href="#__codelineno-101-32"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoration cancelled&quot;</span>
<a id="__codelineno-101-33" name="__codelineno-101-33" href="#__codelineno-101-33"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-101-34" name="__codelineno-101-34" href="#__codelineno-101-34"></a><span class="k">fi</span>
<a id="__codelineno-101-35" name="__codelineno-101-35" href="#__codelineno-101-35"></a>
<a id="__codelineno-101-36" name="__codelineno-101-36" href="#__codelineno-101-36"></a><span class="c1"># Create safety backup of current database</span>
<a id="__codelineno-101-37" name="__codelineno-101-37" href="#__codelineno-101-37"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-38" name="__codelineno-101-38" href="#__codelineno-101-38"></a><span class="w">    </span><span class="nv">SAFETY_BACKUP</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DB_FILE</span><span class="si">}</span><span class="s2">.before_restore_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<a id="__codelineno-101-39" name="__codelineno-101-39" href="#__codelineno-101-39"></a><span class="w">    </span>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SAFETY_BACKUP</span><span class="s2">&quot;</span>
<a id="__codelineno-101-40" name="__codelineno-101-40" href="#__codelineno-101-40"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Current database backed up to: </span><span class="nv">$SAFETY_BACKUP</span><span class="s2">&quot;</span>
<a id="__codelineno-101-41" name="__codelineno-101-41" href="#__codelineno-101-41"></a><span class="k">fi</span>
<a id="__codelineno-101-42" name="__codelineno-101-42" href="#__codelineno-101-42"></a>
<a id="__codelineno-101-43" name="__codelineno-101-43" href="#__codelineno-101-43"></a><span class="c1"># Decompress and restore</span>
<a id="__codelineno-101-44" name="__codelineno-101-44" href="#__codelineno-101-44"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoring database...&quot;</span>
<a id="__codelineno-101-45" name="__codelineno-101-45" href="#__codelineno-101-45"></a>gunzip<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-101-46" name="__codelineno-101-46" href="#__codelineno-101-46"></a>
<a id="__codelineno-101-47" name="__codelineno-101-47" href="#__codelineno-101-47"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-48" name="__codelineno-101-48" href="#__codelineno-101-48"></a><span class="w">    </span><span class="c1"># Verify restored database</span>
<a id="__codelineno-101-49" name="__codelineno-101-49" href="#__codelineno-101-49"></a><span class="w">    </span>sqlite3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;PRAGMA integrity_check;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<a id="__codelineno-101-50" name="__codelineno-101-50" href="#__codelineno-101-50"></a>
<a id="__codelineno-101-51" name="__codelineno-101-51" href="#__codelineno-101-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-101-52" name="__codelineno-101-52" href="#__codelineno-101-52"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Database restored successfully!&quot;</span>
<a id="__codelineno-101-53" name="__codelineno-101-53" href="#__codelineno-101-53"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Integrity check passed&quot;</span>
<a id="__codelineno-101-54" name="__codelineno-101-54" href="#__codelineno-101-54"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-101-55" name="__codelineno-101-55" href="#__codelineno-101-55"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Restored database failed integrity check!&quot;</span>
<a id="__codelineno-101-56" name="__codelineno-101-56" href="#__codelineno-101-56"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Restoring safety backup...&quot;</span>
<a id="__codelineno-101-57" name="__codelineno-101-57" href="#__codelineno-101-57"></a><span class="w">        </span>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SAFETY_BACKUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DB_FILE</span><span class="s2">&quot;</span>
<a id="__codelineno-101-58" name="__codelineno-101-58" href="#__codelineno-101-58"></a><span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-101-59" name="__codelineno-101-59" href="#__codelineno-101-59"></a><span class="w">    </span><span class="k">fi</span>
<a id="__codelineno-101-60" name="__codelineno-101-60" href="#__codelineno-101-60"></a><span class="k">else</span>
<a id="__codelineno-101-61" name="__codelineno-101-61" href="#__codelineno-101-61"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; Restoration failed!&quot;</span>
<a id="__codelineno-101-62" name="__codelineno-101-62" href="#__codelineno-101-62"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-101-63" name="__codelineno-101-63" href="#__codelineno-101-63"></a><span class="k">fi</span>
</code></pre></div>
<p>Make executable:
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>restore.sh
</code></pre></div></p>
<h3 id="database-health-check-script">Database Health Check Script</h3>
<p>Create <code>health_check.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="sd">Database health check script</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="sd">Monitors database size, performance, and integrity</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a>
<a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="n">DB_FILE</span> <span class="o">=</span> <span class="s1">&#39;myapp.db&#39;</span>
<a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a>
<a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">format_size</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert bytes to human-readable format&quot;&quot;&quot;</span>
<a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a>    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;KB&#39;</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="s1">&#39;GB&#39;</span><span class="p">]:</span>
<a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a>        <span class="k">if</span> <span class="nb">bytes</span> <span class="o">&lt;</span> <span class="mf">1024.0</span><span class="p">:</span>
<a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bytes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a>        <span class="nb">bytes</span> <span class="o">/=</span> <span class="mf">1024.0</span>
<a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">bytes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> TB&quot;</span>
<a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a>
<a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_database_health</span><span class="p">():</span>
<a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform comprehensive database health check&quot;&quot;&quot;</span>
<a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-103-24" name="__codelineno-103-24" href="#__codelineno-103-24"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATABASE HEALTH CHECK&quot;</span><span class="p">)</span>
<a id="__codelineno-103-25" name="__codelineno-103-25" href="#__codelineno-103-25"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-26" name="__codelineno-103-26" href="#__codelineno-103-26"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-103-27" name="__codelineno-103-27" href="#__codelineno-103-27"></a>
<a id="__codelineno-103-28" name="__codelineno-103-28" href="#__codelineno-103-28"></a>    <span class="c1"># Check file exists</span>
<a id="__codelineno-103-29" name="__codelineno-103-29" href="#__codelineno-103-29"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DB_FILE</span><span class="p">):</span>
<a id="__codelineno-103-30" name="__codelineno-103-30" href="#__codelineno-103-30"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Database file &#39;</span><span class="si">{</span><span class="n">DB_FILE</span><span class="si">}</span><span class="s2">&#39; not found!&quot;</span><span class="p">)</span>
<a id="__codelineno-103-31" name="__codelineno-103-31" href="#__codelineno-103-31"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-103-32" name="__codelineno-103-32" href="#__codelineno-103-32"></a>
<a id="__codelineno-103-33" name="__codelineno-103-33" href="#__codelineno-103-33"></a>    <span class="c1"># File size</span>
<a id="__codelineno-103-34" name="__codelineno-103-34" href="#__codelineno-103-34"></a>    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">DB_FILE</span><span class="p">)</span>
<a id="__codelineno-103-35" name="__codelineno-103-35" href="#__codelineno-103-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Database Size: </span><span class="si">{</span><span class="n">format_size</span><span class="p">(</span><span class="n">file_size</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-36" name="__codelineno-103-36" href="#__codelineno-103-36"></a>
<a id="__codelineno-103-37" name="__codelineno-103-37" href="#__codelineno-103-37"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-103-38" name="__codelineno-103-38" href="#__codelineno-103-38"></a>        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_FILE</span><span class="p">)</span>
<a id="__codelineno-103-39" name="__codelineno-103-39" href="#__codelineno-103-39"></a>        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-103-40" name="__codelineno-103-40" href="#__codelineno-103-40"></a>
<a id="__codelineno-103-41" name="__codelineno-103-41" href="#__codelineno-103-41"></a>        <span class="c1"># Integrity check</span>
<a id="__codelineno-103-42" name="__codelineno-103-42" href="#__codelineno-103-42"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Running integrity check...&quot;</span><span class="p">)</span>
<a id="__codelineno-103-43" name="__codelineno-103-43" href="#__codelineno-103-43"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA integrity_check&quot;</span><span class="p">)</span>
<a id="__codelineno-103-44" name="__codelineno-103-44" href="#__codelineno-103-44"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-45" name="__codelineno-103-45" href="#__codelineno-103-45"></a>
<a id="__codelineno-103-46" name="__codelineno-103-46" href="#__codelineno-103-46"></a>        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
<a id="__codelineno-103-47" name="__codelineno-103-47" href="#__codelineno-103-47"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Integrity check: PASSED&quot;</span><span class="p">)</span>
<a id="__codelineno-103-48" name="__codelineno-103-48" href="#__codelineno-103-48"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-103-49" name="__codelineno-103-49" href="#__codelineno-103-49"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Integrity check: FAILED - </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-50" name="__codelineno-103-50" href="#__codelineno-103-50"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-103-51" name="__codelineno-103-51" href="#__codelineno-103-51"></a>
<a id="__codelineno-103-52" name="__codelineno-103-52" href="#__codelineno-103-52"></a>        <span class="c1"># Table statistics</span>
<a id="__codelineno-103-53" name="__codelineno-103-53" href="#__codelineno-103-53"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Table Statistics:&quot;</span><span class="p">)</span>
<a id="__codelineno-103-54" name="__codelineno-103-54" href="#__codelineno-103-54"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-103-55" name="__codelineno-103-55" href="#__codelineno-103-55"></a><span class="s2">            SELECT name FROM sqlite_master </span>
<a id="__codelineno-103-56" name="__codelineno-103-56" href="#__codelineno-103-56"></a><span class="s2">            WHERE type=&#39;table&#39; AND name NOT LIKE &#39;sqlite_%&#39;</span>
<a id="__codelineno-103-57" name="__codelineno-103-57" href="#__codelineno-103-57"></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-103-58" name="__codelineno-103-58" href="#__codelineno-103-58"></a>        <span class="n">tables</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-103-59" name="__codelineno-103-59" href="#__codelineno-103-59"></a>
<a id="__codelineno-103-60" name="__codelineno-103-60" href="#__codelineno-103-60"></a>        <span class="k">for</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
<a id="__codelineno-103-61" name="__codelineno-103-61" href="#__codelineno-103-61"></a>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT COUNT(*) FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-62" name="__codelineno-103-62" href="#__codelineno-103-62"></a>            <span class="n">count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-63" name="__codelineno-103-63" href="#__codelineno-103-63"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>
<a id="__codelineno-103-64" name="__codelineno-103-64" href="#__codelineno-103-64"></a>
<a id="__codelineno-103-65" name="__codelineno-103-65" href="#__codelineno-103-65"></a>        <span class="c1"># Index usage</span>
<a id="__codelineno-103-66" name="__codelineno-103-66" href="#__codelineno-103-66"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Indexes:&quot;</span><span class="p">)</span>
<a id="__codelineno-103-67" name="__codelineno-103-67" href="#__codelineno-103-67"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-103-68" name="__codelineno-103-68" href="#__codelineno-103-68"></a><span class="s2">            SELECT name, tbl_name FROM sqlite_master </span>
<a id="__codelineno-103-69" name="__codelineno-103-69" href="#__codelineno-103-69"></a><span class="s2">            WHERE type=&#39;index&#39; AND name NOT LIKE &#39;sqlite_%&#39;</span>
<a id="__codelineno-103-70" name="__codelineno-103-70" href="#__codelineno-103-70"></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-103-71" name="__codelineno-103-71" href="#__codelineno-103-71"></a>        <span class="n">indexes</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<a id="__codelineno-103-72" name="__codelineno-103-72" href="#__codelineno-103-72"></a>
<a id="__codelineno-103-73" name="__codelineno-103-73" href="#__codelineno-103-73"></a>        <span class="k">if</span> <span class="n">indexes</span><span class="p">:</span>
<a id="__codelineno-103-74" name="__codelineno-103-74" href="#__codelineno-103-74"></a>            <span class="k">for</span> <span class="n">index_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
<a id="__codelineno-103-75" name="__codelineno-103-75" href="#__codelineno-103-75"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">index_name</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-76" name="__codelineno-103-76" href="#__codelineno-103-76"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-103-77" name="__codelineno-103-77" href="#__codelineno-103-77"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    No custom indexes found&quot;</span><span class="p">)</span>
<a id="__codelineno-103-78" name="__codelineno-103-78" href="#__codelineno-103-78"></a>
<a id="__codelineno-103-79" name="__codelineno-103-79" href="#__codelineno-103-79"></a>        <span class="c1"># Recent activity</span>
<a id="__codelineno-103-80" name="__codelineno-103-80" href="#__codelineno-103-80"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Recent Activity:&quot;</span><span class="p">)</span>
<a id="__codelineno-103-81" name="__codelineno-103-81" href="#__codelineno-103-81"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-103-82" name="__codelineno-103-82" href="#__codelineno-103-82"></a><span class="s2">            SELECT COUNT(*) FROM users </span>
<a id="__codelineno-103-83" name="__codelineno-103-83" href="#__codelineno-103-83"></a><span class="s2">            WHERE created_at &gt;= date(&#39;now&#39;, &#39;-7 days&#39;)</span>
<a id="__codelineno-103-84" name="__codelineno-103-84" href="#__codelineno-103-84"></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-103-85" name="__codelineno-103-85" href="#__codelineno-103-85"></a>        <span class="n">new_users</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-86" name="__codelineno-103-86" href="#__codelineno-103-86"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   New users (last 7 days): </span><span class="si">{</span><span class="n">new_users</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-87" name="__codelineno-103-87" href="#__codelineno-103-87"></a>
<a id="__codelineno-103-88" name="__codelineno-103-88" href="#__codelineno-103-88"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-103-89" name="__codelineno-103-89" href="#__codelineno-103-89"></a><span class="s2">            SELECT COUNT(*) FROM posts </span>
<a id="__codelineno-103-90" name="__codelineno-103-90" href="#__codelineno-103-90"></a><span class="s2">            WHERE created_at &gt;= date(&#39;now&#39;, &#39;-7 days&#39;)</span>
<a id="__codelineno-103-91" name="__codelineno-103-91" href="#__codelineno-103-91"></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-103-92" name="__codelineno-103-92" href="#__codelineno-103-92"></a>        <span class="n">new_posts</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-93" name="__codelineno-103-93" href="#__codelineno-103-93"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   New posts (last 7 days): </span><span class="si">{</span><span class="n">new_posts</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-94" name="__codelineno-103-94" href="#__codelineno-103-94"></a>
<a id="__codelineno-103-95" name="__codelineno-103-95" href="#__codelineno-103-95"></a>        <span class="c1"># Database settings</span>
<a id="__codelineno-103-96" name="__codelineno-103-96" href="#__codelineno-103-96"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Database Settings:&quot;</span><span class="p">)</span>
<a id="__codelineno-103-97" name="__codelineno-103-97" href="#__codelineno-103-97"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA page_size&quot;</span><span class="p">)</span>
<a id="__codelineno-103-98" name="__codelineno-103-98" href="#__codelineno-103-98"></a>        <span class="n">page_size</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-99" name="__codelineno-103-99" href="#__codelineno-103-99"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Page size: </span><span class="si">{</span><span class="n">page_size</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
<a id="__codelineno-103-100" name="__codelineno-103-100" href="#__codelineno-103-100"></a>
<a id="__codelineno-103-101" name="__codelineno-103-101" href="#__codelineno-103-101"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA page_count&quot;</span><span class="p">)</span>
<a id="__codelineno-103-102" name="__codelineno-103-102" href="#__codelineno-103-102"></a>        <span class="n">page_count</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-103" name="__codelineno-103-103" href="#__codelineno-103-103"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Page count: </span><span class="si">{</span><span class="n">page_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-104" name="__codelineno-103-104" href="#__codelineno-103-104"></a>
<a id="__codelineno-103-105" name="__codelineno-103-105" href="#__codelineno-103-105"></a>        <span class="c1"># Fragmentation</span>
<a id="__codelineno-103-106" name="__codelineno-103-106" href="#__codelineno-103-106"></a>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA freelist_count&quot;</span><span class="p">)</span>
<a id="__codelineno-103-107" name="__codelineno-103-107" href="#__codelineno-103-107"></a>        <span class="n">freelist</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-108" name="__codelineno-103-108" href="#__codelineno-103-108"></a>        <span class="n">fragmentation</span> <span class="o">=</span> <span class="p">(</span><span class="n">freelist</span> <span class="o">/</span> <span class="n">page_count</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-103-109" name="__codelineno-103-109" href="#__codelineno-103-109"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Fragmentation: </span><span class="si">{</span><span class="n">fragmentation</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<a id="__codelineno-103-110" name="__codelineno-103-110" href="#__codelineno-103-110"></a>
<a id="__codelineno-103-111" name="__codelineno-103-111" href="#__codelineno-103-111"></a>        <span class="k">if</span> <span class="n">fragmentation</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-103-112" name="__codelineno-103-112" href="#__codelineno-103-112"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Consider running VACUUM to reduce fragmentation&quot;</span><span class="p">)</span>
<a id="__codelineno-103-113" name="__codelineno-103-113" href="#__codelineno-103-113"></a>
<a id="__codelineno-103-114" name="__codelineno-103-114" href="#__codelineno-103-114"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-103-115" name="__codelineno-103-115" href="#__codelineno-103-115"></a>
<a id="__codelineno-103-116" name="__codelineno-103-116" href="#__codelineno-103-116"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-103-117" name="__codelineno-103-117" href="#__codelineno-103-117"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Health check completed successfully&quot;</span><span class="p">)</span>
<a id="__codelineno-103-118" name="__codelineno-103-118" href="#__codelineno-103-118"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-103-119" name="__codelineno-103-119" href="#__codelineno-103-119"></a>
<a id="__codelineno-103-120" name="__codelineno-103-120" href="#__codelineno-103-120"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-103-121" name="__codelineno-103-121" href="#__codelineno-103-121"></a>
<a id="__codelineno-103-122" name="__codelineno-103-122" href="#__codelineno-103-122"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-103-123" name="__codelineno-103-123" href="#__codelineno-103-123"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Error during health check: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-103-124" name="__codelineno-103-124" href="#__codelineno-103-124"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-103-125" name="__codelineno-103-125" href="#__codelineno-103-125"></a>
<a id="__codelineno-103-126" name="__codelineno-103-126" href="#__codelineno-103-126"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-103-127" name="__codelineno-103-127" href="#__codelineno-103-127"></a>    <span class="n">check_database_health</span><span class="p">()</span>
</code></pre></div>
<p>Make executable:
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>health_check.py
</code></pre></div></p>
<p>Run:
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>python<span class="w"> </span>health_check.py
</code></pre></div></p>
<hr />
<h2 id="practical-activity-61-big-data-analysis-15-minutes">Practical Activity 6.1: Big Data Analysis (15 minutes)</h2>
<p><strong>Task:</strong> Implement data mining queries to analyse your blog data.</p>
<ol>
<li>Create <code>data_analysis.py</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1"># data_analysis.py</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">db_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">query_db</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyse_user_engagement</span><span class="p">():</span>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse user engagement patterns&quot;&quot;&quot;</span>
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;USER ENGAGEMENT ANALYSIS&quot;</span><span class="p">)</span>
<a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a>
<a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a>    <span class="c1"># Most active users</span>
<a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Most Active Users:&quot;</span><span class="p">)</span>
<a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a><span class="s2">        SELECT </span>
<a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a><span class="s2">            users.username,</span>
<a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a><span class="s2">            COUNT(DISTINCT posts.post_id) as posts,</span>
<a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a><span class="s2">            COUNT(DISTINCT comments.comment_id) as comments,</span>
<a id="__codelineno-106-18" name="__codelineno-106-18" href="#__codelineno-106-18"></a><span class="s2">            (COUNT(DISTINCT posts.post_id) + COUNT(DISTINCT comments.comment_id)) as total_activity</span>
<a id="__codelineno-106-19" name="__codelineno-106-19" href="#__codelineno-106-19"></a><span class="s2">        FROM users</span>
<a id="__codelineno-106-20" name="__codelineno-106-20" href="#__codelineno-106-20"></a><span class="s2">        LEFT JOIN posts ON users.user_id = posts.user_id</span>
<a id="__codelineno-106-21" name="__codelineno-106-21" href="#__codelineno-106-21"></a><span class="s2">        LEFT JOIN comments ON users.user_id = comments.user_id</span>
<a id="__codelineno-106-22" name="__codelineno-106-22" href="#__codelineno-106-22"></a><span class="s2">        GROUP BY users.user_id</span>
<a id="__codelineno-106-23" name="__codelineno-106-23" href="#__codelineno-106-23"></a><span class="s2">        HAVING total_activity &gt; 0</span>
<a id="__codelineno-106-24" name="__codelineno-106-24" href="#__codelineno-106-24"></a><span class="s2">        ORDER BY total_activity DESC</span>
<a id="__codelineno-106-25" name="__codelineno-106-25" href="#__codelineno-106-25"></a><span class="s2">        LIMIT 5</span>
<a id="__codelineno-106-26" name="__codelineno-106-26" href="#__codelineno-106-26"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-106-27" name="__codelineno-106-27" href="#__codelineno-106-27"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-106-28" name="__codelineno-106-28" href="#__codelineno-106-28"></a>
<a id="__codelineno-106-29" name="__codelineno-106-29" href="#__codelineno-106-29"></a>    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-106-30" name="__codelineno-106-30" href="#__codelineno-106-30"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;posts&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> posts, </span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> comments&quot;</span><span class="p">)</span>
<a id="__codelineno-106-31" name="__codelineno-106-31" href="#__codelineno-106-31"></a>
<a id="__codelineno-106-32" name="__codelineno-106-32" href="#__codelineno-106-32"></a>    <span class="c1"># Activity by hour</span>
<a id="__codelineno-106-33" name="__codelineno-106-33" href="#__codelineno-106-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Activity by Hour of Day:&quot;</span><span class="p">)</span>
<a id="__codelineno-106-34" name="__codelineno-106-34" href="#__codelineno-106-34"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-106-35" name="__codelineno-106-35" href="#__codelineno-106-35"></a><span class="s2">        SELECT </span>
<a id="__codelineno-106-36" name="__codelineno-106-36" href="#__codelineno-106-36"></a><span class="s2">            strftime(&#39;%H&#39;, created_at) as hour,</span>
<a id="__codelineno-106-37" name="__codelineno-106-37" href="#__codelineno-106-37"></a><span class="s2">            COUNT(*) as activity_count</span>
<a id="__codelineno-106-38" name="__codelineno-106-38" href="#__codelineno-106-38"></a><span class="s2">        FROM (</span>
<a id="__codelineno-106-39" name="__codelineno-106-39" href="#__codelineno-106-39"></a><span class="s2">            SELECT created_at FROM posts</span>
<a id="__codelineno-106-40" name="__codelineno-106-40" href="#__codelineno-106-40"></a><span class="s2">            UNION ALL</span>
<a id="__codelineno-106-41" name="__codelineno-106-41" href="#__codelineno-106-41"></a><span class="s2">            SELECT created_at FROM comments</span>
<a id="__codelineno-106-42" name="__codelineno-106-42" href="#__codelineno-106-42"></a><span class="s2">        )</span>
<a id="__codelineno-106-43" name="__codelineno-106-43" href="#__codelineno-106-43"></a><span class="s2">        GROUP BY hour</span>
<a id="__codelineno-106-44" name="__codelineno-106-44" href="#__codelineno-106-44"></a><span class="s2">        ORDER BY hour</span>
<a id="__codelineno-106-45" name="__codelineno-106-45" href="#__codelineno-106-45"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-106-46" name="__codelineno-106-46" href="#__codelineno-106-46"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-106-47" name="__codelineno-106-47" href="#__codelineno-106-47"></a>
<a id="__codelineno-106-48" name="__codelineno-106-48" href="#__codelineno-106-48"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-106-49" name="__codelineno-106-49" href="#__codelineno-106-49"></a>        <span class="n">bar</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;activity_count&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-106-50" name="__codelineno-106-50" href="#__codelineno-106-50"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:00 </span><span class="si">{</span><span class="n">bar</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;activity_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-106-51" name="__codelineno-106-51" href="#__codelineno-106-51"></a>
<a id="__codelineno-106-52" name="__codelineno-106-52" href="#__codelineno-106-52"></a>    <span class="c1"># Popular content</span>
<a id="__codelineno-106-53" name="__codelineno-106-53" href="#__codelineno-106-53"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Most Commented Posts:&quot;</span><span class="p">)</span>
<a id="__codelineno-106-54" name="__codelineno-106-54" href="#__codelineno-106-54"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-106-55" name="__codelineno-106-55" href="#__codelineno-106-55"></a><span class="s2">        SELECT </span>
<a id="__codelineno-106-56" name="__codelineno-106-56" href="#__codelineno-106-56"></a><span class="s2">            posts.title,</span>
<a id="__codelineno-106-57" name="__codelineno-106-57" href="#__codelineno-106-57"></a><span class="s2">            users.username as author,</span>
<a id="__codelineno-106-58" name="__codelineno-106-58" href="#__codelineno-106-58"></a><span class="s2">            COUNT(comments.comment_id) as comment_count</span>
<a id="__codelineno-106-59" name="__codelineno-106-59" href="#__codelineno-106-59"></a><span class="s2">        FROM posts</span>
<a id="__codelineno-106-60" name="__codelineno-106-60" href="#__codelineno-106-60"></a><span class="s2">        INNER JOIN users ON posts.user_id = users.user_id</span>
<a id="__codelineno-106-61" name="__codelineno-106-61" href="#__codelineno-106-61"></a><span class="s2">        LEFT JOIN comments ON posts.post_id = comments.post_id</span>
<a id="__codelineno-106-62" name="__codelineno-106-62" href="#__codelineno-106-62"></a><span class="s2">        GROUP BY posts.post_id</span>
<a id="__codelineno-106-63" name="__codelineno-106-63" href="#__codelineno-106-63"></a><span class="s2">        HAVING comment_count &gt; 0</span>
<a id="__codelineno-106-64" name="__codelineno-106-64" href="#__codelineno-106-64"></a><span class="s2">        ORDER BY comment_count DESC</span>
<a id="__codelineno-106-65" name="__codelineno-106-65" href="#__codelineno-106-65"></a><span class="s2">        LIMIT 5</span>
<a id="__codelineno-106-66" name="__codelineno-106-66" href="#__codelineno-106-66"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-106-67" name="__codelineno-106-67" href="#__codelineno-106-67"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-106-68" name="__codelineno-106-68" href="#__codelineno-106-68"></a>
<a id="__codelineno-106-69" name="__codelineno-106-69" href="#__codelineno-106-69"></a>    <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-106-70" name="__codelineno-106-70" href="#__codelineno-106-70"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   &#39;</span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; by </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">post</span><span class="p">[</span><span class="s1">&#39;comment_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> comments&quot;</span><span class="p">)</span>
<a id="__codelineno-106-71" name="__codelineno-106-71" href="#__codelineno-106-71"></a>
<a id="__codelineno-106-72" name="__codelineno-106-72" href="#__codelineno-106-72"></a><span class="k">def</span><span class="w"> </span><span class="nf">analyse_metadata</span><span class="p">():</span>
<a id="__codelineno-106-73" name="__codelineno-106-73" href="#__codelineno-106-73"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse metadata patterns&quot;&quot;&quot;</span>
<a id="__codelineno-106-74" name="__codelineno-106-74" href="#__codelineno-106-74"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-106-75" name="__codelineno-106-75" href="#__codelineno-106-75"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;METADATA ANALYSIS&quot;</span><span class="p">)</span>
<a id="__codelineno-106-76" name="__codelineno-106-76" href="#__codelineno-106-76"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-106-77" name="__codelineno-106-77" href="#__codelineno-106-77"></a>
<a id="__codelineno-106-78" name="__codelineno-106-78" href="#__codelineno-106-78"></a>    <span class="c1"># Account age distribution</span>
<a id="__codelineno-106-79" name="__codelineno-106-79" href="#__codelineno-106-79"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> User Account Age Distribution:&quot;</span><span class="p">)</span>
<a id="__codelineno-106-80" name="__codelineno-106-80" href="#__codelineno-106-80"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-106-81" name="__codelineno-106-81" href="#__codelineno-106-81"></a><span class="s2">        SELECT </span>
<a id="__codelineno-106-82" name="__codelineno-106-82" href="#__codelineno-106-82"></a><span class="s2">            CASE</span>
<a id="__codelineno-106-83" name="__codelineno-106-83" href="#__codelineno-106-83"></a><span class="s2">                WHEN julianday(&#39;now&#39;) - julianday(created_at) &lt; 7 THEN &#39;Less than 1 week&#39;</span>
<a id="__codelineno-106-84" name="__codelineno-106-84" href="#__codelineno-106-84"></a><span class="s2">                WHEN julianday(&#39;now&#39;) - julianday(created_at) &lt; 30 THEN &#39;1-4 weeks&#39;</span>
<a id="__codelineno-106-85" name="__codelineno-106-85" href="#__codelineno-106-85"></a><span class="s2">                WHEN julianday(&#39;now&#39;) - julianday(created_at) &lt; 90 THEN &#39;1-3 months&#39;</span>
<a id="__codelineno-106-86" name="__codelineno-106-86" href="#__codelineno-106-86"></a><span class="s2">                ELSE &#39;Over 3 months&#39;</span>
<a id="__codelineno-106-87" name="__codelineno-106-87" href="#__codelineno-106-87"></a><span class="s2">            END as account_age,</span>
<a id="__codelineno-106-88" name="__codelineno-106-88" href="#__codelineno-106-88"></a><span class="s2">            COUNT(*) as user_count</span>
<a id="__codelineno-106-89" name="__codelineno-106-89" href="#__codelineno-106-89"></a><span class="s2">        FROM users</span>
<a id="__codelineno-106-90" name="__codelineno-106-90" href="#__codelineno-106-90"></a><span class="s2">        GROUP BY account_age</span>
<a id="__codelineno-106-91" name="__codelineno-106-91" href="#__codelineno-106-91"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-106-92" name="__codelineno-106-92" href="#__codelineno-106-92"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-106-93" name="__codelineno-106-93" href="#__codelineno-106-93"></a>
<a id="__codelineno-106-94" name="__codelineno-106-94" href="#__codelineno-106-94"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-106-95" name="__codelineno-106-95" href="#__codelineno-106-95"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;account_age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;user_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> users&quot;</span><span class="p">)</span>
<a id="__codelineno-106-96" name="__codelineno-106-96" href="#__codelineno-106-96"></a>
<a id="__codelineno-106-97" name="__codelineno-106-97" href="#__codelineno-106-97"></a>    <span class="c1"># Content length analysis</span>
<a id="__codelineno-106-98" name="__codelineno-106-98" href="#__codelineno-106-98"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Post Length Analysis:&quot;</span><span class="p">)</span>
<a id="__codelineno-106-99" name="__codelineno-106-99" href="#__codelineno-106-99"></a>    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-106-100" name="__codelineno-106-100" href="#__codelineno-106-100"></a><span class="s2">        SELECT </span>
<a id="__codelineno-106-101" name="__codelineno-106-101" href="#__codelineno-106-101"></a><span class="s2">            CASE</span>
<a id="__codelineno-106-102" name="__codelineno-106-102" href="#__codelineno-106-102"></a><span class="s2">                WHEN LENGTH(content) &lt; 100 THEN &#39;Short (&lt; 100 chars)&#39;</span>
<a id="__codelineno-106-103" name="__codelineno-106-103" href="#__codelineno-106-103"></a><span class="s2">                WHEN LENGTH(content) &lt; 500 THEN &#39;Medium (100-500 chars)&#39;</span>
<a id="__codelineno-106-104" name="__codelineno-106-104" href="#__codelineno-106-104"></a><span class="s2">                ELSE &#39;Long (&gt; 500 chars)&#39;</span>
<a id="__codelineno-106-105" name="__codelineno-106-105" href="#__codelineno-106-105"></a><span class="s2">            END as post_length,</span>
<a id="__codelineno-106-106" name="__codelineno-106-106" href="#__codelineno-106-106"></a><span class="s2">            COUNT(*) as post_count,</span>
<a id="__codelineno-106-107" name="__codelineno-106-107" href="#__codelineno-106-107"></a><span class="s2">            AVG(LENGTH(content)) as avg_length</span>
<a id="__codelineno-106-108" name="__codelineno-106-108" href="#__codelineno-106-108"></a><span class="s2">        FROM posts</span>
<a id="__codelineno-106-109" name="__codelineno-106-109" href="#__codelineno-106-109"></a><span class="s2">        GROUP BY post_length</span>
<a id="__codelineno-106-110" name="__codelineno-106-110" href="#__codelineno-106-110"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-106-111" name="__codelineno-106-111" href="#__codelineno-106-111"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<a id="__codelineno-106-112" name="__codelineno-106-112" href="#__codelineno-106-112"></a>
<a id="__codelineno-106-113" name="__codelineno-106-113" href="#__codelineno-106-113"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
<a id="__codelineno-106-114" name="__codelineno-106-114" href="#__codelineno-106-114"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;post_length&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;post_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> posts (avg: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;avg_length&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> chars)&quot;</span><span class="p">)</span>
<a id="__codelineno-106-115" name="__codelineno-106-115" href="#__codelineno-106-115"></a>
<a id="__codelineno-106-116" name="__codelineno-106-116" href="#__codelineno-106-116"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-106-117" name="__codelineno-106-117" href="#__codelineno-106-117"></a>    <span class="n">analyse_user_engagement</span><span class="p">()</span>
<a id="__codelineno-106-118" name="__codelineno-106-118" href="#__codelineno-106-118"></a>    <span class="n">analyse_metadata</span><span class="p">()</span>
</code></pre></div>
<ol>
<li>Populate test data for analysis:</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1"># populate_test_data.py</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">db_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_db</span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_password_hash</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="c1"># Create test users</span>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alice&#39;</span><span class="p">,</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;diana&#39;</span><span class="p">,</span> <span class="s1">&#39;eve&#39;</span><span class="p">]</span>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">usernames</span><span class="p">:</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>        <span class="n">execute_db</span><span class="p">(</span>
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>            <span class="s1">&#39;INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)&#39;</span><span class="p">,</span>
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a>            <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">@example.com&#39;</span><span class="p">,</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="s1">&#39;password123&#39;</span><span class="p">))</span>
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a>        <span class="p">)</span>
<a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a>        <span class="k">pass</span>  <span class="c1"># User may already exist</span>
<a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a>
<a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="c1"># Create test posts</span>
<a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="n">post_titles</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a>    <span class="s1">&#39;Getting Started with Python&#39;</span><span class="p">,</span>
<a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a>    <span class="s1">&#39;Web Development Best Practices&#39;</span><span class="p">,</span>
<a id="__codelineno-107-21" name="__codelineno-107-21" href="#__codelineno-107-21"></a>    <span class="s1">&#39;Database Design Patterns&#39;</span><span class="p">,</span>
<a id="__codelineno-107-22" name="__codelineno-107-22" href="#__codelineno-107-22"></a>    <span class="s1">&#39;Understanding SQL Injection&#39;</span><span class="p">,</span>
<a id="__codelineno-107-23" name="__codelineno-107-23" href="#__codelineno-107-23"></a>    <span class="s1">&#39;Building Secure Applications&#39;</span>
<a id="__codelineno-107-24" name="__codelineno-107-24" href="#__codelineno-107-24"></a><span class="p">]</span>
<a id="__codelineno-107-25" name="__codelineno-107-25" href="#__codelineno-107-25"></a>
<a id="__codelineno-107-26" name="__codelineno-107-26" href="#__codelineno-107-26"></a><span class="n">post_contents</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-107-27" name="__codelineno-107-27" href="#__codelineno-107-27"></a>    <span class="s1">&#39;Short post.&#39;</span><span class="p">,</span>
<a id="__codelineno-107-28" name="__codelineno-107-28" href="#__codelineno-107-28"></a>    <span class="s1">&#39;This is a medium-length post with some interesting content about web development.&#39;</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-107-29" name="__codelineno-107-29" href="#__codelineno-107-29"></a>    <span class="s1">&#39;This is a longer post with extensive detail about database design and normalisation principles.&#39;</span> <span class="o">*</span> <span class="mi">10</span>
<a id="__codelineno-107-30" name="__codelineno-107-30" href="#__codelineno-107-30"></a><span class="p">]</span>
<a id="__codelineno-107-31" name="__codelineno-107-31" href="#__codelineno-107-31"></a>
<a id="__codelineno-107-32" name="__codelineno-107-32" href="#__codelineno-107-32"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-107-33" name="__codelineno-107-33" href="#__codelineno-107-33"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-107-34" name="__codelineno-107-34" href="#__codelineno-107-34"></a>    <span class="n">title</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">post_titles</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-107-35" name="__codelineno-107-35" href="#__codelineno-107-35"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">post_contents</span><span class="p">)</span>
<a id="__codelineno-107-36" name="__codelineno-107-36" href="#__codelineno-107-36"></a>
<a id="__codelineno-107-37" name="__codelineno-107-37" href="#__codelineno-107-37"></a>    <span class="n">execute_db</span><span class="p">(</span>
<a id="__codelineno-107-38" name="__codelineno-107-38" href="#__codelineno-107-38"></a>        <span class="s1">&#39;INSERT INTO posts (user_id, title, content) VALUES (?, ?, ?)&#39;</span><span class="p">,</span>
<a id="__codelineno-107-39" name="__codelineno-107-39" href="#__codelineno-107-39"></a>        <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-107-40" name="__codelineno-107-40" href="#__codelineno-107-40"></a>    <span class="p">)</span>
<a id="__codelineno-107-41" name="__codelineno-107-41" href="#__codelineno-107-41"></a>
<a id="__codelineno-107-42" name="__codelineno-107-42" href="#__codelineno-107-42"></a><span class="c1"># Create test comments</span>
<a id="__codelineno-107-43" name="__codelineno-107-43" href="#__codelineno-107-43"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
<a id="__codelineno-107-44" name="__codelineno-107-44" href="#__codelineno-107-44"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-107-45" name="__codelineno-107-45" href="#__codelineno-107-45"></a>    <span class="n">post_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-107-46" name="__codelineno-107-46" href="#__codelineno-107-46"></a>    <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Great post! This is comment number </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">.&#39;</span>
<a id="__codelineno-107-47" name="__codelineno-107-47" href="#__codelineno-107-47"></a>
<a id="__codelineno-107-48" name="__codelineno-107-48" href="#__codelineno-107-48"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-107-49" name="__codelineno-107-49" href="#__codelineno-107-49"></a>        <span class="n">execute_db</span><span class="p">(</span>
<a id="__codelineno-107-50" name="__codelineno-107-50" href="#__codelineno-107-50"></a>            <span class="s1">&#39;INSERT INTO comments (user_id, post_id, content) VALUES (?, ?, ?)&#39;</span><span class="p">,</span>
<a id="__codelineno-107-51" name="__codelineno-107-51" href="#__codelineno-107-51"></a>            <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">post_id</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-107-52" name="__codelineno-107-52" href="#__codelineno-107-52"></a>        <span class="p">)</span>
<a id="__codelineno-107-53" name="__codelineno-107-53" href="#__codelineno-107-53"></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-107-54" name="__codelineno-107-54" href="#__codelineno-107-54"></a>        <span class="k">pass</span>  <span class="c1"># Post may not exist</span>
<a id="__codelineno-107-55" name="__codelineno-107-55" href="#__codelineno-107-55"></a>
<a id="__codelineno-107-56" name="__codelineno-107-56" href="#__codelineno-107-56"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Test data populated successfully!&#39;</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>
<p>Run analysis:
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>python<span class="w"> </span>populate_test_data.py
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a>python<span class="w"> </span>data_analysis.py
</code></pre></div></p>
</li>
<li>
<p><strong>Git commit:</strong> "Add data mining analysis tools"</p>
</li>
</ol>
<div class="admonition success">
<p class="admonition-title">Checkpoint</p>
<p>You should see:</p>
<ul>
<li>User engagement statistics</li>
<li>Activity patterns by hour</li>
<li>Popular content identification</li>
<li>Metadata insights about post lengths and account ages</li>
</ul>
</div>
<hr />
<h2 id="summary-key-takeaways">Summary &amp; Key Takeaways</h2>
<h3 id="what-youve-learned">What You've Learned</h3>
<p> <strong>Big Data Concepts:</strong> Understanding scalability challenges and solutions</p>
<p> <strong>Data Mining:</strong> Extracting insights from user behaviour and content patterns</p>
<p> <strong>Metadata Management:</strong> Using "data about data" to improve system functionality</p>
<p> <strong>Advanced Indexing:</strong> How indexes work and when to use them</p>
<p> <strong>Database Administration:</strong> Automated backups, restoration, and health monitoring</p>
<h3 id="practical-skills-acquired">Practical Skills Acquired</h3>
<ul>
<li>Writing data mining queries for business intelligence</li>
<li>Implementing metadata tracking for files and content</li>
<li>Creating comprehensive backup and restoration scripts</li>
<li>Monitoring database health and performance</li>
<li>Understanding trade-offs in database design for scale</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Teacher Notes: Part 6</p>
<p><strong>Formative Assessment:</strong></p>
<ul>
<li>Can students explain the difference between data and metadata?</li>
<li>Can they identify when a query would benefit from an index?</li>
<li>Do they understand privacy implications of data mining?</li>
<li>Can they interpret data mining results to make decisions?</li>
</ul>
</div>
<hr />
<h2 id="syllabus-alignment-summary">Syllabus Alignment Summary</h2>
<div class="admonition success">
<p class="admonition-title">Programming for the Web - 100% Coverage</p>
<p> Model elements that form a web development system (databases)<br />
 Observe and describe back-end process (database operations)<br />
 Shell scripts (backup automation)<br />
 SQL queries (SELECT, INSERT, UPDATE, DELETE, GROUP BY, WHERE, JOINs)<br />
 Big data concepts (indexing, metadata, data mining introduction)</p>
</div>
<div class="admonition success">
<p class="admonition-title">Secure Software Architecture - 100% Coverage</p>
<p> Security concepts applied to data (confidentiality, integrity, availability)<br />
 Defensive input handling (preventing SQL injection)<br />
 Security features for data protection (prepared statements, least privilege)</p>
</div>
<hr />
<h2 id="student-self-assessment-checklist">Student Self-Assessment Checklist</h2>
<p>Use this checklist to verify you've mastered all content:</p>
<h3 id="database-fundamentals">Database Fundamentals</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can explain the difference between SQL and NoSQL databases</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I understand what CRUD operations are and can identify them</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can explain what primary keys and foreign keys are</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can describe database normalisation and why it matters</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can securely configure database connections using environment variables</li>
</ul>
<h3 id="sql-queries">SQL Queries</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write INSERT statements to create new records</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write SELECT statements with WHERE, ORDER BY, and LIMIT</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can use aggregate functions (COUNT, SUM, AVG, MIN, MAX)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can use GROUP BY to analyse data</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write UPDATE statements (with WHERE clause!)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write DELETE statements (with WHERE clause!)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can perform INNER JOIN to combine tables</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can perform LEFT JOIN to show all records from one table</li>
</ul>
<h3 id="security">Security</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can explain what SQL injection is and why it's dangerous</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can identify vulnerable code that uses string concatenation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write queries using prepared statements (parameterised queries)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can test my code against SQL injection attacks</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I understand defence in depth (multiple security layers)</li>
</ul>
<h3 id="performance-operations">Performance &amp; Operations</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can explain what database indexes are and why they improve performance</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can create indexes on appropriate columns</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can use EXPLAIN to analyse query performance</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can write shell scripts to backup databases</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I can restore databases from backups</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I understand the 3-2-1 backup rule</li>
</ul>
<h3 id="integration">Integration</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I have integrated my Week 7 authentication with the database</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> All my queries use prepared statements</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> My data persists across server restarts</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> I have tested my application's security</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> My Git history shows clear, meaningful commits</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Self-Assessment Score</p>
<ul>
<li><strong>All checked:</strong> Excellent! You're ready for Week 9</li>
<li><strong>80%+ checked:</strong> Good progress, review unchecked items</li>
<li><strong>60-80% checked:</strong> Review content parts with gaps</li>
<li><strong>&lt;60% checked:</strong> Revisit lesson, complete all activities</li>
</ul>
</div>
<hr />
<h2 id="teacher-notes">Teacher Notes</h2>
<details class="note">
<summary>Differentiation Strategies</summary>
<p><strong>For Students Who Need Support:</strong></p>
<ol>
<li><strong>Simplified Schema:</strong> Start with just two tables (users and posts) instead of four</li>
<li><strong>Visual Tools:</strong> Use DB Browser for SQLite GUI instead of command-line only</li>
<li><strong>Pre-written Queries:</strong> Provide SQL query templates with blanks to fill in</li>
<li><strong>Paired Programming:</strong> Partner stronger students with those needing support for Activities 4 and 5</li>
<li><strong>Extended Time:</strong> Allow 150 minutes instead of 120 for completion</li>
<li><strong>Video Walkthroughs:</strong> Provide recorded demonstrations of complex topics (JOINs, prepared statements)</li>
<li>Focus on basic data mining queries and simple backup scripts</li>
</ol>
<p><strong>For Advanced Students:</strong></p>
<ol>
<li><strong>Advanced Queries:</strong> Challenge with complex multi-table JOINs and subqueries</li>
<li><strong>ORM Preview:</strong> Introduce SQLAlchemy or similar ORM as extension</li>
<li><strong>Performance Optimisation:</strong> Profile queries, optimise slow queries, create covering indexes</li>
<li><strong>Database Security:</strong> Research and implement row-level security</li>
<li><strong>Migration System:</strong> Create database migration system from scratch</li>
<li><strong>Peer Teaching:</strong> Have them help struggling classmates during activities</li>
<li><strong>Real-World Challenge:</strong> Design schema for complex system (e.g., e-commerce with orders, products, inventory)</li>
<li>Explore machine learning applications, implement predictive analytics, create distributed database simulations</li>
</ol>
</details>
<details class="note">
<summary>Common Misconceptions</summary>
<div class="admonition warning">
<p class="admonition-title">Misconception #1: SELECT * is Fine</p>
<p><strong>Misconception:</strong> "It's easier to just SELECT * from tables"</p>
<p><strong>Reality:</strong> This is inefficient and can expose sensitive data</p>
<p><strong>Correction:</strong> Always specify exact columns needed. Show performance difference with EXPLAIN.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception #2: Client-Side Validation is Enough</p>
<p><strong>Misconception:</strong> "I already validate in JavaScript, so SQL injection isn't possible"</p>
<p><strong>Reality:</strong> Attackers bypass client-side validation entirely (use Postman, cURL, or modify browser requests)</p>
<p><strong>Correction:</strong> Demonstrate bypassing client validation with Postman. Show that server MUST validate.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception #3: Escaping is Same as Prepared Statements</p>
<p><strong>Misconception:</strong> "Can't I just remove dangerous characters instead of using prepared statements?"</p>
<p><strong>Reality:</strong> Blacklist approaches always miss edge cases. Prepared statements are foolproof.</p>
<p><strong>Correction:</strong> Show that even "sanitised" input can sometimes be exploited. Prepared statements are non-negotiable.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception #4: Backups Happen Automatically</p>
<p><strong>Misconception:</strong> "The database saves my data, so I don't need backups"</p>
<p><strong>Reality:</strong> Deletion, corruption, and hardware failure can destroy data permanently</p>
<p><strong>Correction:</strong> Simulate data loss scenario (delete table), show recovery from backup.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception #5: Indexes Make Everything Faster</p>
<p><strong>Misconception:</strong> "I should index every column for maximum speed"</p>
<p><strong>Reality:</strong> Too many indexes slow down INSERT/UPDATE/DELETE operations and waste space</p>
<p><strong>Correction:</strong> Show performance impact on writes. Teach strategic indexing.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception #6: Foreign Keys are Optional</p>
<p><strong>Misconception:</strong> "I can just store the user_id without making it a foreign key"</p>
<p><strong>Reality:</strong> Foreign keys enforce referential integrity and prevent orphaned records</p>
<p><strong>Correction:</strong> Demonstrate orphaned post (author deleted but post remains). Show ON DELETE CASCADE.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Misconception 7: Big Data</p>
<ul>
<li>"Big data always means millions of records" - It's relative to your infrastructure</li>
<li>"More metadata is always better" - Balance between utility and storage overhead</li>
<li>"Indexes solve all performance problems" - They have trade-offs</li>
<li>"Data mining is just running queries" - It's about discovering actionable insights</li>
</ul>
</div>
</details>
<details class="note">
<summary>Formative Assessment Strategies</summary>
<p><strong>During Activities (Informal Assessment):</strong></p>
<ol>
<li><strong>Code Review Checkpoints:</strong> Circulate during Activity 4.3, check for prepared statements</li>
<li><strong>Question Asking:</strong> Pose questions during demonstrations: "What would happen if...?"</li>
<li><strong>Exit Ticket Questions:</strong><ul>
<li>"Explain SQL injection in your own words"</li>
<li>"When would you use LEFT JOIN vs INNER JOIN?"</li>
<li>"Why are prepared statements important?"</li>
</ul>
</li>
</ol>
<p><strong>Hands-On Demonstrations:</strong></p>
<ol>
<li><strong>Live Debugging:</strong> Students share screen, debug SQL errors together</li>
<li><strong>Security Testing:</strong> Students attempt to SQL inject each other's code (controlled)</li>
<li><strong>Query Optimization Competition:</strong> Who can write fastest query? Use EXPLAIN to verify.</li>
</ol>
<p><strong>Written Checks:</strong></p>
<ol>
<li>
<p><strong>Quick Quiz (10 minutes):</strong></p>
<ul>
<li>Identify vulnerable code</li>
<li>Write correct prepared statement</li>
<li>Explain when to use indexes</li>
</ul>
</li>
<li>
<p><strong>Reflection Prompts:</strong></p>
<ul>
<li>"What was most challenging about SQL injection prevention?"</li>
<li>"How does this week connect to Week 7's authentication?"</li>
</ul>
</li>
</ol>
<p><strong>Practical Checks:</strong></p>
<ol>
<li><strong>Commit History Review:</strong> Check Git logs for proper progression and meaningful messages</li>
<li><strong>Security Audit:</strong> Review student projects for SQL injection vulnerabilities</li>
</ol>
</details>
<details class="note">
<summary>Diagnostic Questions</summary>
<div class="admonition question">
<p class="admonition-title">Check Understanding: CRUD</p>
<p>"Your friend says their blog needs to 'CRUD posts.' What do they mean? Give an example of each operation."</p>
</div>
<div class="admonition question">
<p class="admonition-title">Check Understanding: SQL Injection</p>
<p>"A user enters <code>admin'; DROP TABLE users;--</code> in the username field. Walk me through what happens with vulnerable code vs prepared statements."</p>
</div>
<div class="admonition question">
<p class="admonition-title">Check Understanding: JOINs</p>
<p>"You want to show all blog categories, even ones with zero posts. Which JOIN type do you use and why?"</p>
</div>
<div class="admonition question">
<p class="admonition-title">Check Understanding: Indexing</p>
<p>"Your posts table has 1 million rows. Users complain that searching by title is slow. What do you do?"</p>
</div>
</details>
<details class="note">
<summary>Extension Activities</summary>
<p><strong>For Students Who Finish Early:</strong></p>
<ol>
<li>
<p><strong>Advanced Queries Challenge:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="c1">-- Find users who posted more than the average</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="c1">-- Find the 3rd most commented post</span>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="c1">-- Show monthly post counts for the past year</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Transactions and Rollback:</strong></p>
<ul>
<li>Research SQL transactions</li>
<li>Implement BEGIN/COMMIT/ROLLBACK</li>
<li>Handle errors gracefully</li>
</ul>
</li>
<li>
<p><strong>Database Migrations:</strong></p>
<ul>
<li>Create numbered migration files</li>
<li>Write UP and DOWN scripts</li>
<li>Track migration history</li>
</ul>
</li>
<li>
<p><strong>Query Performance Lab:</strong></p>
<ul>
<li>Profile slow queries</li>
<li>Optimise with indexes and query rewrites</li>
<li>Document 10x+ performance improvements</li>
</ul>
</li>
<li>
<p><strong>Full-Text Search:</strong></p>
<ul>
<li>Implement search functionality</li>
<li>Create search indexes</li>
<li>Rank results by relevance</li>
</ul>
</li>
</ol>
</details>
<h3 id="resources-and-tools">Resources and Tools</h3>
<p><strong>Essential Tools:</strong></p>
<ul>
<li>SQLite (included with Python)</li>
<li>DB Browser for SQLite (visual database tool)</li>
<li>VSCode + SQLite or Postgres plugin</li>
<li>Postman (API testing)</li>
</ul>
<p><strong>Documentation:</strong></p>
<ul>
<li><a href="https://www.sqlite.org/docs.html">SQLite Documentation</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html">SQL Injection Prevention Cheat Sheet</a></li>
<li><a href="https://owasp.org/www-project-top-ten/">OWASP Top 10</a></li>
</ul>
<p><strong>Practice Platforms:</strong></p>
<ul>
<li><a href="https://sqlbolt.com/">SQLBolt</a> - Interactive SQL tutorial</li>
<li><a href="https://mystery.knightlab.com/">SQL Murder Mystery</a> - Learn SQL through gamification</li>
<li><a href="https://www.hackerrank.com/domains/sql">HackerRank SQL</a> - SQL challenges</li>
</ul>
<h3 id="assessment-rubric">Assessment Rubric</h3>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Excellent (4)</th>
<th>Proficient (3)</th>
<th>Developing (2)</th>
<th>Beginning (1)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Schema Design</strong></td>
<td>Fully normalised, appropriate data types, all relationships defined</td>
<td>Minor normalisation issues, mostly correct</td>
<td>Poor normalisation, missing relationships</td>
<td>Unnormalised, incorrect structure</td>
</tr>
<tr>
<td><strong>SQL Queries</strong></td>
<td>All CRUD operations work, efficient queries, correct JOINs</td>
<td>Mostly correct, some inefficiencies</td>
<td>Some queries work, errors in complex operations</td>
<td>Major errors, cannot complete basic operations</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>All queries use prepared statements, tested against attacks</td>
<td>Mostly secure, 1-2 vulnerabilities</td>
<td>Some prepared statements, significant vulnerabilities</td>
<td>String concatenation, highly vulnerable</td>
</tr>
<tr>
<td><strong>Indexing</strong></td>
<td>Strategic indexing, measured performance improvement</td>
<td>Indexes created but not optimised</td>
<td>Attempted indexing with errors</td>
<td>No indexes or incorrect implementation</td>
</tr>
<tr>
<td><strong>Backups</strong></td>
<td>Working backup and restore scripts, tested successfully</td>
<td>Scripts work but untested or incomplete</td>
<td>Scripts have errors or incomplete</td>
<td>No functional backup system</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="conclusion-and-next-steps">Conclusion and Next Steps</h2>
<div class="admonition success">
<p class="admonition-title">Congratulations!</p>
<p>You've completed Week 8: Database Integration &amp; SQL Security!</p>
<p>You now have:</p>
<ul>
<li> A persistent database replacing in-memory storage</li>
<li> Secure queries using prepared statements</li>
<li> Protection against SQL injection attacks</li>
<li> Optimised performance with indexes</li>
<li> Automated backup system</li>
</ul>
</div>
<h3 id="connection-to-week-9">Connection to Week 9</h3>
<p>Next week, you'll build on this foundation:</p>
<ul>
<li><strong>Authentication</strong>  <strong>Authorization</strong> (who can do what?)</li>
<li><strong>User storage</strong>  <strong>Role-Based Access Control</strong> (admin, moderator, user)</li>
<li><strong>Basic security</strong>  <strong>CSRF Protection</strong> (prevent cross-site attacks)</li>
<li><strong>Simple sessions</strong>  <strong>Secure Session Management</strong> (proper cookies, expiration)</li>
</ul>
<h3 id="final-checklist-before-moving-on">Final Checklist Before Moving On</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> All database queries use prepared statements</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Schema is normalised with proper relationships</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Indexes created on frequently queried columns</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Backup and restore tested successfully</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Week 7 authentication integrated with database</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Data persists across server restarts</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> SQL injection tests all fail (good!)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Git history shows clear progression</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> <code>.env</code> file in <code>.gitignore</code> (not committed!)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Keep Practising</p>
<ul>
<li>Review SQL queries daily</li>
<li>Never write SQL without prepared statements</li>
<li>Test your backups regularly</li>
<li>Always use WHERE with UPDATE and DELETE!</li>
</ul>
</div>
<p><strong>You're ready for Complete Authentication, Authorization &amp; CSRF Protection!</strong></p><style type="text/css">.quiz {
  border: 1px solid black;
  padding: 1rem;
  margin: 1rem 0;
  position: relative;
}
/* Set margin-top of first quiz child (skip the header link) */
.quiz > .quiz-question:first-of-type {
  margin-top: 0;
}
/* Remove top margin from first element inside quiz-question */
.quiz-question > *:first-child {
  margin-top: 0;
}
.hidden {
  display: none;
}

form button {
  background-color: var(--md-primary-fg-color);
  border: none;
  color: var(--md-primary-bg-color);
  padding: 0.5rem 1rem;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 0.8rem;
  cursor: pointer;
  transition:
    opacity 0.2s,
    background-color 0.2s;
}

form button:hover:not(:disabled) {
  opacity: 0.9;
}

form button:disabled {
  background-color: var(--md-default-fg-color--lighter, #ccc);
  color: var(--md-default-fg-color--light, #666);
  cursor: not-allowed;
  opacity: 0.6;
}

.wrong label,
.wrong label * {
  color: #dc3545;
}
.correct label,
.correct label * {
  color: #198754;
}

fieldset {
  border: none;
  display: flex;
  flex-direction: column;
}
fieldset input {
  margin: 0 10px;
}
fieldset label {
  margin: 0 10px;
}

input[type="radio"].correct {
  accent-color: #198754;
}
input[type="radio"].wrong {
  accent-color: #dc3545;
}
.content {
  margin: 10px;
}

/* Quiz feedback message */
.quiz-feedback {
  padding: 0.75rem;
  margin: 0.5rem 0;
  border-radius: 4px;
  font-weight: 500;
}

.quiz-feedback.correct {
  background-color: #d1e7dd;
  border: 1px solid #a3cfbb;
  color: #198754;
}

.quiz-feedback.incorrect {
  background-color: #f8d7da;
  border: 1px solid #f1aeb5;
  color: #dc3545;
}

[data-md-color-scheme="slate"] .quiz-feedback.correct {
  background-color: #051b11;
  border: 1px solid #0f5132;
}

[data-md-color-scheme="slate"] .quiz-feedback.incorrect {
  background-color: #2c0b0e;
  border: 1px solid #842029;
}

/* Quiz header link styling - positioned in top right corner */
.quiz-header-link {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  opacity: 0;
  font-size: 1rem;
  text-decoration: none;
  color: var(--md-default-fg-color--light, #888);
  transition: opacity 0.2s;
  padding: 0.25rem 0.5rem;
}
.quiz:hover .quiz-header-link {
  opacity: 1;
}

/* Quiz number header styling */
.quiz-number {
  margin-top: 0 !important;
  margin-bottom: 0.5rem;
  font-weight: bold;
}

/* Quiz Progress Sidebar - Progress bar styling */
/* Most styling comes from Material's .md-nav classes */
#quiz-progress-sidebar {
  margin-top: 1.5rem;
}
/* if config progress_sidebar_position is top, need top padding instead of bottom */
.md-nav--secondary > #quiz-progress-sidebar:first-child {
  margin-top: 0;
  margin-bottom: 1.5rem;
}
@media screen and (min-width: 59.9375em) {
  #quiz-progress-sidebar .md-nav__list {
    border-left: 3px solid var(--md-default-fg-color--lightest);
  }
}

.quiz-progress-bar {
  width: 100%;
  height: 6px;
  background: var(--md-default-fg-color--lightest, rgba(0, 0, 0, 0.07));
  border-radius: 3px;
  overflow: hidden;
  margin: 0.2rem 0;
  display: flex;
}

.quiz-progress-bar-incorrect {
  height: 100%;
  background: rgba(244, 67, 54, 0.8);
  transition: width 0.3s ease;
}

.quiz-progress-bar-correct {
  height: 100%;
  background: #4caf50;
  transition: width 0.3s ease;
}

.quiz-correct-reset {
  display: flex;
  justify-content: space-between;
}

/* Mobile Quiz Progress Tracker */
/* Shows under navbar on mobile, hidden on desktop */
.quiz-progress-mobile {
  display: none; /* Hidden by default on desktop */
  background-color: var(--md-default-bg-color);
  border-bottom: 1px solid var(--md-default-fg-color--lightest, rgba(0, 0, 0, 0.07));
  padding: 0.8rem;
  margin: 0;
  width: 100%;
  box-sizing: border-box;
  position: sticky;
  top: 48px;
  z-index: 3; /* Below Material header (z-index: 4) but above page content */
}

/* Show mobile tracker only on small screens (mobile/tablet) */
/* Material breakpoint: up to 76.1875em (1219px) */
@media screen and (max-width: 76.1875em) {
  .quiz-progress-mobile {
    display: block;
  }
}

/* Mobile tracker styling adjustments */
.quiz-progress-mobile .md-nav__list {
  padding: 0;
  margin: 0;
  max-width: 61rem;
  margin-left: auto;
  margin-right: auto;
  padding-left: 0.8rem;
  padding-right: 0.8rem;
}

.quiz-progress-mobile .md-nav__item {
  margin: 0.3rem 0;
}

.quiz-progress-mobile .md-nav__link {
  padding: 0.2rem 0;
  font-size: 0.7rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.quiz-progress-mobile .quiz-progress-bar {
  margin: 0.3rem 0;
}

.quiz-progress-mobile .md-ellipsis {
  flex: 1;
}

/* Quiz Intro */
.quiz-intro {
  margin: 1rem 0;
}

.quiz-intro p {
  margin: 0 0 0.5rem 0;
}

/* Quiz Results End Screen */
.quiz-results {
  border: 1px solid black;
  padding: 1.5rem;
  margin: 2rem 0;
  background-color: var(--md-default-bg-color);
  transition: all 0.3s ease;
}

/* Progress state - subtle styling */
.quiz-results-progress {
  text-align: center;
  color: var(--md-default-fg-color--light);
}

.quiz-results-progress h3 {
  margin-top: 0;
  font-size: 1.2rem;
  font-weight: 500;
  color: var(--md-default-fg-color);
}

.quiz-results-stats,
.quiz-results-correct-stats {
  font-size: 0.95rem;
  margin: 0.5rem 0;
}

.quiz-results-answered,
.quiz-results-correct,
.quiz-results-total,
.quiz-results-percentage {
  font-weight: 600;
  color: var(--md-default-fg-color);
}

/* Complete state - bold and prominent styling */
.quiz-results-complete {
  text-align: center;
  padding: 2rem 0;
}

.quiz-results-complete.hidden {
  display: none;
}

.quiz-results-title {
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 1.5rem 0;
  color: var(--md-default-fg-color);
}

.quiz-results-score-display {
  margin: 1.5rem 0;
}

.quiz-results-score-value {
  font-size: 4rem;
  font-weight: 800;
  line-height: 1;
  display: inline-block;
  padding: 0.5rem 1rem;
  border-radius: 12px;
  transition: all 0.3s ease;
}

/* Score color coding */
.quiz-results-score-excellent {
  color: #198754;
  background-color: rgba(25, 135, 84, 0.1);
}

.quiz-results-score-good {
  color: #28a745;
  background-color: rgba(40, 167, 69, 0.1);
}

.quiz-results-score-average {
  color: #ffc107;
  background-color: rgba(255, 193, 7, 0.1);
}

.quiz-results-score-poor {
  color: #fd7e14;
  background-color: rgba(253, 126, 20, 0.1);
}

.quiz-results-score-fail {
  color: #dc3545;
  background-color: rgba(220, 53, 69, 0.1);
}

.quiz-results-message {
  font-size: 1.3rem;
  font-weight: 500;
  margin: 1rem 0 2rem 0;
  color: var(--md-default-fg-color);
}

/* Dark mode adjustments */
[data-md-color-scheme="slate"] .quiz-results-score-excellent {
  color: #4caf50;
  background-color: rgba(76, 175, 80, 0.15);
}

[data-md-color-scheme="slate"] .quiz-results-score-good {
  color: #66bb6a;
  background-color: rgba(102, 187, 106, 0.15);
}

[data-md-color-scheme="slate"] .quiz-results-score-average {
  color: #ffeb3b;
  background-color: rgba(255, 235, 59, 0.15);
}

[data-md-color-scheme="slate"] .quiz-results-score-poor {
  color: #ff9800;
  background-color: rgba(255, 152, 0, 0.15);
}

[data-md-color-scheme="slate"] .quiz-results-score-fail {
  color: #f44336;
  background-color: rgba(244, 67, 54, 0.15);
}
</style><script type="text/javascript">var JSConfetti=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}function n(t){return+t.replace(/px/,"")}function s(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.random()*(e-t)+t;return Math.floor(n*Math.pow(10,i))/Math.pow(10,i)}function o(t){return t[s(0,t.length)]}var a=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function r(t){return Math.log(t)/Math.log(1920)}var h=function(){function e(i){t(this,e);var n=i.initialPosition,a=i.direction,h=i.confettiRadius,c=i.confettiColors,u=i.emojis,l=i.emojiSize,d=i.canvasWidth,f=s(.9,1.7,3)*r(d);this.confettiSpeed={x:f,y:f},this.finalConfettiSpeedX=s(.2,.6,3),this.rotationSpeed=u.length?.01:s(.03,.07,3)*r(d),this.dragForceCoefficient=s(5e-4,9e-4,6),this.radius={x:h,y:h},this.initialRadius=h,this.rotationAngle="left"===a?s(0,.2,3):s(-.2,0,3),this.emojiSize=l,this.emojiRotationAngle=s(0,2*Math.PI),this.radiusYUpdateDirection="down";var m="left"===a?s(82,15)*Math.PI/180:s(-15,-82)*Math.PI/180;this.absCos=Math.abs(Math.cos(m)),this.absSin=Math.abs(Math.sin(m));var v=s(-150,0),p={x:n.x+("left"===a?-v:v)*this.absCos,y:n.y-v*this.absSin};this.currentPosition=Object.assign({},p),this.initialPosition=Object.assign({},p),this.color=u.length?null:o(c),this.emoji=u.length?o(u):null,this.createdAt=(new Date).getTime(),this.direction=a}return i(e,[{key:"draw",value:function(t){var e=this.currentPosition,i=this.radius,n=this.color,s=this.emoji,o=this.rotationAngle,a=this.emojiRotationAngle,r=this.emojiSize,h=window.devicePixelRatio;n?(t.fillStyle=n,t.beginPath(),t.ellipse(e.x*h,e.y*h,i.x*h,i.y*h,o,0,2*Math.PI),t.fill()):s&&(t.font="".concat(r,"px serif"),t.save(),t.translate(h*e.x,h*e.y),t.rotate(a),t.textAlign="center",t.fillText(s,0,0),t.restore())}},{key:"updatePosition",value:function(t,e){var i=this.confettiSpeed,n=this.dragForceCoefficient,s=this.finalConfettiSpeedX,o=this.radiusYUpdateDirection,a=this.rotationSpeed,r=this.createdAt,h=this.direction,c=e-r;i.x>s&&(this.confettiSpeed.x-=n*t),this.currentPosition.x+=i.x*("left"===h?-this.absCos:this.absCos)*t,this.currentPosition.y=this.initialPosition.y-i.y*this.absSin*c+.00125*Math.pow(c,2)/2,this.rotationSpeed-=this.emoji?1e-4:1e-5*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji?this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI):"down"===o?(this.radius.y-=t*a,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*a,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+100}}]),e}();function c(){var t=document.createElement("canvas");return t.style.position="fixed",t.style.width="100%",t.style.height="100%",t.style.top="0",t.style.left="0",t.style.zIndex="1000",t.style.pointerEvents="none",document.body.appendChild(t),t}function u(t){var e=t.confettiRadius,i=void 0===e?6:e,n=t.confettiNumber,s=void 0===n?t.confettiesNumber||(t.emojis?40:250):n,o=t.confettiColors,r=void 0===o?a:o,h=t.emojis,c=void 0===h?t.emojies||[]:h,u=t.emojiSize,l=void 0===u?80:u;return t.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),t.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:i,confettiNumber:s,confettiColors:r,emojis:c,emojiSize:l}}var l=function(){function e(i){var n=this;t(this,e),this.canvasContext=i,this.shapes=[],this.promise=new Promise((function(t){return n.resolvePromise=t}))}return i(e,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var t;(t=this.shapes).push.apply(t,arguments)}},{key:"complete",value:function(){var t;return!this.shapes.length&&(null===(t=this.resolvePromise)||void 0===t||t.call(this),!0)}},{key:"processShapes",value:function(t,e,i){var n=this,s=t.timeDelta,o=t.currentTime;this.shapes=this.shapes.filter((function(t){return t.updatePosition(s,o),t.draw(n.canvasContext),!i||t.getIsVisibleOnCanvas(e)}))}}]),e}();return function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.activeConfettiBatches=[],this.canvas=i.canvas||c(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=(new Date).getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return i(e,[{key:"loop",value:function(){var t,e,i,s,o;this.requestAnimationFrameRequested=!1,t=this.canvas,e=window.devicePixelRatio,i=getComputedStyle(t),s=n(i.getPropertyValue("width")),o=n(i.getPropertyValue("height")),t.setAttribute("width",(s*e).toString()),t.setAttribute("height",(o*e).toString());var a=(new Date).getTime(),r=a-this.lastUpdated,h=this.canvas.offsetHeight,c=this.iterationIndex%10==0;this.activeConfettiBatches=this.activeConfettiBatches.filter((function(t){return t.processShapes({timeDelta:r,currentTime:a},h,c),!c||!t.complete()})),this.iterationIndex++,this.queueAnimationFrameIfNeeded(a)}},{key:"queueAnimationFrameIfNeeded",value:function(t){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=t||(new Date).getTime(),requestAnimationFrame(this.loop))}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=u(t),i=e.confettiRadius,n=e.confettiNumber,s=e.confettiColors,o=e.emojis,a=e.emojiSize,r=this.canvas.getBoundingClientRect(),c=r.width,d=r.height,f=5*d/7,m={x:0,y:f},v={x:c,y:f},p=new l(this.canvasContext),y=0;y<n/2;y++){var g=new h({initialPosition:m,direction:"right",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c}),C=new h({initialPosition:v,direction:"left",confettiRadius:i,confettiColors:s,confettiNumber:n,emojis:o,emojiSize:a,canvasWidth:c});p.addShapes(g,C)}return this.activeConfettiBatches.push(p),this.queueAnimationFrameIfNeeded(),p.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}},{key:"destroyCanvas",value:function(){this.canvas.remove()}}]),e}()}();
</script><script type="text/javascript">
window.mkdocsQuizTranslations = {};
</script><script type="text/javascript">
window.mkdocsQuizConfig = {
  confetti: true,
  showProgress: true,
  progressSidebarPosition: "top"
};
</script><script type="text/javascript" defer>// Wrap everything in an IIFE to avoid variable redeclaration issues
// when Material for MkDocs instant navigation reloads the page
(function () {
  // Constants
  const STORAGE_KEY_PREFIX = "quiz_progress_";

  // Translation helper function
  function t(key, params = {}) {
    let text = window.mkdocsQuizTranslations?.[key] || key;
    // Simple template replacement for {n} and {key} style placeholders
    return text.replace(/{(\w+)}/g, (_, k) => (params[k] !== undefined ? params[k] : `{${k}}`));
  }

  // Confetti instance (will be initialized if enabled)
  let jsConfetti = null;

  // Store event listeners for cleanup
  let eventListeners = [];

  // Initialize confetti if enabled
  if (window.mkdocsQuizConfig && window.mkdocsQuizConfig.confetti) {
    if (typeof JSConfetti !== "undefined") {
      jsConfetti = new JSConfetti();
    }
  }

  // Function to move quiz progress sidebar into TOC sidebar
  // This needs to run on every page load for Material instant navigation
  function repositionSidebar() {
    // Use requestAnimationFrame to ensure DOM is ready
    requestAnimationFrame(() => {
      const sidebar = document.getElementById("quiz-progress-sidebar");
      const tocSidebar = document.querySelector(".md-sidebar--secondary .md-sidebar__inner .md-nav--secondary");

      if (sidebar && tocSidebar) {
        // Check if sidebar is already in the correct position
        // by seeing if it's already a child of tocSidebar
        if (!tocSidebar.contains(sidebar)) {
          // Get position from config (default: "top")
          const position =
            window.mkdocsQuizConfig && window.mkdocsQuizConfig.progressSidebarPosition
              ? window.mkdocsQuizConfig.progressSidebarPosition
              : "top";

          // Move sidebar based on configured position
          if (position === "bottom") {
            // Append to the end (below TOC)
            tocSidebar.appendChild(sidebar);
          } else {
            // Default: insert at the top (above TOC)
            if (tocSidebar.firstChild) {
              tocSidebar.insertBefore(sidebar, tocSidebar.firstChild);
            } else {
              tocSidebar.appendChild(sidebar);
            }
          }
        }
      }
    });
  }

  // Cleanup function to remove event listeners and prevent memory leaks
  function cleanup() {
    eventListeners.forEach(({ element, event, handler }) => {
      element.removeEventListener(event, handler);
    });
    eventListeners = [];
  }

  // Helper function to add tracked event listeners
  function addTrackedEventListener(element, event, handler) {
    element.addEventListener(event, handler);
    eventListeners.push({ element, event, handler });
  }

  // Global quiz tracker
  const quizTracker = {
    quizzes: {},
    totalQuizzes: 0,
    answeredQuizzes: 0,
    correctQuizzes: 0,

    init: function () {
      this.totalQuizzes = document.querySelectorAll(".quiz").length;
      this.loadFromStorage();
      // Initialize wasCompleted based on restored state to prevent confetti on page load
      // Only fire confetti when completing quizzes in the current session, not from localStorage
      const progress = this.getProgress();
      this.wasCompleted = progress.answered === progress.total && progress.total > 0;
      this.updateDisplay();
    },

    markQuiz: function (quizId, isCorrect, selectedValues = []) {
      const wasAnswered = !!this.quizzes[quizId];
      const wasCorrect = this.wasPreviouslyCorrect(quizId);

      if (!wasAnswered) {
        this.answeredQuizzes++;
      }

      this.quizzes[quizId] = {
        answered: true,
        correct: isCorrect,
        selectedValues: selectedValues,
      };

      if (isCorrect && !wasCorrect) {
        this.correctQuizzes++;
      } else if (!isCorrect && wasCorrect) {
        this.correctQuizzes--;
      }

      this.saveToStorage();
      this.updateDisplay();
    },

    wasPreviouslyCorrect: function (quizId) {
      return this.quizzes[quizId] && this.quizzes[quizId].correct;
    },

    resetQuiz: function (quizId) {
      if (this.quizzes[quizId]) {
        if (this.quizzes[quizId].correct) {
          this.correctQuizzes--;
        }
        this.answeredQuizzes--;
        delete this.quizzes[quizId];
        this.saveToStorage();
        this.updateDisplay();
      }
    },

    resetAllQuiz: function () {
      this.quizzes = {};
      this.answeredQuizzes = 0;
      this.correctQuizzes = 0;
      this.saveToStorage();
      this.updateDisplay();

      // Reset all quiz forms on the page
      document.querySelectorAll(".quiz").forEach((quiz) => {
        const form = quiz.querySelector("form");
        const fieldset = form.querySelector("fieldset");
        const submitButton = form.querySelector('button[type="submit"]');
        const resetButton = form.querySelector(".quiz-reset-button");
        const feedbackDiv = form.querySelector(".quiz-feedback");
        const section = quiz.querySelector("section");

        // Clear all selections
        const allInputs = fieldset.querySelectorAll('input[name="answer"]');
        allInputs.forEach((input) => {
          input.checked = false;
          input.disabled = false;
        });

        // Reset colors
        resetFieldset(fieldset);

        // Hide content section
        if (section) {
          section.classList.add("hidden");
        }

        // Hide feedback message
        feedbackDiv.classList.add("hidden");
        feedbackDiv.classList.remove("correct", "incorrect");
        feedbackDiv.textContent = "";

        // Show submit button, hide reset button
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.classList.remove("hidden");
        }
        if (resetButton) {
          resetButton.classList.add("hidden");
        }
      });
    },

    getProgress: function () {
      return {
        total: this.totalQuizzes,
        answered: this.answeredQuizzes,
        correct: this.correctQuizzes,
        percentage: this.totalQuizzes > 0 ? Math.round((this.answeredQuizzes / this.totalQuizzes) * 100) : 0,
        score: this.totalQuizzes > 0 ? Math.round((this.correctQuizzes / this.totalQuizzes) * 100) : 0,
      };
    },

    saveToStorage: function () {
      try {
        const pageKey = STORAGE_KEY_PREFIX + window.location.pathname;
        const data = JSON.stringify(this.quizzes);

        // Check size limit (50KB max to prevent quota issues)
        if (data.length > 50000) {
          console.warn("Quiz progress data exceeds size limit, not saving to localStorage");
          this.showStorageWarning("Quiz progress is too large to save");
          return;
        }

        localStorage.setItem(pageKey, data);
      } catch (e) {
        // Handle quota exceeded or localStorage disabled
        console.error("Failed to save quiz progress:", e);
        this.showStorageWarning(
          "Unable to save quiz progress. Your browser may have storage disabled or quota exceeded.",
        );
      }
    },

    loadFromStorage: function () {
      try {
        const pageKey = STORAGE_KEY_PREFIX + window.location.pathname;
        const stored = localStorage.getItem(pageKey);

        if (stored) {
          // Validate size before parsing (50KB max)
          if (stored.length > 50000) {
            console.warn("Stored quiz data exceeds size limit, clearing corrupted data");
            localStorage.removeItem(pageKey);
            return;
          }

          const parsed = JSON.parse(stored);

          // Validate structure: should be an object
          if (typeof parsed !== "object" || parsed === null || Array.isArray(parsed)) {
            console.warn("Invalid quiz data structure, clearing corrupted data");
            localStorage.removeItem(pageKey);
            return;
          }

          this.quizzes = parsed;

          // Recalculate counts and validate quiz data structure
          this.answeredQuizzes = 0;
          this.correctQuizzes = 0;
          for (let key in this.quizzes) {
            const quiz = this.quizzes[key];
            // Validate each quiz entry has expected structure
            if (typeof quiz !== "object" || typeof quiz.answered !== "boolean" || typeof quiz.correct !== "boolean") {
              console.warn("Invalid quiz entry structure, clearing corrupted data");
              this.quizzes = {};
              localStorage.removeItem(pageKey);
              return;
            }

            if (quiz.answered) {
              this.answeredQuizzes++;
            }
            if (quiz.correct) {
              this.correctQuizzes++;
            }
          }
        }
      } catch (e) {
        // Handle parsing errors or localStorage unavailable
        console.error("Failed to load quiz progress:", e);
        const pageKey = STORAGE_KEY_PREFIX + window.location.pathname;
        try {
          localStorage.removeItem(pageKey); // Clear corrupted data
        } catch (cleanupError) {
          // localStorage might be completely unavailable
        }
      }
    },

    updateDisplay: function () {
      const progress = this.getProgress();
      const wasComplete = this.wasCompleted;
      const isComplete = progress.answered === progress.total && progress.total > 0;

      // Dispatch custom event for sidebar/other UI components
      window.dispatchEvent(
        new CustomEvent("quizProgressUpdate", {
          detail: progress,
        }),
      );
      // Update sidebar if it exists
      this.updateSidebar();
      // Update results div if it exists
      this.updateResultsDiv(progress, isComplete, wasComplete);

      // Track completion state
      this.wasCompleted = isComplete;
    },

    updateResultsDiv: function (progress, isComplete, wasComplete) {
      const resultsDiv = document.getElementById("quiz-results");
      if (!resultsDiv) return;

      // Update progress section
      const answeredEl = resultsDiv.querySelector(".quiz-results-answered");
      const totalEl = resultsDiv.querySelector(".quiz-results-total");
      const percentageEl = resultsDiv.querySelector(".quiz-results-percentage");
      const correctEl = resultsDiv.querySelector(".quiz-results-correct");

      if (answeredEl) answeredEl.textContent = progress.answered;
      if (totalEl) totalEl.textContent = progress.total;
      if (percentageEl) percentageEl.textContent = progress.percentage + "%";
      if (correctEl) correctEl.textContent = progress.correct;

      // Handle completion state
      const progressSection = resultsDiv.querySelector(".quiz-results-progress");
      const completeSection = resultsDiv.querySelector(".quiz-results-complete");

      if (isComplete) {
        // Hide progress, show complete
        if (progressSection) progressSection.classList.add("hidden");
        if (completeSection) {
          completeSection.classList.remove("hidden");

          // Update score display
          const scoreValue = resultsDiv.querySelector(".quiz-results-score-value");
          const scoreMessage = resultsDiv.querySelector(".quiz-results-message");

          if (scoreValue) {
            scoreValue.textContent = progress.score + "%";

            // Remove all score classes
            scoreValue.classList.remove(
              "quiz-results-score-excellent",
              "quiz-results-score-good",
              "quiz-results-score-average",
              "quiz-results-score-poor",
              "quiz-results-score-fail",
            );

            // Add appropriate score class and message
            let message = "";
            if (progress.score >= 90) {
              scoreValue.classList.add("quiz-results-score-excellent");
              message = t("Outstanding! You aced it!");
            } else if (progress.score >= 75) {
              scoreValue.classList.add("quiz-results-score-good");
              message = t("Great job! You really know your stuff!");
            } else if (progress.score >= 60) {
              scoreValue.classList.add("quiz-results-score-average");
              message = t("Good effort! Keep learning!");
            } else if (progress.score >= 40) {
              scoreValue.classList.add("quiz-results-score-poor");
              message = t("Not bad, but there's room for improvement!");
            } else {
              scoreValue.classList.add("quiz-results-score-fail");
              message = t("Better luck next time! Keep trying!");
            }

            if (scoreMessage) scoreMessage.textContent = message;
          }

          // Trigger confetti and scroll on first completion
          if (!wasComplete) {
            // Scroll to results div
            resultsDiv.scrollIntoView({ behavior: "smooth", block: "center" });

            // Fire confetti if enabled and score is good
            if (jsConfetti && progress.score >= 10) {
              setTimeout(() => {
                jsConfetti.addConfetti();
              }, 500);
            }
          }
        }
      } else {
        // Show progress, hide complete
        if (progressSection) progressSection.classList.remove("hidden");
        if (completeSection) completeSection.classList.add("hidden");
      }
    },

    updateSidebar: function () {
      // Update both desktop and mobile sidebars
      const sidebars = [
        document.getElementById("quiz-progress-sidebar"),
        document.getElementById("quiz-progress-mobile"),
      ];

      sidebars.forEach((sidebar) => {
        if (sidebar) {
          const progress = this.getProgress();

          // Update answered count
          const answeredEl = sidebar.querySelector(".quiz-progress-answered");
          if (answeredEl) {
            answeredEl.textContent = progress.answered;
          }

          // Update answered percentage - desktop only
          const answeredPercentageEl = sidebar.querySelector(".quiz-progress-answered-percentage");
          if (answeredPercentageEl && sidebar.id == "quiz-progress-sidebar") {
            answeredPercentageEl.textContent = progress.percentage + "%";
          }

          // Update all .quiz-progress-total elements
          const totalElements = sidebar.querySelectorAll(".quiz-progress-total");
          totalElements.forEach((el) => {
            el.textContent = progress.total;
          });

          // Update correct count
          const scoreEl = sidebar.querySelector(".quiz-progress-score");
          if (scoreEl) {
            scoreEl.textContent = progress.correct;
          }

          // Update correct denominator (answered count)
          const scoreTotalEl = sidebar.querySelector(".quiz-progress-score-total");
          if (scoreTotalEl) {
            scoreTotalEl.textContent = progress.answered;
          }

          // Update correct percentage (based on answered quizzes, not total) - desktop only
          const scorePercentageEl = sidebar.querySelector(".quiz-progress-score-percentage");
          if (scorePercentageEl && sidebar.id == "quiz-progress-sidebar") {
            const scorePercentage =
              progress.answered > 0 ? Math.round((progress.correct / progress.answered) * 100) : 0;
            scorePercentageEl.textContent = scorePercentage + "%";
          }

          // Update progress bars (incorrect and correct)
          const correctBar = sidebar.querySelector(".quiz-progress-bar-correct");
          const incorrectBar = sidebar.querySelector(".quiz-progress-bar-incorrect");

          if (correctBar && incorrectBar) {
            const incorrectCount = progress.answered - progress.correct;
            const correctPercentage = progress.total > 0 ? (progress.correct / progress.total) * 100 : 0;
            const incorrectPercentage = progress.total > 0 ? (incorrectCount / progress.total) * 100 : 0;

            incorrectBar.style.width = incorrectPercentage + "%";
            correctBar.style.width = correctPercentage + "%";
          }
        }
      });
    },

    createSidebar: function () {
      // Check if progress tracking is enabled
      const showProgress = window.mkdocsQuizConfig && window.mkdocsQuizConfig.showProgress !== false;

      // Only show sidebar if progress tracking is enabled and there are quizzes
      if (!showProgress || this.totalQuizzes === 0) {
        return;
      }

      // Show both desktop and mobile sidebars
      const desktopSidebar = document.getElementById("quiz-progress-sidebar");
      const mobileSidebar = document.getElementById("quiz-progress-mobile");

      if (desktopSidebar) {
        desktopSidebar.style.display = "";
      }
      if (mobileSidebar) {
        mobileSidebar.style.display = "";
      }

      // Initialize reset button event listeners
      const resetLinks = document.querySelectorAll(".quiz-reset-all-link");
      resetLinks.forEach((resetLink) => {
        const handler = (e) => {
          e.preventDefault();
          if (confirm(t("Are you sure you want to reset the quiz? This will clear your progress."))) {
            quizTracker.resetAllQuiz();
          }
        };
        addTrackedEventListener(resetLink, "click", handler);
      });

      // Update the sidebar with initial values
      this.updateSidebar();
    },

    showStorageWarning: function (message) {
      // Show a warning banner in the progress tracker if it exists
      const progressSidebar = document.getElementById("quiz-progress-sidebar");
      if (progressSidebar) {
        // Check if warning already exists
        let warningEl = progressSidebar.querySelector(".quiz-storage-warning");
        if (!warningEl) {
          warningEl = document.createElement("div");
          warningEl.className = "quiz-storage-warning";
          warningEl.style.cssText =
            "background: #fff3cd; color: #856404; padding: 8px; margin: 8px 0; border-radius: 4px; font-size: 12px; border: 1px solid #ffeaa7;";
          progressSidebar.insertBefore(warningEl, progressSidebar.firstChild);
        }
        warningEl.textContent = message;
      }
    },
  };

  // Translate template elements with data-quiz-translate attributes
  function translateTemplateElements() {
    document.querySelectorAll("[data-quiz-translate]").forEach((element) => {
      const key = element.getAttribute("data-quiz-translate");
      if (key) {
        element.textContent = t(key);
      }
    });
  }

  // Initialize results div reset button
  function initializeResultsDiv() {
    const resultsDiv = document.getElementById("quiz-results");
    if (!resultsDiv) return;

    const resetButton = resultsDiv.querySelector(".quiz-results-reset");
    if (resetButton) {
      const handler = () => {
        if (confirm(t("Are you sure you want to reset the quiz? This will clear your progress."))) {
          quizTracker.resetAllQuiz();
        }
      };
      addTrackedEventListener(resetButton, "click", handler);
    }
  }

  // Initialize intro reset buttons
  function initializeIntroResetButtons() {
    const introResetButtons = document.querySelectorAll(".quiz-intro-reset");
    introResetButtons.forEach((button) => {
      const handler = () => {
        if (confirm(t("Are you sure you want to reset the quiz? This will clear your progress."))) {
          quizTracker.resetAllQuiz();
        }
      };
      addTrackedEventListener(button, "click", handler);
    });
  }

  // Shuffle an array using Fisher-Yates algorithm
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Shuffle the answer elements in a fieldset
  function shuffleAnswers(fieldset) {
    const answerDivs = Array.from(fieldset.querySelectorAll(":scope > div"));
    if (answerDivs.length <= 1) return;

    // Shuffle the array of elements
    shuffleArray(answerDivs);

    // Re-append elements in shuffled order
    answerDivs.forEach((div) => fieldset.appendChild(div));
  }

  // Initialize all quiz elements on the page
  function initializeQuizzes() {
    document.querySelectorAll(".quiz").forEach((quiz) => {
      let form = quiz.querySelector("form");
      let fieldset = form.querySelector("fieldset");
      let submitButton = form.querySelector('button[type="submit"]');
      let feedbackDiv = form.querySelector(".quiz-feedback");

      // Shuffle answers if enabled (before any state restoration)
      if (quiz.hasAttribute("data-shuffle-answers")) {
        shuffleAnswers(fieldset);
      }

      // Get quiz ID from the quiz div itself
      const quizId = quiz.id;

      // Prevent anchor link from triggering page navigation/reload
      const headerLink = quiz.querySelector(".quiz-header-link");
      if (headerLink) {
        const handler = (e) => {
          // Let the browser handle the anchor navigation normally
          // This prevents Material for MkDocs from intercepting it as a page navigation
          e.stopPropagation();
        };
        addTrackedEventListener(headerLink, "click", handler);
      }

      // Create reset button (initially hidden)
      let resetButton = document.createElement("button");
      resetButton.type = "button";
      resetButton.className = "quiz-button quiz-reset-button hidden";
      resetButton.textContent = t("Try Again");
      if (submitButton) {
        submitButton.parentNode.insertBefore(resetButton, submitButton.nextSibling);
      } else {
        form.appendChild(resetButton);
      }

      // Restore quiz state from localStorage if available
      if (quizId && quizTracker.quizzes[quizId]) {
        const savedState = quizTracker.quizzes[quizId];
        const section = quiz.querySelector("section");
        const allAnswers = fieldset.querySelectorAll('input[name="answer"]');
        const correctAnswers = fieldset.querySelectorAll('input[name="answer"][correct]');

        if (savedState.answered) {
          // Restore selected answers based on saved values
          if (savedState.selectedValues && savedState.selectedValues.length > 0) {
            allAnswers.forEach((input) => {
              if (savedState.selectedValues.includes(input.value)) {
                input.checked = true;
              }
            });
          }

          if (savedState.correct) {
            // Show the content section
            section.classList.remove("hidden");

            // Only mark the correct answers in green (don't highlight wrong answers)
            allAnswers.forEach((input) => {
              if (input.hasAttribute("correct")) {
                input.parentElement.classList.add("correct");
              }
            });

            // Show correct feedback
            feedbackDiv.classList.remove("hidden", "incorrect");
            feedbackDiv.classList.add("correct");
            feedbackDiv.textContent = t("Correct answer!");

            // Disable inputs if disable-after-submit is enabled
            if (quiz.hasAttribute("data-disable-after-submit")) {
              allAnswers.forEach((input) => {
                input.disabled = true;
              });
              if (submitButton) {
                submitButton.disabled = true;
              }
              resetButton.classList.add("hidden");
            } else {
              // Show reset button, hide submit button
              resetButton.classList.remove("hidden");
              if (submitButton) {
                submitButton.classList.add("hidden");
              }
            }
          } else {
            // Restore incorrect answer state
            const selectedInputs = Array.from(allAnswers).filter((input) =>
              savedState.selectedValues.includes(input.value),
            );

            // Show the content section for incorrect answers too
            section.classList.remove("hidden");

            // Mark selected answers
            selectedInputs.forEach((input) => {
              if (input.hasAttribute("correct")) {
                input.parentElement.classList.add("correct");
              } else {
                input.parentElement.classList.add("wrong");
              }
            });

            // Show correct answers if show-correct is enabled
            if (quiz.hasAttribute("data-show-correct")) {
              correctAnswers.forEach((input) => {
                input.parentElement.classList.add("correct");
              });
            }

            // Show incorrect feedback
            feedbackDiv.classList.remove("hidden", "correct");
            feedbackDiv.classList.add("incorrect");
            const canRetry = !quiz.hasAttribute("data-disable-after-submit");
            feedbackDiv.textContent = canRetry ? t("Incorrect answer. Please try again.") : t("Incorrect answer.");

            // Disable inputs if disable-after-submit is enabled
            if (quiz.hasAttribute("data-disable-after-submit")) {
              allAnswers.forEach((input) => {
                input.disabled = true;
              });
              if (submitButton) {
                submitButton.disabled = true;
              }
              resetButton.classList.add("hidden");
            } else {
              // Show reset button, hide submit button
              resetButton.classList.remove("hidden");
              if (submitButton) {
                submitButton.classList.add("hidden");
              }
            }
          }
        }
      }

      // Auto-submit on radio button change if enabled
      if (quiz.hasAttribute("data-auto-submit")) {
        let radioButtons = fieldset.querySelectorAll('input[type="radio"]');
        radioButtons.forEach((radio) => {
          const handler = (e) => {
            // Prevent any default behavior that might cause page scroll
            e.preventDefault();
            // Trigger form submission with a properly configured event
            // cancelable: true allows preventDefault to work
            // bubbles: true ensures proper event propagation
            form.dispatchEvent(new Event("submit", { cancelable: true, bubbles: true }));
          };
          addTrackedEventListener(radio, "change", handler);
        });
      }

      // Reset button handler
      const resetHandler = () => {
        // Clear all selections
        const allInputs = fieldset.querySelectorAll('input[name="answer"]');
        allInputs.forEach((input) => {
          input.checked = false;
          input.disabled = false;
        });
        // Reset colors
        resetFieldset(fieldset);
        // Hide content section
        let section = quiz.querySelector("section");
        section.classList.add("hidden");
        // Hide feedback message
        feedbackDiv.classList.add("hidden");
        feedbackDiv.classList.remove("correct", "incorrect");
        feedbackDiv.textContent = "";
        // Show submit button, hide reset button
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.classList.remove("hidden");
        }
        resetButton.classList.add("hidden");
        // Update tracker
        if (quizId) {
          quizTracker.resetQuiz(quizId);
        }
      };
      addTrackedEventListener(resetButton, "click", resetHandler);

      const submitHandler = (event) => {
        // Prevent default form submission behavior
        event.preventDefault();
        // Stop propagation to prevent Material for MkDocs instant navigation from intercepting
        event.stopPropagation();
        let selectedAnswers = form.querySelectorAll('input[name="answer"]:checked');
        let correctAnswers = fieldset.querySelectorAll('input[name="answer"][correct]');
        // Check if all correct answers are selected
        let is_correct = selectedAnswers.length === correctAnswers.length;
        Array.from(selectedAnswers).forEach((answer) => {
          if (!answer.hasAttribute("correct")) {
            is_correct = false;
          }
        });
        let section = quiz.querySelector("section");
        // Always show the content section after submission
        section.classList.remove("hidden");

        if (is_correct) {
          resetFieldset(fieldset);
          // Only mark the correct answers in green (don't highlight wrong answers)
          const allAnswers = fieldset.querySelectorAll('input[name="answer"]');
          allAnswers.forEach((answer) => {
            if (answer.hasAttribute("correct")) {
              answer.parentElement.classList.add("correct");
            }
          });
          // Show correct feedback
          feedbackDiv.classList.remove("hidden", "incorrect");
          feedbackDiv.classList.add("correct");
          feedbackDiv.textContent = t("Correct answer!");
        } else {
          resetFieldset(fieldset);
          // Mark wrong fields with colors
          Array.from(selectedAnswers).forEach((answer) => {
            if (!answer.hasAttribute("correct")) {
              answer.parentElement.classList.add("wrong");
            } else {
              answer.parentElement.classList.add("correct");
            }
          });
          // If show-correct is enabled, also show all correct answers
          if (quiz.hasAttribute("data-show-correct")) {
            correctAnswers.forEach((answer) => {
              answer.parentElement.classList.add("correct");
            });
          }
          // Show incorrect feedback
          feedbackDiv.classList.remove("hidden", "correct");
          feedbackDiv.classList.add("incorrect");
          // Only show "Please try again" if the quiz is not disabled after submission
          const canRetry = !quiz.hasAttribute("data-disable-after-submit");
          feedbackDiv.textContent = canRetry ? t("Incorrect answer. Please try again.") : t("Incorrect answer.");
        }

        // Update tracker
        if (quizId) {
          // Get selected values to save
          const selectedValues = Array.from(selectedAnswers).map((input) => input.value);
          quizTracker.markQuiz(quizId, is_correct, selectedValues);
        }

        // Disable quiz after submission if option is enabled
        if (quiz.hasAttribute("data-disable-after-submit")) {
          const allInputs = fieldset.querySelectorAll('input[name="answer"]');
          allInputs.forEach((input) => {
            input.disabled = true;
          });
          if (submitButton) {
            submitButton.disabled = true;
          }
          // Hide reset button if disable-after-submit is enabled
          resetButton.classList.add("hidden");
        } else {
          // Show reset button and hide submit button
          resetButton.classList.remove("hidden");
          if (submitButton) {
            submitButton.classList.add("hidden");
          }
        }
      };
      addTrackedEventListener(form, "submit", submitHandler);
    });
  }

  function resetFieldset(fieldset) {
    Array.from(fieldset.children).forEach((child) => {
      child.classList.remove("wrong", "correct");
    });
  }

  // Main initialization function that sets up everything on a page
  function initializePage() {
    // Initialize tracker
    quizTracker.init();

    // Translate template elements
    translateTemplateElements();

    // Reposition sidebar for Material theme TOC integration
    repositionSidebar();

    // Create sidebar
    quizTracker.createSidebar();

    // Initialize results div and intro buttons
    initializeResultsDiv();
    initializeIntroResetButtons();

    // Initialize all quiz elements
    initializeQuizzes();
  }

  // Run initialization when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initializePage);
  } else {
    initializePage();
  }

  // Material for MkDocs instant navigation support
  // Cleanup and reinitialize when navigating between pages
  if (typeof document$ !== "undefined") {
    // Unsubscribe from any previous subscription to prevent duplicate handlers
    // This is needed because the script re-runs on each page navigation,
    // which would otherwise accumulate subscriptions
    if (window._mkdocsQuizSubscription) {
      window._mkdocsQuizSubscription.unsubscribe();
    }

    // Material theme with instant navigation is active
    window._mkdocsQuizSubscription = document$.subscribe(() => {
      cleanup(); // Remove old event listeners to prevent memory leaks
      // Reinitialize everything for the new page
      initializePage();
    });
  }
})(); // End of IIFE
</script>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/mr-bev/software-engineering-stage6-nsw/issues/new/?title=[Feedback]+Database%20Integration%20%26%20SQL%20Security+-+/web_development/database_integration_sql_security/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../server_side_programming_authentication_template_engines/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Server-Side Programming, Authentication &amp; Template Engines">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Server-Side Programming, Authentication & Template Engines
              </div>
            </div>
          </a>
        
        
          
          <a href="../advanced_auth_session_management/" class="md-footer__link md-footer__link--next" aria-label="Next: Advanced Authentication, Authorisation &amp; Session Management">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Advanced Authentication, Authorisation & Session Management
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024-26 <a href="https://github.com/mr-bev" target="_blank" rel="noopener">Aaron Beverley</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognise your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.footer", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="../../javascripts/feedback.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>